# 腾讯云邮件配置说明

## 问题诊断 ✅

**根本原因**：配置文件中使用了阿里云的SMTP服务器，但实际使用的是腾讯云服务。

### 错误配置（之前）
```json
{
  "smtp_host": "smtpdm.aliyun.com",  ← 阿里云服务器
  "smtp_user": "verify@unischedulersuper.online"
}
```

### 正确配置（已修复）
```json
{
  "smtp_host": "smtp.qcloudmail.com",  ← 腾讯云服务器
  "smtp_user": "verify@unischedulersuper.online"
}
```

---

## 腾讯云邮件推送配置步骤

### 1. 登录腾讯云控制台

访问：https://console.cloud.tencent.com/ses

### 2. 配置发信域名

1. 进入"发信域名"页面
2. 添加域名：`unischedulersuper.online`
3. 完成域名验证（添加TXT记录到DNS）
4. 等待域名审核通过

### 3. 创建发信地址

1. 进入"发信地址"页面
2. 创建发信地址：`verify@unischedulersuper.online`
3. 获取SMTP密码

### 4. 配置邮件模板（重要！）

腾讯云邮件推送服务**可能需要**提前配置邮件模板：

1. 进入"邮件模板"页面
2. 点击"新建模板"
3. 填写模板信息：
   - **模板名称**：验证码邮件
   - **模板类型**：通知类
   - **模板内容**：使用 `docs/腾讯云邮件模板.html` 的内容

4. 提交审核并等待通过

---

## 邮件模板详情

已为你创建符合腾讯云要求的HTML邮件模板：

### 文件位置
- `docs/腾讯云邮件模板.html`

### 模板特点

✅ **符合腾讯云所有要求**：
- 字数：超过50字（通知类要求）
- 变量比例：仅1个变量 `{{code}}`，文字内容丰富
- 无违规内容
- URL明确：`https://www.unischedulersuper.online`
- 业务清晰：验证码邮件，用途明确

✅ **内容结构**：
1. **顶部品牌区**：紫色渐变背景，显示系统名称
2. **问候语**：尊敬的用户，您好
3. **业务说明**：详细说明验证码用途（身份验证）
4. **验证码显示**：大号字体，渐变背景框
5. **安全提示**：4条重要提示（有效期、保密性等）
6. **额外说明**：系统介绍和服务承诺
7. **底部信息**：官网链接、客服邮箱、版权信息

✅ **设计亮点**：
- 响应式设计（适配移动设备）
- 渐变色设计（专业美观）
- 安全警告框（黄色高亮）
- 清晰的信息层次
- 符合品牌调性

### 模板变量

模板中只使用一个变量：
```html
{{code}}
```

这个变量会被替换为实际的6位验证码。

---

## 使用说明

### 方法1：在腾讯云后台配置模板（推荐）

1. 复制 `docs/腾讯云邮件模板.html` 的全部内容
2. 登录腾讯云控制台 → 邮件推送 → 邮件模板
3. 新建模板，粘贴HTML内容
4. 设置变量：`code`（6位数字验证码）
5. 提交审核

### 方法2：修改代码使用模板ID（如果腾讯云强制使用模板）

如果腾讯云要求使用模板ID发送邮件，需要修改 `config/email_manager.py`。

**检查是否需要**：
- 如果当前代码可以正常发送 → 不需要修改
- 如果提示"必须使用模板" → 需要按照腾讯云SDK修改

---

## 腾讯云SMTP服务器信息

### 常用SMTP配置

```json
{
  "smtp_host": "smtp.qcloudmail.com",
  "smtp_port": 465,
  "smtp_use_ssl": true
}
```

或使用TLS：

```json
{
  "smtp_host": "smtp.qcloudmail.com",
  "smtp_port": 587,
  "smtp_use_ssl": false
}
```

### 获取SMTP密码

1. 登录腾讯云控制台
2. 邮件推送 → 发信地址
3. 找到 `verify@unischedulersuper.online`
4. 查看或重置SMTP密码
5. 复制密码到 `config/email.json`

---

## 测试步骤

### 1. 确认配置正确

检查 `config/email.json`：
```json
{
  "enabled": true,
  "smtp_host": "smtp.qcloudmail.com",  ← 腾讯云
  "smtp_port": 465,
  "smtp_use_ssl": true,
  "smtp_user": "verify@unischedulersuper.online",
  "smtp_password": "你的SMTP密码",
  "from_email": "verify@unischedulersuper.online",
  "from_name": "UniSchedulerSuper时间管理系统"
}
```

### 2. 重启Django服务

```bash
# 停止当前服务（Ctrl+C）
# 重新启动
python manage.py runserver
```

### 3. 测试发送邮件

```python
# Django shell
python manage.py shell

>>> from config.email_manager import test_email_config
>>> success, msg = test_email_config()
>>> print(f"测试结果: {msg}")
```

或直接测试注册/找回密码功能。

---

## 常见问题

### Q1: 是否必须配置邮件模板？

A: **取决于腾讯云的服务类型**：
- **邮件推送（API方式）**：可能需要模板
- **SMTP方式**：通常不需要模板，可以直接发送

当前代码使用的是**SMTP方式**，理论上不需要模板。如果仍然失败，可能需要：
1. 在腾讯云后台提交模板审核
2. 或联系腾讯云客服确认

### Q2: 如何判断是否需要模板？

A: 尝试发送邮件，如果返回错误提示"需要模板"或"template required"，则需要配置。

### Q3: 模板变量如何替换？

A: 当前代码在 `config/email_manager.py` 中的 `send_verification_code_email()` 函数会自动生成HTML，不使用腾讯云模板。

如果腾讯云强制使用模板，需要修改代码调用腾讯云SDK。

### Q4: SMTP端口选择？

A: 
- **465端口**：使用SSL加密（推荐）
- **587端口**：使用TLS加密
- **25端口**：不加密（不推荐）

---

## 配置文件对比

### 阿里云配置（错误）
```json
{
  "smtp_host": "smtpdm.aliyun.com",
  "smtp_port": 465,
  "smtp_use_ssl": true
}
```

### 腾讯云配置（正确）
```json
{
  "smtp_host": "smtp.qcloudmail.com",
  "smtp_port": 465,
  "smtp_use_ssl": true
}
```

### 其他常见邮件服务商

**QQ邮箱**：
```json
{
  "smtp_host": "smtp.qq.com",
  "smtp_port": 465,
  "smtp_use_ssl": true
}
```

**163邮箱**：
```json
{
  "smtp_host": "smtp.163.com",
  "smtp_port": 465,
  "smtp_use_ssl": true
}
```

---

## 下一步操作

1. ✅ **已完成**：更新配置文件为腾讯云SMTP服务器
2. ✅ **已完成**：创建符合要求的邮件模板HTML
3. ⏳ **待操作**：重启Django服务
4. ⏳ **待测试**：测试邮件发送功能
5. ⏳ **可选操作**：如果需要，在腾讯云后台配置模板

---

## 技术支持

如果问题仍然存在：

1. **检查腾讯云控制台**：
   - 发信域名状态
   - 发信地址状态
   - SMTP密码是否正确

2. **查看日志**：
   - `logs/application.log`
   - 查找详细错误信息

3. **测试SMTP连接**：
   ```bash
   telnet smtp.qcloudmail.com 465
   ```

4. **联系腾讯云客服**：
   - 确认是否需要配置模板
   - 确认SMTP服务是否开启
   - 确认账号是否欠费

---

## 文件清单

- `config/email.json` - 已更新为腾讯云配置 ✅
- `docs/腾讯云邮件模板.html` - 符合要求的邮件模板 ✅
- `docs/腾讯云邮件配置说明.md` - 本文档 ✅
