# ç”¨æˆ·è®¾ç½®åŠŸèƒ½å®ç°æ–‡æ¡£

**ç‰ˆæœ¬**: v20251102-001  
**æ—¥æœŸ**: 2025å¹´11æœˆ2æ—¥  
**çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

å®ç°äº†å…¨æ–°çš„ç”¨æˆ·è®¾ç½®ç•Œé¢ï¼Œæ•´åˆäº†åŸæœ‰çš„ `user_preference` åŠŸèƒ½ï¼Œå¹¶æ·»åŠ äº†å¤šä¸ªæ–°çš„è®¾ç½®é€‰é¡¹ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡å¯¼èˆªæ çš„ç”¨æˆ·ä¸‹æ‹‰èœå•è®¿é—®è®¾ç½®ã€å¸®åŠ©å’Œé€€å‡ºåŠŸèƒ½ã€‚

---

## ğŸ¯ å®ç°çš„åŠŸèƒ½

### 1. ç”¨æˆ·ä¸‹æ‹‰èœå•åŠŸèƒ½æ¿€æ´»

**ä½ç½®**: `home_new.html` é¡¶éƒ¨å¯¼èˆªæ 

**ä¸‰ä¸ªæŒ‰é’®çš„åŠŸèƒ½**:

| æŒ‰é’® | åŠŸèƒ½ | å®ç°æ–¹å¼ |
|------|------|----------|
| ğŸ”§ **è®¾ç½®** | æ‰“å¼€ç”¨æˆ·è®¾ç½®æ¨¡æ€æ¡† | `data-bs-toggle="modal" data-bs-target="#settingsModal"` |
| â“ **å¸®åŠ©** | è·³è½¬åˆ°å¸®åŠ©æ–‡æ¡£é¡µé¢ | `href="{% url 'help_page' %}"` |
| ğŸšª **é€€å‡º** | é€€å‡ºç™»å½•å¹¶è·³è½¬åˆ°é¦–é¡µ | `href="{% url 'user_logout' %}"` |

---

### 2. å¸®åŠ©æ–‡æ¡£é¡µé¢

**æ–‡ä»¶**: `core/templates/help.html`

**ç‰¹æ€§**:
- âœ… å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒç§»åŠ¨ç«¯
- âœ… ç¾è§‚çš„æ¸å˜èƒŒæ™¯
- âœ… è¯¦ç»†çš„åŠŸèƒ½ä»‹ç»
- âœ… å¿«é€Ÿè¿”å›ä¸»é¡µæŒ‰é’®
- âœ… åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š
  - å¿«é€Ÿå¼€å§‹æŒ‡å—
  - ä¸»è¦åŠŸèƒ½ä»‹ç»ï¼ˆæ—¥ç¨‹ç®¡ç†ã€æ™ºèƒ½æé†’ã€AIåŠ©æ‰‹ã€æ™ºèƒ½æœç´¢ï¼‰
  - ä½¿ç”¨æŠ€å·§
  - å¸¸è§é—®é¢˜è§£ç­”
  - è”ç³»æ”¯æŒä¿¡æ¯

**è·¯ç”±**: `/help/`

---

### 3. ç”¨æˆ·è®¾ç½®æ¨¡æ€æ¡†

**è®¾è®¡**: æ¨¡æ€æ¡† + Tabs å¯¼èˆª

**äº”ä¸ªè®¾ç½®åˆ†ç±»**:

#### ğŸ“Œ åŸºæœ¬è®¾ç½®
- **ç¬¬Nå‘¨èµ·å§‹æ—¥æœŸ**: æœˆä»½ + æ—¥æœŸé€‰æ‹©å™¨
- ç”¨äºè®¡ç®—å‘¨æ•°çš„èµ·å§‹å‚è€ƒç‚¹

#### ğŸ“… æ—¥ç¨‹åå¥½
- **é»˜è®¤æ—¥ç¨‹æ—¶é•¿**: 5-480åˆ†é’Ÿï¼ˆ5åˆ†é’Ÿæ­¥è¿›ï¼‰
- **æ¯å‘¨èµ·å§‹æ—¥**: å‘¨æ—¥/å‘¨ä¸€/å‘¨å…­
- **å·¥ä½œæ—¶é—´**: å¼€å§‹æ—¶é—´ + ç»“æŸæ—¶é—´
- **è‡ªåŠ¨è®¾ç½®DDL**: å¼€å…³ï¼ˆå°†æ—¥ç¨‹ç»“æŸæ—¶é—´è‡ªåŠ¨è®¾ä¸ºæˆªæ­¢æ—¶é—´ï¼‰
- **æ—¥å†æ˜¾ç¤ºå‘¨æœ«**: å¼€å…³

#### ğŸ¨ æ˜¾ç¤ºåå¥½
- **é»˜è®¤æ—¥å†è§†å›¾**: æœˆè§†å›¾/å‘¨è§†å›¾/æ—¥è§†å›¾/åˆ—è¡¨è§†å›¾
- **ä¸»é¢˜æ¨¡å¼**: æµ…è‰²/æ·±è‰²/è·Ÿéšç³»ç»Ÿï¼ˆğŸ”œ å³å°†æ¨å‡ºï¼‰
- **æ—¥ç¨‹é¢œè‰²æ–¹æ¡ˆ**: é»˜è®¤/æŒ‰ä¼˜å…ˆçº§/æŒ‰ç±»å‹ï¼ˆğŸ”œ å³å°†æ¨å‡ºï¼‰
- **æ˜¾ç¤ºå·²å®Œæˆæ—¥ç¨‹**: å¼€å…³

#### â° æé†’è®¾ç½®
- **å¯ç”¨æé†’åŠŸèƒ½**: å¼€å…³
- **é»˜è®¤æå‰æé†’æ—¶é—´**: 0-1440åˆ†é’Ÿï¼ˆ5åˆ†é’Ÿæ­¥è¿›ï¼‰
- **æé†’å£°éŸ³**: å¼€å…³ï¼ˆğŸ”œ å³å°†æ¨å‡ºï¼‰

#### ğŸ¤– AI è®¾ç½®
- **å¯ç”¨ AI åŠŸèƒ½**: å¼€å…³
- **AI è‡ªåŠ¨å»ºè®®**: å¼€å…³ï¼ˆğŸ”œ å³å°†æ¨å‡ºï¼‰

---

## ğŸ”§ æŠ€æœ¯å®ç°

### åç«¯å®ç°

#### 1. æ•°æ®æ¨¡å‹æ‰©å±• (`core/models.py`)

åœ¨ `DATA_SCHEMA` çš„ `user_preference` ä¸­æ·»åŠ äº†ä»¥ä¸‹æ–°å­—æ®µï¼š

```python
"user_preference": {
    "type": dict,
    "items": {
        # åŸæœ‰å­—æ®µ
        "week_number_start": {...},
        "auto_ddl": {...},
        "prompt_scene_presets": {...},
        
        # æ–°å¢å­—æ®µ
        "default_event_duration": {
            "type": int,
            "default": 60,
        },
        "work_hours_start": {
            "type": str,
            "default": "09:00",
        },
        "work_hours_end": {
            "type": str,
            "default": "18:00",
        },
        "show_weekends": {
            "type": bool,
            "default": True,
        },
        "week_starts_on": {
            "type": int,
            "default": 1,
        },
        "calendar_view_default": {
            "type": str,
            "default": "dayGridMonth",
        },
        "theme": {
            "type": str,
            "default": "light",
        },
        "show_completed_events": {
            "type": bool,
            "default": True,
        },
        "event_color_by": {
            "type": str,
            "default": "default",
        },
        "reminder_enabled": {
            "type": bool,
            "default": True,
        },
        "default_reminder_time": {
            "type": int,
            "default": 15,
        },
        "reminder_sound": {
            "type": bool,
            "default": True,
        },
        "ai_enabled": {
            "type": bool,
            "default": True,
        },
        "ai_auto_suggest": {
            "type": bool,
            "default": False,
        },
    },
}
```

#### 2. API è§†å›¾ (`core/views.py`)

**å‡½æ•°**: `user_settings(request)`

**åŠŸèƒ½**:
- **GET è¯·æ±‚**: è¿”å›å½“å‰ç”¨æˆ·çš„æ‰€æœ‰è®¾ç½®ï¼ˆJSONæ ¼å¼ï¼‰
- **POST è¯·æ±‚**: ä¿å­˜ç”¨æˆ·æäº¤çš„è®¾ç½®ï¼Œä½¿ç”¨ `DATA_SCHEMA` è¿›è¡ŒéªŒè¯

**ç«¯ç‚¹**: `/get_calendar/user_settings/`

**è¿”å›ç¤ºä¾‹**:
```json
{
    "week_number_start": {"month": 2, "day": 24},
    "auto_ddl": true,
    "default_event_duration": 60,
    "work_hours_start": "09:00",
    "work_hours_end": "18:00",
    "show_weekends": true,
    "week_starts_on": 1,
    "calendar_view_default": "dayGridMonth",
    "theme": "light",
    "show_completed_events": true,
    "event_color_by": "default",
    "reminder_enabled": true,
    "default_reminder_time": 15,
    "reminder_sound": true,
    "ai_enabled": true,
    "ai_auto_suggest": false
}
```

#### 3. å¸®åŠ©é¡µé¢è§†å›¾ (`core/views.py`)

**å‡½æ•°**: `help_page(request)`

**åŠŸèƒ½**: æ¸²æŸ“å¸®åŠ©æ–‡æ¡£é¡µé¢

**è£…é¥°å™¨**: `@login_required`

#### 4. è·¯ç”±é…ç½® (`core/urls.py`)

```python
path('help/', views.help_page, name='help_page'),
path('get_calendar/user_settings/', views.user_settings, name='user_settings'),
```

---

### å‰ç«¯å®ç°

#### 1. è®¾ç½®æ¨¡æ€æ¡† HTML (`home_new.html`)

**ä½ç½®**: åœ¨ `manageGroupsModal` æ¨¡æ€æ¡†ä¹‹å

**ç»“æ„**:
```html
<div class="modal fade" id="settingsModal">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <!-- æ ‡é¢˜æ  -->
            <div class="modal-header bg-primary text-white">
                <h5>ç”¨æˆ·è®¾ç½®</h5>
            </div>
            
            <!-- Tabs å¯¼èˆª -->
            <ul class="nav nav-tabs">
                <li>åŸºæœ¬è®¾ç½®</li>
                <li>æ—¥ç¨‹åå¥½</li>
                <li>æ˜¾ç¤ºåå¥½</li>
                <li>æé†’è®¾ç½®</li>
                <li>AI è®¾ç½®</li>
            </ul>
            
            <!-- Tabs å†…å®¹ -->
            <div class="tab-content">
                <!-- å„ä¸ª tab çš„è¡¨å•å†…å®¹ -->
            </div>
            
            <!-- æŒ‰é’®æ  -->
            <div class="modal-footer">
                <button>å–æ¶ˆ</button>
                <button id="saveSettings">ä¿å­˜è®¾ç½®</button>
            </div>
        </div>
    </div>
</div>
```

#### 2. JavaScript é€»è¾‘ (`home_new.html`)

**æ ¸å¿ƒå‡½æ•°**:

| å‡½æ•°å | åŠŸèƒ½ | è§¦å‘æ—¶æœº |
|--------|------|----------|
| `initUserSettings()` | åˆå§‹åŒ–è®¾ç½®åŠŸèƒ½ | é¡µé¢åŠ è½½å®Œæˆå |
| `loadUserSettings()` | ä»æœåŠ¡å™¨åŠ è½½è®¾ç½® | æ¨¡æ€æ¡†æ‰“å¼€æ—¶ |
| `saveUserSettings()` | ä¿å­˜è®¾ç½®åˆ°æœåŠ¡å™¨ | ç‚¹å‡»"ä¿å­˜è®¾ç½®"æŒ‰é’® |
| `applyImmediateSettings()` | åº”ç”¨ç«‹å³ç”Ÿæ•ˆçš„è®¾ç½® | ä¿å­˜æˆåŠŸå |
| `showToast()` | æ˜¾ç¤ºæç¤ºæ¶ˆæ¯ | å„ç§æ“ä½œå |

**AJAX è¯·æ±‚**:

```javascript
// åŠ è½½è®¾ç½®
$.ajax({
    url: '/get_calendar/user_settings/',
    method: 'GET',
    success: function(settings) {
        // å¡«å……è¡¨å•å­—æ®µ
    }
});

// ä¿å­˜è®¾ç½®
$.ajax({
    url: '/get_calendar/user_settings/',
    method: 'POST',
    contentType: 'application/json',
    data: JSON.stringify(settings),
    headers: {
        'X-CSRFToken': window.CSRF_TOKEN
    },
    success: function(response) {
        showToast('è®¾ç½®å·²ä¿å­˜', 'success');
    }
});
```

**ç«‹å³ç”Ÿæ•ˆçš„è®¾ç½®**:
- æ—¥å†è§†å›¾åˆ‡æ¢ (`calendar.changeView()`)
- å‘¨æœ«æ˜¾ç¤ºå¼€å…³ (`calendar.setOption('weekends', ...)`)
- å…¶ä»–è®¾ç½®éœ€è¦åˆ·æ–°é¡µé¢æ‰èƒ½å®Œå…¨åº”ç”¨

---

## ğŸ¨ UI/UX è®¾è®¡

### è®¾è®¡åŸåˆ™
1. **æ¨¡æ€æ¡†ä¼˜å…ˆ**: ä¸ç¦»å¼€å½“å‰é¡µé¢ï¼Œç”¨æˆ·ä½“éªŒæµç•…
2. **åˆ†ç±»æ¸…æ™°**: ä½¿ç”¨ Tabs å°†è®¾ç½®åˆ†ä¸º5å¤§ç±»
3. **è§†è§‰åé¦ˆ**: ä½¿ç”¨ Bootstrap Toast æä¾›æ“ä½œåé¦ˆ
4. **æ¸è¿›å¢å¼º**: éƒ¨åˆ†åŠŸèƒ½æ ‡æ³¨"å³å°†æ¨å‡º"ï¼Œä¿ç•™æ‰©å±•ç©ºé—´

### é¢œè‰²æ–¹æ¡ˆ
- **ä¸»è‰²è°ƒ**: Bootstrap Primary è“è‰² (`#0d6efd`)
- **æˆåŠŸæ¶ˆæ¯**: Bootstrap Success ç»¿è‰²
- **è­¦å‘Šæ¶ˆæ¯**: Bootstrap Warning é»„è‰²
- **é”™è¯¯æ¶ˆæ¯**: Bootstrap Danger çº¢è‰²

### å“åº”å¼è®¾è®¡
- **å¤§å±å¹•**: æ¨¡æ€æ¡† `modal-xl`ï¼Œå®½åº¦æ›´å¤§
- **å°å±å¹•**: è‡ªåŠ¨é€‚åº”ï¼Œå‚ç›´æ’åˆ—
- **è¡¨å•å¸ƒå±€**: ä½¿ç”¨ Bootstrap Gridï¼ˆ`row` + `col-md-6`ï¼‰

---

## ğŸ“ ä½¿ç”¨è¯´æ˜

### ç”¨æˆ·æ“ä½œæµç¨‹

1. **æ‰“å¼€è®¾ç½®**
   - ç‚¹å‡»å³ä¸Šè§’ç”¨æˆ·å¤´åƒ
   - é€‰æ‹©"è®¾ç½®"

2. **ä¿®æ”¹è®¾ç½®**
   - åœ¨å„ä¸ª Tab ä¹‹é—´åˆ‡æ¢
   - ä¿®æ”¹éœ€è¦çš„é€‰é¡¹

3. **ä¿å­˜è®¾ç½®**
   - ç‚¹å‡»"ä¿å­˜è®¾ç½®"æŒ‰é’®
   - ç­‰å¾…æˆåŠŸæç¤º

4. **åº”ç”¨è®¾ç½®**
   - éƒ¨åˆ†è®¾ç½®ç«‹å³ç”Ÿæ•ˆ
   - å…¶ä»–è®¾ç½®åˆ·æ–°é¡µé¢åç”Ÿæ•ˆ

---

## ğŸ”„ æ•°æ®æµç¨‹

```
ç”¨æˆ·æ‰“å¼€è®¾ç½®æ¨¡æ€æ¡†
    â†“
å‰ç«¯å‘é€ GET è¯·æ±‚ â†’ /get_calendar/user_settings/
    â†“
åç«¯æŸ¥è¯¢ UserData (key="user_preference")
    â†“
è¿”å› JSON æ•°æ® â†’ å‰ç«¯
    â†“
å¡«å……è¡¨å•å­—æ®µ
    â†“
ç”¨æˆ·ä¿®æ”¹è®¾ç½®
    â†“
ç‚¹å‡»"ä¿å­˜è®¾ç½®"
    â†“
å‰ç«¯å‘é€ POST è¯·æ±‚ï¼ˆJSONï¼‰â†’ /get_calendar/user_settings/
    â†“
åç«¯éªŒè¯æ•°æ®ï¼ˆä½¿ç”¨ DATA_SCHEMAï¼‰
    â†“
ä¿å­˜åˆ°æ•°æ®åº“
    â†“
è¿”å›æˆåŠŸå“åº” â†’ å‰ç«¯
    â†“
æ˜¾ç¤ºæˆåŠŸæç¤º + åº”ç”¨éƒ¨åˆ†è®¾ç½®
```

---

## ğŸ§ª æµ‹è¯•å»ºè®®

### åŠŸèƒ½æµ‹è¯•æ¸…å•

- [ ] **å¸®åŠ©æŒ‰é’®**: ç‚¹å‡»åè·³è½¬åˆ° `/help/` é¡µé¢
- [ ] **é€€å‡ºæŒ‰é’®**: ç‚¹å‡»åé€€å‡ºç™»å½•å¹¶è·³è½¬åˆ°é¦–é¡µ
- [ ] **è®¾ç½®æŒ‰é’®**: ç‚¹å‡»åæ‰“å¼€è®¾ç½®æ¨¡æ€æ¡†
- [ ] **è®¾ç½®åŠ è½½**: æ¨¡æ€æ¡†æ‰“å¼€æ—¶æ­£ç¡®åŠ è½½å½“å‰è®¾ç½®
- [ ] **è®¾ç½®ä¿å­˜**: ä¿®æ”¹åä¿å­˜ï¼Œåˆ·æ–°é¡µé¢åè®¾ç½®ä»ç„¶ä¿ç•™
- [ ] **æ•°æ®éªŒè¯**: è¾“å…¥æ— æ•ˆæ•°æ®ï¼ˆå¦‚è¶…å‡ºèŒƒå›´çš„æ•°å­—ï¼‰æ—¶çš„å¤„ç†
- [ ] **ç«‹å³ç”Ÿæ•ˆ**: ä¿®æ”¹æ—¥å†è§†å›¾ã€å‘¨æœ«æ˜¾ç¤ºç­‰è®¾ç½®åç«‹å³çœ‹åˆ°æ•ˆæœ
- [ ] **å“åº”å¼**: åœ¨ä¸åŒå±å¹•å°ºå¯¸ä¸‹æµ‹è¯•UIæ˜¾ç¤º
- [ ] **Toast æç¤º**: å„ç§æ“ä½œåæ˜¯å¦æ˜¾ç¤ºæ­£ç¡®çš„æç¤ºæ¶ˆæ¯
- [ ] **Tab åˆ‡æ¢**: åœ¨ä¸åŒ Tab ä¹‹é—´åˆ‡æ¢æ˜¯å¦æµç•…

### è¾¹ç•Œæƒ…å†µæµ‹è¯•

- [ ] é¦–æ¬¡ä½¿ç”¨ç”¨æˆ·ï¼ˆæ²¡æœ‰ä¿å­˜è¿‡è®¾ç½®ï¼‰
- [ ] ç½‘ç»œé”™è¯¯æ—¶çš„å¤„ç†
- [ ] æœåŠ¡å™¨è¿”å›é”™è¯¯æ—¶çš„å¤„ç†
- [ ] åŒæ—¶æ‰“å¼€å¤šä¸ªæµè§ˆå™¨çª—å£
- [ ] è®¾ç½®ä¸­åŒ…å«ç‰¹æ®Šå­—ç¬¦

---

## ğŸš€ æœªæ¥æ‰©å±•è®¡åˆ’

### å³å°†å®ç°çš„åŠŸèƒ½ï¼ˆæ ‡æ³¨ä¸º"å³å°†æ¨å‡º"ï¼‰

1. **ä¸»é¢˜æ¨¡å¼**
   - æ·±è‰²æ¨¡å¼æ”¯æŒ
   - è·Ÿéšç³»ç»Ÿä¸»é¢˜è‡ªåŠ¨åˆ‡æ¢
   - è‡ªå®šä¹‰ä¸»é¢˜é¢œè‰²

2. **æ—¥ç¨‹é¢œè‰²æ–¹æ¡ˆ**
   - æŒ‰ä¼˜å…ˆçº§ç€è‰²
   - æŒ‰ç±»å‹ç€è‰²
   - è‡ªå®šä¹‰é¢œè‰²æ˜ å°„

3. **æé†’å£°éŸ³**
   - é€‰æ‹©ä¸åŒçš„æé†’éŸ³æ•ˆ
   - è°ƒæ•´éŸ³é‡
   - é™éŸ³æ¨¡å¼

4. **AI è‡ªåŠ¨å»ºè®®**
   - æ™ºèƒ½åˆ†ææ—¥ç¨‹å†²çª
   - æ¨èæœ€ä½³æ—¶é—´å®‰æ’
   - è‡ªåŠ¨ç”Ÿæˆå¾…åŠäº‹é¡¹

### å¯èƒ½çš„æ‰©å±•

1. **æ—¶åŒºè®¾ç½®**: æ”¯æŒä¸åŒæ—¶åŒºçš„ç”¨æˆ·
2. **è¯­è¨€è®¾ç½®**: å¤šè¯­è¨€ç•Œé¢åˆ‡æ¢
3. **å¯¼å‡ºè®¾ç½®**: å¯¼å‡º/å¯¼å…¥ç”¨æˆ·é…ç½®
4. **å¿«æ·é”®è®¾ç½®**: è‡ªå®šä¹‰é”®ç›˜å¿«æ·é”®
5. **é€šçŸ¥è®¾ç½®**: æµè§ˆå™¨é€šçŸ¥ã€é‚®ä»¶é€šçŸ¥ç­‰

---

## ğŸ“‚ ç›¸å…³æ–‡ä»¶æ¸…å•

### åç«¯æ–‡ä»¶
- `core/models.py` - æ•°æ®æ¨¡å‹å’Œ DATA_SCHEMA
- `core/views.py` - API è§†å›¾å‡½æ•°
- `core/urls.py` - è·¯ç”±é…ç½®

### å‰ç«¯æ–‡ä»¶
- `core/templates/home_new.html` - ä¸»é¡µé¢ï¼ˆåŒ…å«è®¾ç½®æ¨¡æ€æ¡†å’Œ JavaScriptï¼‰
- `core/templates/help.html` - å¸®åŠ©æ–‡æ¡£é¡µé¢

### æ–‡æ¡£æ–‡ä»¶
- `docs/ç”¨æˆ·è®¾ç½®åŠŸèƒ½å®ç°æ–‡æ¡£.md` - æœ¬æ–‡æ¡£

---

## ğŸ› å·²çŸ¥é—®é¢˜

ç›®å‰æ²¡æœ‰å·²çŸ¥çš„ä¸¥é‡é—®é¢˜ã€‚

---

## ğŸ“ æ”¯æŒä¸åé¦ˆ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š
- GitHub Issues: [MoMoJee/UniSchedulerSuper](https://github.com/MoMoJee/UniSchedulerSuper)
- é‚®ç®±: support@unischeduler.com

---

**æ–‡æ¡£ç»´æŠ¤è€…**: GitHub Copilot  
**æœ€åæ›´æ–°**: 2025å¹´11æœˆ2æ—¥
