# æ—¥å†è§¦å±æ»‘åŠ¨åŠ¨æ•ˆä¼˜åŒ–æ–‡æ¡£

## ğŸ“… æ›´æ–°æ—¥æœŸ
2025å¹´11æœˆ4æ—¥

## ğŸ¯ ä¼˜åŒ–ç›®æ ‡
ä¸ºæ—¥å†è§¦å±æ»‘åŠ¨åŠŸèƒ½æ·»åŠ æµç•…çš„è§†è§‰åé¦ˆå’Œè¿‡æ¸¡åŠ¨ç”»ï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚

## âœ¨ æ–°å¢åŠŸèƒ½

### 1. å®æ—¶è·Ÿéšæ•ˆæœ
**åŠŸèƒ½æè¿°ï¼š**
- åœ¨æ»‘åŠ¨è¿‡ç¨‹ä¸­ï¼Œæ—¥å†ä¼šå®æ—¶è·Ÿéšæ‰‹æŒ‡ç§»åŠ¨
- æä¾›å³æ—¶çš„è§†è§‰åé¦ˆï¼Œè®©ç”¨æˆ·æ¸…æ¥šåœ°çœ‹åˆ°æ»‘åŠ¨è¿›åº¦

**å®ç°ç»†èŠ‚ï¼š**
- ä½¿ç”¨ CSS `transform: translateX()` å®ç°ä½ç§»
- åº”ç”¨é˜»å°¼ç³»æ•°ï¼ˆ0.3ï¼‰ä½¿ç§»åŠ¨æ›´å¹³æ»‘è‡ªç„¶
- é™åˆ¶æœ€å¤§è·Ÿéšè·ç¦»ï¼ˆ100pxï¼‰é¿å…æ»‘åŠ¨è¿‡è¿œ
- éšæ»‘åŠ¨è·ç¦»åŠ¨æ€è°ƒæ•´é€æ˜åº¦ï¼ˆ1.0 â†’ 0.85ï¼‰

**ä»£ç ä½ç½®ï¼š**
```javascript
applyFollowEffect(deltaX) {
    // é˜»å°¼ç³»æ•°è®¡ç®—
    const dampedDistance = deltaX * this.config.followDamping;
    
    // é™åˆ¶æœ€å¤§è·ç¦»
    const clampedDistance = Math.max(
        -this.config.maxFollowDistance,
        Math.min(this.config.maxFollowDistance, dampedDistance)
    );
    
    // é€æ˜åº¦å˜åŒ–
    const opacity = 1 - (Math.abs(clampedDistance) / this.config.maxFollowDistance) * 0.15;
    
    // åº”ç”¨æ•ˆæœ
    this.calendarEl.style.transform = `translateX(${clampedDistance}px)`;
    this.calendarEl.style.opacity = opacity;
}
```

### 2. å¹³æ»‘åˆ‡æ¢åŠ¨ç”»
**åŠŸèƒ½æè¿°ï¼š**
- å½“æ»‘åŠ¨è·ç¦»è¶³å¤Ÿæ—¶ï¼Œæ‰§è¡Œä¸¤æ®µå¼åˆ‡æ¢åŠ¨ç”»
- ç¬¬ä¸€æ®µï¼šå½“å‰æ—¥å†å‘æ»‘åŠ¨æ–¹å‘æ»‘å‡ºå¹¶æ·¡åŒ–
- ç¬¬äºŒæ®µï¼šæ–°æ—¥å†ä»ç›¸åæ–¹å‘æ»‘å…¥å¹¶æ¢å¤

**åŠ¨ç”»æµç¨‹ï¼š**
```
å‘å·¦æ»‘åŠ¨åˆ‡æ¢åˆ°ä¸‹ä¸€æœˆï¼š
1. å½“å‰æœˆä»½å‘å·¦æ»‘å‡º (-100px) + é€æ˜åº¦é™è‡³ 0.7  [175ms]
2. æ‰§è¡Œæ—¥å†åˆ‡æ¢ï¼ˆè°ƒç”¨ calendar.next()ï¼‰
3. ä¸‹ä¸€æœˆä»½ä»å³ä¾§æ»‘å…¥ (+80px â†’ 0) + é€æ˜åº¦å‡è‡³ 1.0  [350ms]
```

**æ—¶é—´æ›²çº¿ï¼š**
- ä½¿ç”¨ `cubic-bezier(0.4, 0, 0.2, 1)` å®ç°æµç•…çš„ç¼“åŠ¨æ•ˆæœ
- æ€»è€—æ—¶ï¼šçº¦ 525msï¼ˆæ»‘å‡º 175ms + æ»‘å…¥ 350msï¼‰

**ä»£ç ä½ç½®ï¼š**
```javascript
performSwitch(direction) {
    // ç¬¬ä¸€é˜¶æ®µï¼šæ»‘å‡º
    this.calendarEl.style.transform = `translateX(${slideDistance})`;
    this.calendarEl.style.opacity = '0.7';
    
    setTimeout(() => {
        // åˆ‡æ¢å†…å®¹
        this.calendar[direction]();
        
        // ç¬¬äºŒé˜¶æ®µï¼šæ»‘å…¥
        this.calendarEl.style.transform = 'translateX(0)';
        this.calendarEl.style.opacity = '1';
    }, duration * 0.5);
}
```

### 3. å›å¼¹åŠ¨ç”»
**åŠŸèƒ½æè¿°ï¼š**
- å½“æ»‘åŠ¨è·ç¦»ä¸è¶³ï¼ˆ< 50pxï¼‰æ—¶ï¼Œè§¦å‘å›å¼¹æ•ˆæœ
- æ—¥å†å¹³æ»‘è¿”å›åŸä½ï¼Œä¸æ‰§è¡Œåˆ‡æ¢

**åŠ¨ç”»ç‰¹ç‚¹ï¼š**
- ä½¿ç”¨å¼¹æ€§ç¼“åŠ¨æ›²çº¿ `cubic-bezier(0.34, 1.56, 0.64, 1)`
- äº§ç”Ÿè½»å¾®çš„"å¼¹ç°§"æ•ˆæœï¼Œæ›´æœ‰è¶£å‘³æ€§
- è€—æ—¶ 300ms

**ä»£ç ä½ç½®ï¼š**
```javascript
bounceBack() {
    this.calendarEl.style.transition = `transform 300ms cubic-bezier(0.34, 1.56, 0.64, 1)`;
    this.calendarEl.style.transform = 'translateX(0)';
    this.calendarEl.style.opacity = '1';
}
```

### 4. æ–¹å‘æç¤ºä¼˜åŒ–
**åŠŸèƒ½æè¿°ï¼š**
- åœ¨æ»‘åŠ¨è¿‡ç¨‹ä¸­æ˜¾ç¤ºæ–¹å‘æç¤ºç®­å¤´
- ä»…åœ¨æ»‘åŠ¨è·ç¦»æ¥è¿‘è§¦å‘é˜ˆå€¼ï¼ˆ60%ï¼‰æ—¶æ˜¾ç¤º
- æç¤ºç”¨æˆ·å³å°†è§¦å‘åˆ‡æ¢

**æ˜¾ç¤ºé€»è¾‘ï¼š**
```javascript
showDirectionHint(deltaX) {
    const absDistance = Math.abs(deltaX);
    
    // æ»‘åŠ¨è·ç¦» > 30px æ—¶æ˜¾ç¤ºæç¤ºï¼ˆ50px * 0.6ï¼‰
    if (absDistance > this.config.minSwipeDistance * 0.6) {
        this.showSwipeIndicator(direction, true);  // æŒç»­æ˜¾ç¤º
    } else {
        this.hideSwipeIndicator();  // éšè—æç¤º
    }
}
```

## ğŸ¨ è§†è§‰æ•ˆæœæ€»ç»“

| åœºæ™¯ | è§†è§‰åé¦ˆ | åŠ¨ç”»æ—¶é•¿ | æ•ˆæœæè¿° |
|------|----------|----------|----------|
| **æ»‘åŠ¨ä¸­** | å®æ—¶è·Ÿéš | å³æ—¶ | æ—¥å†è·Ÿéšæ‰‹æŒ‡ç§»åŠ¨ï¼Œé€æ˜åº¦å¾®é™ |
| **æ¥è¿‘é˜ˆå€¼** | æ˜¾ç¤ºç®­å¤´ | å³æ—¶ | è“è‰²åœ†å½¢ç®­å¤´æç¤ºæ–¹å‘ |
| **è§¦å‘åˆ‡æ¢** | æ»‘å‡º+æ»‘å…¥ | 525ms | å½“å‰æœˆæ»‘å‡ºï¼Œæ–°æœˆæ»‘å…¥ |
| **æ»‘åŠ¨ä¸è¶³** | å›å¼¹ | 300ms | å¼¹æ€§è¿”å›åŸä½ |

## âš™ï¸ é…ç½®å‚æ•°

```javascript
config = {
    minSwipeDistance: 50,        // æœ€å°æ»‘åŠ¨è·ç¦»ï¼ˆåƒç´ ï¼‰
    maxVerticalDistance: 100,    // å‚ç›´æ–¹å‘æœ€å¤§åç§»ï¼ˆåƒç´ ï¼‰
    swipeAngleThreshold: 30,     // æ»‘åŠ¨è§’åº¦é˜ˆå€¼ï¼ˆåº¦ï¼‰
    followDamping: 0.3,          // è·Ÿéšé˜»å°¼ç³»æ•°ï¼ˆ0-1ï¼‰
    maxFollowDistance: 100,      // æœ€å¤§è·Ÿéšè·ç¦»ï¼ˆåƒç´ ï¼‰
    bounceBackDuration: 300,     // å›å¼¹åŠ¨ç”»æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰
    switchDuration: 350          // åˆ‡æ¢åŠ¨ç”»æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰
}
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. GPU åŠ é€Ÿ
- ä½¿ç”¨ `transform` è€Œé `left/right` å±æ€§
- è§¦å‘ GPU åˆæˆå±‚ï¼Œé¿å…é‡æ’ï¼ˆreflowï¼‰

### 2. é˜²æ­¢åŠ¨ç”»å†²çª
- æ·»åŠ  `isAnimating` æ ‡å¿—é˜²æ­¢åŠ¨ç”»å åŠ 
- åœ¨åŠ¨ç”»è¿›è¡Œæ—¶å¿½ç•¥æ–°çš„è§¦æ‘¸äº‹ä»¶

### 3. å¼ºåˆ¶é‡æ’ä¼˜åŒ–
```javascript
// åœ¨è®¾ç½®åˆå§‹çŠ¶æ€åå¼ºåˆ¶é‡æ’ï¼Œç¡®ä¿åŠ¨ç”»ç”Ÿæ•ˆ
this.calendarEl.offsetHeight;
```

### 4. requestAnimationFrame
```javascript
requestAnimationFrame(() => {
    // åœ¨ä¸‹ä¸€å¸§æ‰§è¡ŒåŠ¨ç”»
    this.calendarEl.style.transform = 'translateX(0)';
});
```

## ğŸ”„ åŠ¨ç”»çŠ¶æ€æœº

```
[é™æ­¢çŠ¶æ€]
    â†“ touchstart
[å‡†å¤‡çŠ¶æ€] (ç§»é™¤ transition)
    â†“ touchmove (æ°´å¹³æ»‘åŠ¨)
[è·ŸéšçŠ¶æ€] (å®æ—¶æ›´æ–° transform)
    â†“ è·ç¦» > 60% é˜ˆå€¼
[æç¤ºçŠ¶æ€] (æ˜¾ç¤ºæ–¹å‘ç®­å¤´)
    â†“ touchend
    â”œâ”€ è·ç¦» > 50px â†’ [åˆ‡æ¢åŠ¨ç”»] â†’ [é™æ­¢çŠ¶æ€]
    â””â”€ è·ç¦» < 50px â†’ [å›å¼¹åŠ¨ç”»] â†’ [é™æ­¢çŠ¶æ€]
```

## ğŸ¯ ç”¨æˆ·ä½“éªŒæå‡

### Beforeï¼ˆä¼˜åŒ–å‰ï¼‰
- âŒ æ»‘åŠ¨æ—¶æ— ä»»ä½•è§†è§‰åé¦ˆ
- âŒ åˆ‡æ¢ç¬é—´å®Œæˆï¼Œè¿‡äºç”Ÿç¡¬
- âŒ æ— æ³•é¢„çŸ¥æ˜¯å¦ä¼šè§¦å‘åˆ‡æ¢

### Afterï¼ˆä¼˜åŒ–åï¼‰
- âœ… æ»‘åŠ¨æ—¶æ—¥å†å®æ—¶è·Ÿéšæ‰‹æŒ‡
- âœ… å¹³æ»‘çš„æ·¡å…¥æ·¡å‡ºåˆ‡æ¢æ•ˆæœ
- âœ… æ–¹å‘ç®­å¤´æç¤ºå³å°†è§¦å‘
- âœ… æ»‘åŠ¨ä¸è¶³æ—¶è‡ªç„¶å›å¼¹

## ğŸ§ª æµ‹è¯•å»ºè®®

### åŸºç¡€åŠŸèƒ½æµ‹è¯•
1. **æ…¢é€Ÿæ»‘åŠ¨**ï¼šè§‚å¯Ÿå®æ—¶è·Ÿéšæ•ˆæœæ˜¯å¦æµç•…
2. **å¿«é€Ÿæ»‘åŠ¨**ï¼šç¡®è®¤åˆ‡æ¢åŠ¨ç”»å®Œæ•´æ’­æ”¾
3. **çŸ­è·ç¦»æ»‘åŠ¨**ï¼šéªŒè¯å›å¼¹åŠ¨ç”»æ˜¯å¦è‡ªç„¶
4. **è¿ç»­æ»‘åŠ¨**ï¼šæ£€æŸ¥ `isAnimating` é”æ˜¯å¦æœ‰æ•ˆ

### è¾¹ç•Œæƒ…å†µæµ‹è¯•
1. **æ–œå‘æ»‘åŠ¨**ï¼šç¡®è®¤åªè§¦å‘æ°´å¹³è·Ÿéš
2. **å¤šæŒ‡è§¦æ‘¸**ï¼šåº”å¿½ç•¥éå•æŒ‡æ“ä½œ
3. **åŠ¨ç”»ä¸­è§¦æ‘¸**ï¼šåº”å¿½ç•¥æ–°çš„æ»‘åŠ¨
4. **å·¥å…·æ åŒºåŸŸ**ï¼šä¸åº”è§¦å‘æ»‘åŠ¨æ•ˆæœ

### æ€§èƒ½æµ‹è¯•
1. æ‰“å¼€ Chrome DevTools â†’ Performance
2. å½•åˆ¶æ»‘åŠ¨æ“ä½œ
3. æ£€æŸ¥ FPS æ˜¯å¦ç¨³å®šåœ¨ 60fps
4. ç¡®è®¤æ²¡æœ‰è§¦å‘ layoutï¼ˆé‡æ’ï¼‰

## ğŸ“ ä»£ç å˜æ›´æ€»ç»“

### æ–°å¢å±æ€§
```javascript
this.calendarEl = null;        // ç¼“å­˜æ—¥å†å…ƒç´ 
this.isAnimating = false;      // åŠ¨ç”»çŠ¶æ€é”
```

### æ–°å¢é…ç½®
```javascript
followDamping: 0.3,           // è·Ÿéšé˜»å°¼
maxFollowDistance: 100,       // æœ€å¤§è·Ÿéšè·ç¦»
bounceBackDuration: 300,      // å›å¼¹æ—¶é•¿
switchDuration: 350           // åˆ‡æ¢æ—¶é•¿
```

### æ–°å¢æ–¹æ³•
```javascript
applyFollowEffect(deltaX)     // åº”ç”¨è·Ÿéšæ•ˆæœ
showDirectionHint(deltaX)     // æ˜¾ç¤ºæ–¹å‘æç¤º
performSwitch(direction)      // æ‰§è¡Œåˆ‡æ¢åŠ¨ç”»
bounceBack()                  // å›å¼¹åŠ¨ç”»
resetCalendarStyle()          // é‡ç½®æ ·å¼
hideSwipeIndicator()          // éšè—æŒ‡ç¤ºå™¨
```

### ä¿®æ”¹æ–¹æ³•
```javascript
handleTouchStart()   // ç§»é™¤ transitionï¼Œå‡†å¤‡è·Ÿéš
handleTouchMove()    // è°ƒç”¨ applyFollowEffect
handleTouchEnd()     // è°ƒç”¨ performSwitch æˆ– bounceBack
showSwipeIndicator() // æ”¯æŒæŒç»­æ˜¾ç¤ºæ¨¡å¼
```

## ğŸš€ æœªæ¥ä¼˜åŒ–æ–¹å‘

1. **å¯é…ç½®æ€§å¢å¼º**
   - å…è®¸ç”¨æˆ·è‡ªå®šä¹‰åŠ¨ç”»æ—¶é•¿
   - æä¾›å¤šç§åŠ¨ç”»æ›²çº¿é€‰æ‹©

2. **é«˜çº§åŠ¨æ•ˆ**
   - æ·»åŠ è§†å·®æ»šåŠ¨æ•ˆæœ
   - å®ç° 3D ç¿»é¡µåŠ¨ç”»ï¼ˆå¯é€‰ï¼‰

3. **è§¦è§‰åé¦ˆ**
   - åœ¨æ”¯æŒçš„è®¾å¤‡ä¸Šæ·»åŠ éœ‡åŠ¨åé¦ˆ
   - ä½¿ç”¨ Vibration API

4. **æ— éšœç¢ä¼˜åŒ–**
   - æ·»åŠ  ARIA å±æ€§
   - æ”¯æŒè¯­éŸ³æç¤º

## ğŸ“š ç›¸å…³æ–‡ä»¶

- æºä»£ç ï¼š`core/static/js/calendar-touch-swipe.js`
- é™æ€æ–‡ä»¶ï¼š`staticfiles/js/calendar-touch-swipe.js`
- åŠŸèƒ½æ–‡æ¡£ï¼š`docs/æ—¥å†è§¦å±æ»‘åŠ¨åŠŸèƒ½å®ç°æ–‡æ¡£.md`
- æµ‹è¯•æŒ‡å—ï¼š`docs/æ—¥å†è§¦å±æ»‘åŠ¨æµ‹è¯•æŒ‡å—.md`

## ğŸ‰ æ€»ç»“

æ­¤æ¬¡ä¼˜åŒ–ä¸ºæ—¥å†æ»‘åŠ¨åŠŸèƒ½æ·»åŠ äº†å®Œæ•´çš„è§†è§‰åé¦ˆç³»ç»Ÿï¼ŒåŒ…æ‹¬ï¼š
- âœ¨ å®æ—¶è·Ÿéšæ•ˆæœè®©ç”¨æˆ·èƒ½ç›´è§‚æ„Ÿå—æ»‘åŠ¨è¿›åº¦
- ğŸ¬ å¹³æ»‘çš„åˆ‡æ¢åŠ¨ç”»æå‡äº†ç•Œé¢çš„ä¸“ä¸šæ„Ÿ
- ğŸ”„ è‡ªç„¶çš„å›å¼¹æ•ˆæœå¢å¼ºäº†äº¤äº’çš„è¶£å‘³æ€§
- ğŸ¯ æ™ºèƒ½çš„æ–¹å‘æç¤ºå¸®åŠ©ç”¨æˆ·é¢„çŸ¥æ“ä½œç»“æœ

è¿™äº›æ”¹è¿›ä½¿è§¦å±æ»‘åŠ¨ä½“éªŒæ›´æ¥è¿‘åŸç”Ÿç§»åŠ¨åº”ç”¨ï¼Œå¤§å¹…æå‡äº†æ•´ä½“ç”¨æˆ·ä½“éªŒã€‚
