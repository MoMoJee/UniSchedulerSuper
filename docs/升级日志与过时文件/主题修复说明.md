# 主题系统修复说明

## 问题描述
创意主题(中国红、淡暖色、淡冷色、马卡龙、多巴胺)与浅色主题看起来没有区别。

## 问题原因
CSS变量已正确定义,但**组件样式只针对`[data-theme="dark"]`**,没有应用到其他主题。

例如:
```css
/* ❌ 只有dark主题会应用 */
[data-theme="dark"] .card {
    background-color: var(--card-bg);
}

/* 其他主题的.card仍然使用Bootstrap默认的白色背景 */
```

## 解决方案
将所有组件样式改为**通用样式**,让所有元素直接使用CSS变量,而不是只在特定主题下覆盖。

### 修改前
```css
/* 深色模式组件适配 */
[data-theme="dark"] .card {
    background-color: var(--card-bg);
    border-color: var(--border-color);
}
```

### 修改后
```css
/* 通用组件样式 - 使用CSS变量 */
.card {
    background-color: var(--card-bg);
    border-color: var(--border-color);
    color: var(--text-primary);
}
```

## 修改内容

### 1. 通用组件样式 (已添加)
在全局样式区域添加以下通用规则:

**Bootstrap组件**:
- `.card` - 卡片背景和边框
- `.modal-content` - 模态框内容
- `.modal-header` - 模态框头部
- `.modal-footer` - 模态框底部
- `.form-control` - 表单输入框
- `.form-select` - 下拉选择框
- `.input-group-text` - 输入组文本
- `.dropdown-menu` - 下拉菜单
- `.dropdown-item` - 下拉菜单项
- `.btn-primary` - 主按钮
- `.list-group-item` - 列表组项
- `.navbar` - 导航栏

**FullCalendar组件**:
- `.fc` - 日历主容器
- `.fc-theme-standard td/th` - 表格单元格
- `.fc-scrollgrid` - 滚动网格
- `.fc-col-header-cell` - 列头单元格
- `.fc-daygrid-day` - 日视图单元格
- `.fc-timegrid-slot` - 时间格子
- `.fc-day-today` - 今日高亮
- `.fc-event` - 日程事件
- `.fc-highlight` - 选择高亮

**其他组件**:
- `#calendar` - 日历容器
- `.header` - 页面头部

### 2. 修改的文件
- `core/static/css/home-styles.css`
  - 行 488-640: 添加通用组件样式
  - 所有组件现在直接使用CSS变量

### 3. CSS变量工作原理
每个主题在 `:root` 或 `[data-theme="xxx"]` 下定义变量:

```css
[data-theme="china-red"] {
    --bg-primary: #fffef8;  /* 米白色 */
    --primary: #de2910;      /* 中国红 */
    --navbar-bg: #de2910;    /* 导航栏红色 */
    --card-bg: #ffffff;      /* 卡片白色 */
    --fc-bg: #fffef8;        /* 日历米白 */
    /* ... 60+个变量 */
}
```

组件直接使用这些变量:
```css
.card {
    background-color: var(--card-bg);  /* 自动使用当前主题的值 */
}
```

当切换主题时,`data-theme`属性改变,所有变量值自动更新,组件样式随之改变。

## 测试步骤

1. **刷新页面** (Ctrl+F5 强制刷新)
2. 打开**设置** → 找到**主题模式**
3. 依次选择每个主题,观察变化:

### 预期效果

#### 🇨🇳 中国红
- 背景: 温暖米白色
- 导航栏: 中国红色,金黄文字
- 按钮: 中国红主按钮
- 日历: 米白色背景,红色事件

#### 🌸 淡暖色
- 背景: 柔和粉白色
- 导航栏: 粉红色
- 按钮: 粉色主按钮
- 日历: 粉白背景,粉色事件

#### ❄️ 淡冷色
- 背景: 清新浅蓝绿
- 导航栏: 薄荷蓝色
- 按钮: 蓝绿主按钮
- 日历: 清爽蓝白背景,蓝绿事件

#### 🍰 马卡龙
- 背景: 奶白色
- 导航栏: 淡紫色
- 按钮: 淡紫主按钮
- 日历: 奶白背景,马卡龙色事件

#### ⚡ 多巴胺
- 背景: 明亮白色
- 导航栏: **渐变色** (橙→粉→紫)
- 按钮: 活力橙主按钮
- 日历: 白色背景,鲜艳橙色事件

## 技术要点

### 1. CSS变量的层叠性
```css
:root {
    --primary: blue;  /* 默认 */
}

[data-theme="red"] {
    --primary: red;   /* red主题下覆盖 */
}

.btn {
    color: var(--primary);  /* 使用当前作用域的值 */
}
```

### 2. 渐变色支持
多巴胺主题的navbar使用渐变:
```css
[data-theme="dopamine"] {
    --navbar-bg: linear-gradient(135deg, #ff6b35 0%, #ff006e 50%, #8338ec 100%);
}
```

应用时:
```css
.navbar {
    background: var(--navbar-bg) !important;
}
```

### 3. 优先级处理
某些需要 `!important` 确保变量生效:
```css
.navbar {
    background: var(--navbar-bg) !important;  /* 覆盖Bootstrap默认样式 */
}
```

## 后续优化建议

1. **简化选择器**: 未来可以考虑使用 CSS `:where()` 伪类减少重复
2. **主题预览**: 添加主题预览缩略图
3. **自定义主题**: 允许用户自定义颜色变量
4. **主题导出**: 支持导出/导入主题配置

## 版本记录
- **v20251103-003** (2025-11-03): 修复创意主题不生效的问题,将组件样式改为通用CSS变量

---

**修复者**: GitHub Copilot  
**日期**: 2025年11月3日
