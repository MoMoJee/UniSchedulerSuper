# 月视图显示问题修复文档

## 问题描述

### 症状
- 月视图(dayGridMonth)无法正常显示完整内容
- 只显示第一行日期,其余行被隐藏
- 从周视图切换到月视图时,先正确渲染一瞬间,然后就不正常了

### 日志分析
```javascript
event-manager.js:195 设置全天槽滚动器(包含daygrid-body): <div class="fc-scroller...">
event-manager.js:218 识别并设置全天槽滚动器: <div class="fc-scroller...">
```

日志显示代码将月视图的滚动容器强制设置为50px高度并隐藏溢出。

## 根本原因

在 `event-manager.js` 的 `forceScrollable()` 函数中,代码逻辑存在问题:

```javascript
// 原有问题代码
const daygridScrollers = document.querySelectorAll('.fc-scroller:has(.fc-daygrid-body)');
daygridScrollers.forEach((scroller) => {
    // 无论什么视图,都强制限制为50px
    scroller.style.setProperty('overflow', 'hidden', 'important');
    scroller.style.setProperty('max-height', '50px', 'important');
    scroller.style.setProperty('height', '50px', 'important');
    scroller.style.setProperty('flex', '0 0 50px', 'important');
});
```

**问题分析:**
1. 代码将所有包含 `.fc-daygrid-body` 的滚动器都设置为50px固定高度
2. 没有区分月视图(dayGridMonth)和其他视图中的全天槽(all-day slot)
3. 月视图需要完整显示整个月的日历网格,而不是只显示50px

## 修复方案

### 修改位置
文件: `d:\PROJECTS\UniSchedulerSuper\core\static\js\event-manager.js`
函数: `forceScrollable()`

### 修复逻辑

1. **获取当前视图类型**
```javascript
const currentView = this.calendar ? this.calendar.view.type : null;
```

2. **区分处理不同场景**
```javascript
if (hasDaygridBody) {
    // 检查是否是月视图
    if (currentView === 'dayGridMonth') {
        // 月视图：让daygrid-body正常显示，可以滚动
        scroller.style.overflowY = 'auto';
        scroller.style.overflowX = 'hidden';
        scroller.style.maxHeight = 'none';
        scroller.style.height = '100%';
        scroller.style.flex = '1';
        console.log('识别并设置月视图滚动器（允许完整显示）:', scroller);
    } else {
        // 其他视图中的全天槽：限制高度为50px
        scroller.style.setProperty('overflow', 'hidden', 'important');
        scroller.style.setProperty('max-height', '50px', 'important');
        scroller.style.setProperty('height', '50px', 'important');
        scroller.style.setProperty('flex', '0 0 50px', 'important');
        console.log('识别并设置全天槽滚动器（限制高度）:', scroller);
    }
}
```

### 修复效果

- ✅ 月视图可以完整显示整个月的日历网格
- ✅ 月视图支持垂直滚动(如果内容超出容器高度)
- ✅ 周视图/日视图的全天槽仍然限制为50px高度
- ✅ 不同视图之间切换正常

## FullCalendar视图结构说明

### 月视图 (dayGridMonth)
```
.fc-view-harness
  └── .fc-scroller
      └── .fc-daygrid-body  ← 整个月的日历网格
          └── table
              └── 多行日期单元格
```

### 周视图/日视图 (timeGridWeek/timeGridDay)
```
.fc-view-harness
  ├── .fc-scroller (全天槽)
  │   └── .fc-daygrid-body  ← 全天事件区域(应限制50px)
  └── .fc-scroller (时间网格)
      └── .fc-timegrid-slots  ← 时间槽区域(应可滚动)
```

## 关键区别

| 视图类型 | .fc-daygrid-body 作用 | 应该的显示方式 |
|---------|---------------------|--------------|
| dayGridMonth | 整个月历网格主体 | 完整显示,可滚动 |
| timeGridWeek/Day | 全天事件槽 | 限制高度50px |

## 测试验证

### 测试步骤
1. 启动项目,登录系统
2. 切换到月视图
3. 观察是否显示完整月历
4. 切换到周视图
5. 观察全天槽是否正常限制为50px
6. 来回切换视图,确认都正常

### 预期结果
- 月视图显示完整的月历网格
- 周视图/日视图的全天槽限制在50px
- 视图切换流畅无闪烁

## 相关文件

- `d:\PROJECTS\UniSchedulerSuper\core\static\js\event-manager.js`
- `d:\PROJECTS\UniSchedulerSuper\core\templates\home_new.html`

## 日期

修复日期: 2025-10-30
修复人员: AI Assistant
