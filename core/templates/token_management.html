<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Token ç®¡ç† - UniSchedulerSuper</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 800px;
            width: 100%;
            padding: 40px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #333;
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 14px;
        }

        .user-info {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .user-info h2 {
            color: #333;
            font-size: 18px;
            margin-bottom: 10px;
        }

        .user-info p {
            color: #666;
            margin: 5px 0;
        }

        .token-section {
            background: #fff8e1;
            border-left: 4px solid #ffc107;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .token-section h3 {
            color: #f57c00;
            font-size: 16px;
            margin-bottom: 15px;
        }

        .token-display {
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            word-break: break-all;
            margin-bottom: 15px;
            position: relative;
        }

        .token-value {
            color: #333;
            font-size: 14px;
        }

        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #667eea;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .copy-btn:hover {
            background: #5568d3;
        }

        .copy-btn.copied {
            background: #4caf50;
        }

        .usage-example {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .usage-example h3 {
            color: #2e7d32;
            font-size: 16px;
            margin-bottom: 15px;
        }

        .code-block {
            background: #263238;
            color: #aed581;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
            margin: 10px 0;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .btn {
            flex: 1;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-warning {
            background: #ff9800;
            color: white;
        }

        .btn-warning:hover {
            background: #f57c00;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 152, 0, 0.4);
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-danger:hover {
            background: #d32f2f;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(244, 67, 54, 0.4);
        }

        .back-link {
            display: inline-block;
            margin-top: 20px;
            color: #667eea;
            text-decoration: none;
            font-size: 14px;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        .warning {
            background: #ffebee;
            border-left: 4px solid #f44336;
            padding: 15px;
            border-radius: 6px;
            margin-top: 20px;
        }

        .warning p {
            color: #c62828;
            font-size: 13px;
            line-height: 1.6;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }

            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”‘ API Token ç®¡ç†</h1>
            <p>ä½¿ç”¨ Token è¿›è¡Œ API è®¤è¯ï¼Œæ— éœ€é‡å¤ç™»å½•</p>
        </div>

        <div class="user-info">
            <h2>ğŸ‘¤ ç”¨æˆ·ä¿¡æ¯</h2>
            <p><strong>ç”¨æˆ·åï¼š</strong>{{ user.username }}</p>
            <p><strong>é‚®ç®±ï¼š</strong>{{ user.email }}</p>
            <p><strong>ç”¨æˆ·IDï¼š</strong>{{ user.id }}</p>
        </div>

        {% if error %}
        <div class="warning">
            <p><strong>âš ï¸ é”™è¯¯ï¼š</strong>{{ error }}</p>
        </div>
        {% else %}
        <div class="token-section">
            <h3>ğŸ” æ‚¨çš„ API Token</h3>
            <div class="token-display">
                <div class="token-value" id="tokenValue">{{ token }}</div>
                <button class="copy-btn" onclick="copyToken()">å¤åˆ¶</button>
            </div>
            <p style="color: #666; font-size: 13px;">
                {% if token_created %}
                âœ¨ å·²ä¸ºæ‚¨åˆ›å»ºæ–°çš„ Token
                {% else %}
                â„¹ï¸ è¿™æ˜¯æ‚¨ç°æœ‰çš„ Token
                {% endif %}
            </p>
        </div>

        <div class="usage-example">
            <h3>ğŸ“– ä½¿ç”¨ç¤ºä¾‹</h3>
            <p style="color: #555; margin-bottom: 10px;">åœ¨ HTTP è¯·æ±‚ä¸­æºå¸¦ Tokenï¼š</p>
            
            <div class="code-block">
# Python ç¤ºä¾‹
import requests

headers = {
    'Authorization': 'Token {{ token }}'
}

response = requests.get(
    'http://your-domain.com/api/reminders/',
    headers=headers
)
            </div>

            <div class="code-block">
// JavaScript ç¤ºä¾‹
fetch('http://your-domain.com/api/reminders/', {
    headers: {
        'Authorization': 'Token {{ token }}'
    }
})
.then(response => response.json())
.then(data => console.log(data));
            </div>

            <div class="code-block">
# cURL ç¤ºä¾‹
curl -H "Authorization: Token {{ token }}" \
     http://your-domain.com/api/reminders/
            </div>
        </div>

        <div class="action-buttons">
            <button class="btn btn-primary" onclick="testToken()">æµ‹è¯• Token</button>
            <button class="btn btn-warning" onclick="refreshToken()">åˆ·æ–° Token</button>
            <button class="btn btn-danger" onclick="deleteToken()">åˆ é™¤ Token</button>
        </div>

        <div class="warning">
            <p><strong>ğŸ”’ å®‰å…¨æç¤ºï¼š</strong></p>
            <p>â€¢ è¯·å¦¥å–„ä¿ç®¡æ‚¨çš„ Tokenï¼Œä¸è¦æ³„éœ²ç»™ä»–äºº</p>
            <p>â€¢ Token å…·æœ‰ä¸æ‚¨è´¦æˆ·ç›¸åŒçš„æƒé™</p>
            <p>â€¢ å¦‚æœ Token æ³„éœ²ï¼Œè¯·ç«‹å³åˆ·æ–°æˆ–åˆ é™¤</p>
        </div>
        {% endif %}

        <a href="{% url 'home' %}" class="back-link">â† è¿”å›ä¸»é¡µ</a>
    </div>

    <script>
        function copyToken() {
            const tokenValue = document.getElementById('tokenValue').textContent;
            navigator.clipboard.writeText(tokenValue).then(() => {
                const btn = document.querySelector('.copy-btn');
                btn.textContent = 'âœ“ å·²å¤åˆ¶';
                btn.classList.add('copied');
                setTimeout(() => {
                    btn.textContent = 'å¤åˆ¶';
                    btn.classList.remove('copied');
                }, 2000);
            });
        }

        function testToken() {
            const token = document.getElementById('tokenValue').textContent;
            fetch('/api/auth/token/verify/', {
                headers: {
                    'Authorization': 'Token ' + token
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.valid) {
                    alert('âœ… Token éªŒè¯æˆåŠŸï¼\nç”¨æˆ·: ' + data.username);
                } else {
                    alert('âŒ Token éªŒè¯å¤±è´¥ï¼');
                }
            })
            .catch(error => {
                alert('âŒ éªŒè¯å¤±è´¥: ' + error);
            });
        }

        function refreshToken() {
            if (!confirm('ç¡®å®šè¦åˆ·æ–° Token å—ï¼Ÿæ—§çš„ Token å°†å¤±æ•ˆã€‚')) {
                return;
            }

            const token = document.getElementById('tokenValue').textContent;
            fetch('/api/auth/token/refresh/', {
                method: 'POST',
                headers: {
                    'Authorization': 'Token ' + token
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.token) {
                    alert('âœ… Token å·²åˆ·æ–°ï¼é¡µé¢å°†é‡æ–°åŠ è½½ã€‚');
                    location.reload();
                } else {
                    alert('âŒ åˆ·æ–°å¤±è´¥: ' + (data.error || 'æœªçŸ¥é”™è¯¯'));
                }
            })
            .catch(error => {
                alert('âŒ åˆ·æ–°å¤±è´¥: ' + error);
            });
        }

        function deleteToken() {
            if (!confirm('ç¡®å®šè¦åˆ é™¤ Token å—ï¼Ÿåˆ é™¤åéœ€è¦é‡æ–°ç”Ÿæˆã€‚')) {
                return;
            }

            const token = document.getElementById('tokenValue').textContent;
            fetch('/api/auth/token/delete/', {
                method: 'DELETE',
                headers: {
                    'Authorization': 'Token ' + token
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.message) {
                    alert('âœ… Token å·²åˆ é™¤ï¼é¡µé¢å°†é‡æ–°åŠ è½½ã€‚');
                    location.reload();
                } else {
                    alert('âŒ åˆ é™¤å¤±è´¥: ' + (data.error || 'æœªçŸ¥é”™è¯¯'));
                }
            })
            .catch(error => {
                alert('âŒ åˆ é™¤å¤±è´¥: ' + error);
            });
        }
    </script>
</body>
</html>
