{% load static %}
<!-- v20251101-009: ÂÆûÁé∞ÂÆåÊï¥ÁöÑÂ§öÁª¥Â∫¶Á≠õÈÄâÔºàÁä∂ÊÄÅ+‰ºòÂÖàÁ∫ß+Á±ªÂûãÔºâÔºõ‰øÆÂ§ç‰ºòÂÖàÁ∫ßÁ≠õÈÄâÂô®ÈÄâÈ°πÂÄº -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UniSchedulerSuper - Êô∫ËÉΩÊó•Á®ãÁÆ°ÁêÜÁ≥ªÁªü</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/home-styles.css' %}?v=20251107-011">
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">    <!-- Âº∫Âà∂ÈöêËóèeditEventRecurringInfoÂÖÉÁ¥†ÁöÑÊ†∑Âºè -->
    <style>
        #editEventRecurringInfo {
            display: none !important;
            visibility: hidden !important;
        }
        /* Èò≤Ê≠¢JavaScriptÈáçÊñ∞ÊòæÁ§∫ */
        #editEventRecurringInfo[data-force-hidden="true"] {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            height: 0 !important;
            overflow: hidden !important;
        }
        
        /* TODOËØ¶ÊÉÖÊ®°ÊÄÅÊ°ÜÊ†∑Âºè */
        .todo-detail-info {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .detail-row {
            display: flex;
            gap: 15px;
            padding: 10px;
            background-color: var(--bg-secondary, #f8f9fa);
            border-radius: 6px;
        }
        
        .detail-label {
            font-weight: 600;
            color: var(--text-secondary, #6c757d);
            min-width: 100px;
            flex-shrink: 0;
        }
        
        .detail-value {
            flex: 1;
            color: var(--text-primary, #212529);
            word-break: break-word;
        }
        
        #todoDetailTitle {
            font-weight: 600;
            color: var(--text-primary, #212529);
        }
        
        #todoDetailPriority {
            font-weight: 500;
        }
    </style>
</head>
<body>
    <!-- È°∂ÈÉ®ÂØºËà™Ê†è -->
    <nav class="navbar navbar-expand-lg bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand text-white" href="#">
                <i class="fas fa-calendar-check me-2"></i>
                UniSchedulerSuper
            </a>
            
            <div class="navbar-nav ms-auto">
                <div class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle text-white" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">
                        <i class="fas fa-user-circle me-1"></i>
                        Áî®Êà∑
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#settingsModal"><i class="fas fa-cog me-2"></i>ËÆæÁΩÆ</a></li>
                        <li><a class="dropdown-item" href="{% url 'help_page' %}"><i class="fas fa-question-circle me-2"></i>Â∏ÆÂä©</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="{% url 'user_logout' %}"><i class="fas fa-sign-out-alt me-2"></i>ÈÄÄÂá∫</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <!-- ‰∏ªË¶ÅÂÜÖÂÆπÂå∫Âüü -->
    <div class="main-container">
        <!-- Â∑¶‰æßÈù¢Êùø - ÂæÖÂäû‰∫ãÈ°πÂíåÊèêÈÜí -->
        <div class="left-panel resizable-panel" data-min-width="15" data-max-width="35">
            <!-- ÂæÖÂäû‰∫ãÈ°πÂå∫Âüü -->
            <div class="todo-section section-half">
                <div class="section-header">
                    <h6><i class="fas fa-tasks me-2"></i>ÂæÖÂäû‰∫ãÈ°π</h6>
                    <div class="header-buttons">
                        <button class="btn btn-outline-secondary btn-sm me-1" id="todoViewToggle" onclick="todoManager.switchViewMode()" title="ÂàáÊç¢ËßÜÂõæ">
                            <i class="fas fa-list"></i>
                        </button>
                        <button class="btn btn-outline-secondary btn-sm me-1" onclick="todoManager.toggleFilterDropdown()" title="Á≠õÈÄâ">
                            <i class="fas fa-filter"></i>
                        </button>
                        <button class="btn btn-primary btn-sm create-btn" onclick="modalManager.openCreateTodoModal()">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>
                
                <!-- ÂæÖÂäû‰∫ãÈ°πÁ≠õÈÄâ‰∏ãÊãâËèúÂçï -->
                <div id="todoFilterDropdown" class="todo-filter-dropdown" style="display: none;">
                    <div class="filter-section">
                        <h6 class="filter-title"><i class="fas fa-th me-2"></i>ÈáçË¶ÅÁ¥ßÊÄ•ÊÄß</h6>
                        <div id="todoPriorityFilterList">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="important-urgent" id="todo-filter-important-urgent" checked>
                                <label class="form-check-label" for="todo-filter-important-urgent">
                                    üî¥ ÈáçË¶Å‰∏îÁ¥ßÊÄ•
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="important-not-urgent" id="todo-filter-important-not-urgent" checked>
                                <label class="form-check-label" for="todo-filter-important-not-urgent">
                                    üü° ÈáçË¶Å‰∏çÁ¥ßÊÄ•
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="not-important-urgent" id="todo-filter-not-important-urgent" checked>
                                <label class="form-check-label" for="todo-filter-not-important-urgent">
                                    üü† ‰∏çÈáçË¶Å‰ΩÜÁ¥ßÊÄ•
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="not-important-not-urgent" id="todo-filter-not-important-not-urgent" checked>
                                <label class="form-check-label" for="todo-filter-not-important-not-urgent">
                                    üü¢ ‰∏çÈáçË¶Å‰∏çÁ¥ßÊÄ•
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="unspecified" id="todo-filter-unspecified" checked>
                                <label class="form-check-label" for="todo-filter-unspecified">
                                    ‚ö™ ÂÖ∂‰ªñ
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="filter-section">
                        <h6 class="filter-title"><i class="fas fa-folder me-2"></i>Êó•Á®ãÁªÑ</h6>
                        <div id="todoGroupFilterList">
                            <!-- Â∞ÜÈÄöËøáJSÂä®ÊÄÅÂ°´ÂÖÖ -->
                        </div>
                    </div>
                </div>
                
                <div class="section-content scrollable-content">
                    <!-- ÂàóË°®ËßÜÂõæ (ÂéüÊúâ) -->
                    <div id="todoListView" class="todo-view active">
                        <div id="todoList" class="todo-list">
                            <div class="loading-placeholder">
                                <i class="fas fa-spinner fa-spin"></i> Âä†ËΩΩ‰∏≠...
                            </div>
                        </div>
                    </div>
                    
                    <!-- ÂõõË±°ÈôêËßÜÂõæ (Êñ∞Â¢û) -->
                    <div id="todoQuadrantView" class="todo-view" style="display: none;">
                        <div class="quadrant-container">
                            <!-- È°∂ÈÉ®Ê†áÁ≠æÔºöÈáçË¶Å -->
                            <div class="axis-label axis-top">ÈáçË¶Å</div>
                            <!-- Â∫ïÈÉ®Ê†áÁ≠æÔºö‰∏çÈáçË¶Å -->
                            <div class="axis-label axis-bottom">‰∏çÈáçË¶Å</div>
                            <!-- Â∑¶‰æßÊ†áÁ≠æÔºöÁ¥ßÊÄ• -->
                            <div class="axis-label axis-left">Á¥ßÊÄ•</div>
                            <!-- Âè≥‰æßÊ†áÁ≠æÔºö‰∏çÁ¥ßÊÄ• -->
                            <div class="axis-label axis-right">‰∏çÁ¥ßÊÄ•</div>
                            
                            <!-- ÂõõË±°ÈôêÁΩëÊ†º -->
                            <div class="quadrant-grid" id="todoQuadrantGrid">
                                <div class="quadrant quadrant-important-urgent" data-quadrant="important-urgent">
                                    <div class="quadrant-todos"></div>
                                </div>
                                <div class="quadrant quadrant-important-not-urgent" data-quadrant="important-not-urgent">
                                    <div class="quadrant-todos"></div>
                                </div>
                                <div class="quadrant quadrant-not-important-urgent" data-quadrant="not-important-urgent">
                                    <div class="quadrant-todos"></div>
                                </div>
                                <div class="quadrant quadrant-not-important-not-urgent" data-quadrant="not-important-not-urgent">
                                    <div class="quadrant-todos"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Ê∫¢Âá∫Âå∫Âüü -->
                        <div class="overflow-container" id="todoOverflowContainer">
                            <div class="overflow-header">ÂÖ∂‰ªñ</div>
                            <div class="overflow-list" id="todoOverflowList"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÂàÜÈöîÁ∫ø -->
            <div class="section-divider"></div>

            <!-- ÊèêÈÜíÂå∫Âüü -->
            <div class="reminder-section section-half">
                <div class="section-header">
                    <h6><i class="fas fa-bell me-2"></i>ÊèêÈÜí</h6>
                    <button class="btn btn-primary btn-sm create-btn" onclick="modalManager.openCreateReminderModal()">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                
                <!-- ÊèêÈÜíÁ≠õÈÄâÊéß‰ª∂ - Âõ∫ÂÆöÂú®È°∂ÈÉ® -->
                <div class="reminder-filters mb-2">
                    <div class="row g-1">
                        <div class="col-6">
                            <select id="reminderTimeRange" class="form-select form-select-sm">
                                <option value="today">‰ªäÂ§©</option>
                                <option value="week">Êú¨Âë®</option>
                                <option value="month">Êú¨Êúà</option>
                                <option value="quarter">Êú¨Â≠£Â∫¶</option>
                                <option value="year">‰∏ÄÂπ¥ÂÜÖ</option>
                                <option value="all">ÂÖ®ÈÉ®Êó∂Èó¥</option>
                            </select>
                        </div>
                        <div class="col-6">
                            <select id="reminderStatusFilter" class="form-select form-select-sm">
                                <option value="active">Ê¥ªË∑É</option>
                                <option value="completed">Â∑≤ÂÆåÊàê</option>
                                <option value="dismissed">Â∑≤ÂøΩÁï•</option>
                                <option value="snoozed">Â∑≤Âª∂Âêé</option>
                                <option value="all">ÂÖ®ÈÉ®Áä∂ÊÄÅ</option>
                            </select>
                        </div>
                    </div>
                    <div class="row g-1 mt-1">
                        <div class="col-6">
                            <select id="reminderPriorityFilter" class="form-select form-select-sm">
                                <option value="all">ÂÖ®ÈÉ®‰ºòÂÖàÁ∫ß</option>
                                <option value="urgent">Á¥ßÊÄ•</option>
                                <option value="high">È´ò</option>
                                <option value="normal">ÊôÆÈÄö</option>
                                <option value="low">‰Ωé</option>
                            </select>
                        </div>
                        <div class="col-6">
                            <select id="reminderTypeFilter" class="form-select form-select-sm">
                                <option value="all">ÂÖ®ÈÉ®Á±ªÂûã</option>
                                <option value="single">ÂçïÊ¨°ÊèêÈÜí</option>
                                <option value="recurring">ÈáçÂ§çÊèêÈÜí</option>
                                <option value="detached">Â∑≤ÂàÜÁ¶ª</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="section-content scrollable-content">
                    <div id="reminderList" class="reminder-list">
                        <div class="loading-placeholder">
                            <i class="fas fa-spinner fa-spin"></i> Âä†ËΩΩ‰∏≠...
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ë∞ÉËäÇÂô® -->
        <div class="resize-handle left-resize" data-target="left-panel"></div>

        <!-- ‰∏≠Â§ÆÈù¢Êùø - Êó•ÂéÜ -->
        <div class="center-panel resizable-panel" data-min-width="30" data-max-width="70">
            <div class="panel-header">
                <h5><i class="fas fa-calendar-alt me-2"></i>Êó•Á®ãÊó•ÂéÜ</h5>
                <div class="calendar-controls">
                    <button class="btn btn-outline-primary btn-sm me-2" onclick="modalManager.openCreateEventModal()">
                        <i class="fas fa-plus me-1"></i>Êñ∞Âª∫‰∫ã‰ª∂
                    </button>
                    <button class="btn btn-outline-success btn-sm me-2" onclick="groupManager.showManageGroupsModal()">
                        <i class="fas fa-layer-group me-1"></i>ÁÆ°ÁêÜÊó•Á®ãÁªÑ
                    </button>
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-outline-secondary btn-sm" onclick="eventManager.calendar.today()">‰ªäÂ§©</button>
                        <button type="button" class="btn btn-outline-secondary btn-sm" onclick="eventManager.calendar.prev()">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button type="button" class="btn btn-outline-secondary btn-sm" onclick="eventManager.calendar.next()">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="panel-content calendar-content">
                <div id="calendar" class="calendar-container"></div>
                
                <!-- Êó•ÂéÜÁ≠õÈÄâ‰∏ãÊãâËèúÂçï -->
                <div id="calendarFilterDropdown" class="calendar-filter-dropdown" style="display: none;">
                    <div class="filter-section">
                        <h6 class="filter-title"><i class="fas fa-th me-2"></i>ÂõõË±°ÈôêÁ≠õÈÄâ</h6>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="filter-important-urgent" checked>
                            <label class="form-check-label" for="filter-important-urgent">
                                ÈáçË¶Å‰∏îÁ¥ßÊÄ•
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="filter-important-not-urgent" checked>
                            <label class="form-check-label" for="filter-important-not-urgent">
                                ÈáçË¶Å‰∏çÁ¥ßÊÄ•
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="filter-not-important-urgent" checked>
                            <label class="form-check-label" for="filter-not-important-urgent">
                                ‰∏çÈáçË¶Å‰ΩÜÁ¥ßÊÄ•
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="filter-not-important-not-urgent" checked>
                            <label class="form-check-label" for="filter-not-important-not-urgent">
                                ‰∏çÈáçË¶Å‰∏çÁ¥ßÊÄ•
                            </label>
                        </div>
                    </div>
                    
                    <div class="filter-section">
                        <h6 class="filter-title"><i class="fas fa-flag me-2"></i>Êà™Ê≠¢Êó∂Èó¥</h6>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="filter-has-ddl" checked>
                            <label class="form-check-label" for="filter-has-ddl">
                                ÊúâÊà™Ê≠¢Êó∂Èó¥
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="filter-no-ddl" checked>
                            <label class="form-check-label" for="filter-no-ddl">
                                Êó†Êà™Ê≠¢Êó∂Èó¥
                            </label>
                        </div>
                    </div>
                    
                    <div class="filter-section">
                        <h6 class="filter-title"><i class="fas fa-repeat me-2"></i>ÈáçÂ§ç‰∫ã‰ª∂</h6>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="filter-recurring" checked>
                            <label class="form-check-label" for="filter-recurring">
                                ÈáçÂ§ç‰∫ã‰ª∂
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="filter-not-recurring" checked>
                            <label class="form-check-label" for="filter-not-recurring">
                                ÂçïÊ¨°‰∫ã‰ª∂
                            </label>
                        </div>
                    </div>
                    
                    <div class="filter-section">
                        <h6 class="filter-title"><i class="fas fa-bell me-2"></i>ÊèêÈÜí</h6>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="filter-show-reminders" checked>
                            <label class="form-check-label" for="filter-show-reminders">
                                ÊòæÁ§∫ÊèêÈÜí
                            </label>
                        </div>
                    </div>
                    
                    <div class="filter-section">
                        <h6 class="filter-title"><i class="fas fa-folder me-2"></i>Êó•Á®ãÁªÑ</h6>
                        <div id="groupFilterList">
                            <!-- Â∞ÜÈÄöËøáJSÂä®ÊÄÅÂ°´ÂÖÖ -->
                        </div>
                        <small class="text-muted">Êú™ÈÄâÊã©Êó∂ÊòæÁ§∫ÊâÄÊúâÂàÜÁªÑ</small>
                    </div>
                    
                    <div class="filter-actions">
                        <button class="btn btn-sm btn-primary" onclick="window.eventManager.applyFiltersFromUI()">
                            <i class="fas fa-check me-1"></i>Â∫îÁî®
                        </button>
                        <button class="btn btn-sm btn-secondary" onclick="window.eventManager.resetFilters()">
                            <i class="fas fa-undo me-1"></i>ÈáçÁΩÆ
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ë∞ÉËäÇÂô® -->
        <div class="resize-handle right-resize" data-target="center-panel"></div>

        <!-- Âè≥‰æßÈù¢Êùø - AIÂä©Êâã -->
        <div class="right-panel resizable-panel" data-min-width="20" data-max-width="50">
            <div class="panel-header">
                <h5><i class="fas fa-robot me-2"></i>AIÂä©Êâã</h5>
                <button class="btn btn-outline-primary btn-sm" id="aiChatToggle">
                    <i class="fas fa-comment"></i>
                </button>
            </div>
            
            <div class="panel-content scrollable-content">
                <div class="ai-quick-actions mb-3">
                    <button class="btn btn-outline-info btn-sm w-100 mb-2" onclick="aiAssistant.smartSchedule()">
                        <i class="fas fa-magic me-1"></i>Êô∫ËÉΩÂÆâÊéí
                    </button>
                    <button class="btn btn-outline-success btn-sm w-100 mb-2" onclick="aiAssistant.analyzePriority()">
                        <i class="fas fa-chart-line me-1"></i>‰ºòÂÖàÁ∫ßÂàÜÊûê
                    </button>
                    <button class="btn btn-outline-warning btn-sm w-100 mb-2" onclick="aiAssistant.timeBlocking()">
                        <i class="fas fa-clock me-1"></i>Êó∂Èó¥ÂùóÂàÜÈÖç
                    </button>
                </div>
                
                <div class="ai-chat-area">
                    <div class="chat-messages" id="aiChatMessages">
                        <div class="welcome-message">
                            <i class="fas fa-robot"></i>
                            <p>‰Ω†Â•ΩÔºÅÊàëÊòØ‰Ω†ÁöÑAIÂä©ÊâãÔºåÂèØ‰ª•Â∏Æ‰Ω†Ôºö</p>
                            <ul>
                                <li>Êô∫ËÉΩÂÆâÊéíÊó•Á®ã</li>
                                <li>ÂàÜÊûê‰ªªÂä°‰ºòÂÖàÁ∫ß</li>
                                <li>‰ºòÂåñÊó∂Èó¥ÂàÜÈÖç</li>
                                <li>Êèê‰æõÊïàÁéáÂª∫ËÆÆ</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="chat-input-area">
                        <div class="input-group">
                            <input type="text" class="form-control" id="aiChatInput" placeholder="ËæìÂÖ•‰Ω†ÁöÑÈóÆÈ¢ò...">
                            <button class="btn btn-primary" id="aiSendButton">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ÂàõÂª∫‰∫ã‰ª∂Ê®°ÊÄÅÊ°Ü -->
    <div class="modal" id="createEventModal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-calendar-plus me-2"></i>ÂàõÂª∫Êñ∞‰∫ã‰ª∂
                </h5>
                <span class="close">&times;</span>
            </div>
            
            <form id="createEventForm" class="modal-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label for="newEventTitle" class="form-label">Ê†áÈ¢ò *</label>
                        <input type="text" class="form-control form-input" id="newEventTitle" required>
                    </div>
                    
                    <div class="col-md-6">
                        <label for="newEventGroupId" class="form-label">Êó•Á®ãÁªÑ</label>
                        <select class="form-select" id="newEventGroupId">
                            <option value="">Êó†</option>
                        </select>
                    </div>
                    
                    <div class="col-md-6">
                        <label for="newEventStart" class="form-label">ÂºÄÂßãÊó∂Èó¥ *</label>
                        <input type="datetime-local" class="form-control form-input" id="newEventStart" required>
                    </div>
                    
                    <div class="col-md-6">
                        <label for="newEventEnd" class="form-label">ÁªìÊùüÊó∂Èó¥ *</label>
                        <input type="datetime-local" class="form-control form-input" id="newEventEnd" required>
                    </div>
                    
                    <div class="col-md-6">
                        <label for="creatEventDdl" class="form-label">Êà™Ê≠¢Êó∂Èó¥</label>
                        <input type="datetime-local" class="form-control" id="creatEventDdl">
                    </div>
                    
                    <!-- RRuleÈáçÂ§çËÆæÁΩÆ -->
                    <div class="col-12">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="newEventIsRecurring">
                            <label class="form-check-label" for="newEventIsRecurring">
                                <i class="fas fa-repeat me-1"></i>ÈáçÂ§ç‰∫ã‰ª∂
                            </label>
                        </div>
                    </div>
                    
                    <!-- ÈáçÂ§ç‰∫ã‰ª∂ËÆæÁΩÆÂå∫Âüü -->
                    <div class="col-12" id="newEventRecurringOptions" style="display: none;">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="fas fa-cog me-2"></i>ÈáçÂ§çËÆæÁΩÆ</h6>
                            </div>
                            <div class="card-body">
                                <div class="row g-3">
                                    <!-- ÈáçÂ§çÈ¢ëÁéá -->
                                    <div class="col-md-4">
                                        <label for="newEventFreq" class="form-label">ÈáçÂ§çÈ¢ëÁéá</label>
                                        <select class="form-select" id="newEventFreq">
                                            <option value="DAILY">ÊØèÊó•</option>
                                            <option value="WEEKLY">ÊØèÂë®</option>
                                            <option value="MONTHLY">ÊØèÊúà</option>
                                            <option value="YEARLY">ÊØèÂπ¥</option>
                                        </select>
                                    </div>
                                    
                                    <!-- ÈáçÂ§çÈó¥Èöî -->
                                    <div class="col-md-4">
                                        <label for="newEventInterval" class="form-label">Èó¥Èöî</label>
                                        <input type="number" class="form-control" id="newEventInterval" value="1" min="1" max="365">
                                    </div>
                                    
                                    <!-- ÁªìÊùüÊù°‰ª∂ -->
                                    <div class="col-md-4">
                                        <label for="newEventEndType" class="form-label">ÁªìÊùüÊù°‰ª∂</label>
                                        <select class="form-select" id="newEventEndType">
                                            <option value="never">Ê∞∏‰∏çÁªìÊùü</option>
                                            <option value="count">ÈáçÂ§çÊ¨°Êï∞</option>
                                            <option value="until">ÁªìÊùüÊó•Êúü</option>
                                        </select>
                                    </div>
                                    
                                    <!-- ÈáçÂ§çÊ¨°Êï∞ -->
                                    <div class="col-md-6" id="newEventCountContainer" style="display: none;">
                                        <label for="newEventCount" class="form-label">ÈáçÂ§çÊ¨°Êï∞</label>
                                        <input type="number" class="form-control" id="newEventCount" value="10" min="1" max="999">
                                    </div>
                                    
                                    <!-- ÁªìÊùüÊó•Êúü -->
                                    <div class="col-md-6" id="newEventUntilContainer" style="display: none;">
                                        <label for="newEventUntil" class="form-label">ÁªìÊùüÊó•Êúü</label>
                                        <input type="date" class="form-control" id="newEventUntil">
                                    </div>
                                    
                                    <!-- ÊØèÂë®ÈáçÂ§çÁöÑÊòüÊúüÈÄâÊã© -->
                                    <div class="col-12" id="newEventWeekdaysContainer" style="display: none;">
                                        <label class="form-label">ÈáçÂ§çÊòüÊúü</label>
                                        <div class="weekday-buttons">
                                            <button type="button" class="btn btn-outline-primary btn-sm weekday-btn" data-day="MO">Âë®‰∏Ä</button>
                                            <button type="button" class="btn btn-outline-primary btn-sm weekday-btn" data-day="TU">Âë®‰∫å</button>
                                            <button type="button" class="btn btn-outline-primary btn-sm weekday-btn" data-day="WE">Âë®‰∏â</button>
                                            <button type="button" class="btn btn-outline-primary btn-sm weekday-btn" data-day="TH">Âë®Âõõ</button>
                                            <button type="button" class="btn btn-outline-primary btn-sm weekday-btn" data-day="FR">Âë®‰∫î</button>
                                            <button type="button" class="btn btn-outline-primary btn-sm weekday-btn" data-day="SA">Âë®ÂÖ≠</button>
                                            <button type="button" class="btn btn-outline-primary btn-sm weekday-btn" data-day="SU">Âë®Êó•</button>
                                        </div>
                                    </div>
                                    
                                    <!-- ÊØèÊúàÈáçÂ§çËÆæÁΩÆ -->
                                    <div class="col-md-6" id="newEventMonthlyOptions" style="display: none;">
                                        <label for="newEventMonthlyType" class="form-label">ÊúàÈáçÂ§çÊñπÂºè</label>
                                        <select class="form-select" id="newEventMonthlyType">
                                            <option value="simple">ÊØèÈöîÊåáÂÆöÊúàÊï∞</option>
                                            <option value="bymonthday">ÊåâÊó•ÊúüÔºà‰æãÂ¶ÇÔºöÊØèÊúà15Êó•Ôºâ</option>
                                            <option value="byweekday">ÊåâÊòüÊúüÔºà‰æãÂ¶ÇÔºöÊØèÊúàÁ¨¨‰∫å‰∏™Âë®‰∏ÄÔºâ</option>
                                        </select>
                                    </div>
                                    
                                    <!-- ÊåâÊó•ÊúüÈáçÂ§çÁöÑÈÄâÊã© -->
                                    <div class="col-md-6" id="newEventMonthlyDateOptions" style="display: none;">
                                        <label for="newEventMonthlyDate" class="form-label">ÈÄâÊã©Êó•Êúü</label>
                                        <select class="form-select" id="newEventMonthlyDate">
                                            <option value="1">1Êó•</option>
                                            <option value="2">2Êó•</option>
                                            <option value="3">3Êó•</option>
                                            <option value="4">4Êó•</option>
                                            <option value="5">5Êó•</option>
                                            <option value="6">6Êó•</option>
                                            <option value="7">7Êó•</option>
                                            <option value="8">8Êó•</option>
                                            <option value="9">9Êó•</option>
                                            <option value="10">10Êó•</option>
                                            <option value="11">11Êó•</option>
                                            <option value="12">12Êó•</option>
                                            <option value="13">13Êó•</option>
                                            <option value="14">14Êó•</option>
                                            <option value="15">15Êó•</option>
                                            <option value="16">16Êó•</option>
                                            <option value="17">17Êó•</option>
                                            <option value="18">18Êó•</option>
                                            <option value="19">19Êó•</option>
                                            <option value="20">20Êó•</option>
                                            <option value="21">21Êó•</option>
                                            <option value="22">22Êó•</option>
                                            <option value="23">23Êó•</option>
                                            <option value="24">24Êó•</option>
                                            <option value="25">25Êó•</option>
                                            <option value="26">26Êó•</option>
                                            <option value="27">27Êó•</option>
                                            <option value="28">28Êó•</option>
                                            <option value="29">29Êó•</option>
                                            <option value="30">30Êó•</option>
                                            <option value="31">31Êó•</option>
                                            <option value="-1">ÊúàÊú´</option>
                                        </select>
                                    </div>
                                    
                                    <!-- ÊåâÊòüÊúüÈáçÂ§çÁöÑÈÄâÊã© -->
                                    <div class="col-md-3" id="newEventMonthlyWeekOptions" style="display: none;">
                                        <label for="newEventMonthlyWeek" class="form-label">Á¨¨Âá†Âë®</label>
                                        <select class="form-select" id="newEventMonthlyWeek">
                                            <option value="1">Á¨¨‰∏ÄÂë®</option>
                                            <option value="2">Á¨¨‰∫åÂë®</option>
                                            <option value="3">Á¨¨‰∏âÂë®</option>
                                            <option value="4">Á¨¨ÂõõÂë®</option>
                                            <option value="-1">ÊúÄÂêé‰∏ÄÂë®</option>
                                        </select>
                                    </div>
                                    
                                    <div class="col-md-3" id="newEventMonthlyWeekdayOptions" style="display: none;">
                                        <label for="newEventMonthlyWeekday" class="form-label">ÊòüÊúüÂá†</label>
                                        <select class="form-select" id="newEventMonthlyWeekday">
                                            <option value="MO">Âë®‰∏Ä</option>
                                            <option value="TU">Âë®‰∫å</option>
                                            <option value="WE">Âë®‰∏â</option>
                                            <option value="TH">Âë®Âõõ</option>
                                            <option value="FR">Âë®‰∫î</option>
                                            <option value="SA">Âë®ÂÖ≠</option>
                                            <option value="SU">Âë®Êó•</option>
                                        </select>
                                    </div>
                                    
                                    <!-- RRuleÈ¢ÑËßà -->
                                    <div class="col-12">
                                        <label class="form-label">ÈáçÂ§çËßÑÂàôÈ¢ÑËßà</label>
                                        <div class="alert alert-info">
                                            <i class="fas fa-info-circle me-2"></i>
                                            <span id="newEventRulePreview">ËØ∑ÈÄâÊã©ÈáçÂ§çËÆæÁΩÆ</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-12">
                        <label for="newEventDescription" class="form-label">ÊèèËø∞</label>
                        <textarea class="form-control" id="newEventDescription" rows="3"></textarea>
                    </div>
                    
                    <!-- ÈáçË¶ÅÊÄßÁ¥ßÊÄ•ÊÄßÁü©Èòµ -->
                    <div class="col-12">
                        <label class="form-label">ÈáçË¶ÅÊÄß / Á¥ßÊÄ•ÊÄß</label>
                        <div class="importance-urgency-matrix">
                            <div class="matrix-row">
                                <button type="button" class="matrix-button important-urgent" 
                                        data-importance="important" data-urgency="urgent"
                                        onclick="setImportanceUrgency('important', 'urgent', this)">
                                    ÈáçË¶ÅÁ¥ßÊÄ•
                                </button>
                                <button type="button" class="matrix-button important-not-urgent" 
                                        data-importance="important" data-urgency="not-urgent"
                                        onclick="setImportanceUrgency('important', 'not-urgent', this)">
                                    ÈáçË¶Å‰∏çÁ¥ßÊÄ•
                                </button>
                            </div>
                            <div class="matrix-row">
                                <button type="button" class="matrix-button not-important-urgent" 
                                        data-importance="not-important" data-urgency="urgent"
                                        onclick="setImportanceUrgency('not-important', 'urgent', this)">
                                    ‰∏çÈáçË¶ÅÁ¥ßÊÄ•
                                </button>
                                <button type="button" class="matrix-button not-important-not-urgent" 
                                        data-importance="not-important" data-urgency="not-urgent"
                                        onclick="setImportanceUrgency('not-important', 'not-urgent', this)">
                                    ‰∏çÈáçË¶Å‰∏çÁ¥ßÊÄ•
                                </button>
                            </div>
                        </div>
                        <input type="hidden" id="newEventImportance">
                        <input type="hidden" id="newEventUrgency">
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="modalManager.closeAllModals()">ÂèñÊ∂à</button>
                    <button type="submit" class="btn btn-primary">ÂàõÂª∫‰∫ã‰ª∂</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ÁºñËæë‰∫ã‰ª∂Ê®°ÊÄÅÊ°Ü -->
    <div class="modal" id="editEventModal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-calendar-edit me-2"></i>ÁºñËæë‰∫ã‰ª∂
                </h5>
                <span class="close">&times;</span>
            </div>
            
            <form id="editEventForm" class="modal-body">
                <input type="hidden" id="eventId">
                
                <div class="row g-3">
                    <div class="col-md-6">
                        <label for="eventTitle" class="form-label">Ê†áÈ¢ò *</label>
                        <input type="text" class="form-control form-input" id="eventTitle" required>
                    </div>
                    
                    <div class="col-md-6">
                        <label for="eventGroupId" class="form-label">Êó•Á®ãÁªÑ</label>
                        <select class="form-select" id="eventGroupId">
                            <option value="">Êó†</option>
                        </select>
                    </div>
                    
                    <div class="col-md-6">
                        <label for="eventStart" class="form-label">ÂºÄÂßãÊó∂Èó¥ *</label>
                        <input type="datetime-local" class="form-control form-input" id="eventStart" required>
                    </div>
                    
                    <div class="col-md-6">
                        <label for="eventEnd" class="form-label">ÁªìÊùüÊó∂Èó¥ *</label>
                        <input type="datetime-local" class="form-control form-input" id="eventEnd" required>
                    </div>
                    
                    <div class="col-md-6">
                        <label for="eventDdl" class="form-label">Êà™Ê≠¢Êó∂Èó¥</label>
                        <input type="datetime-local" class="form-control" id="eventDdl">
                    </div>
                    
                    <div class="col-12">
                        <label for="eventDescription" class="form-label">ÊèèËø∞</label>
                        <textarea class="form-control" id="eventDescription" rows="3"></textarea>
                    </div>
                    
                    <div class="col-12">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="eventRepeat" onchange="if(!this.disabled) toggleRepeatOptions('editEvent'); else this.checked = false;">
                            <label class="form-check-label" for="eventRepeat">
                                <i class="fas fa-repeat me-2"></i>ÈáçÂ§çÊó•Á®ã
                            </label>
                        </div>
                    </div>
                    
                    <!-- ÈáçÂ§ç‰∫ã‰ª∂‰ø°ÊÅØÊòæÁ§∫ -->
                    <div class="col-12" id="editEventRecurringInfo" style="display: none;">
                        <div class="alert alert-warning">
                            <i class="fas fa-repeat me-2"></i>
                            <strong>ËøôÊòØ‰∏Ä‰∏™ÈáçÂ§ç‰∫ã‰ª∂</strong>
                            <p class="mb-2">‰øÆÊîπËåÉÂõ¥Ôºö</p>
                            <div class="btn-group-vertical w-100" role="group">
                                <div class="form-check">
                                    <input type="radio" class="form-check-input" name="editEventScope" id="editScopeThis" value="single" checked>
                                    <label class="form-check-label" for="editScopeThis">
                                        <strong>‰ªÖÊ≠§Ê¨°</strong>
                                        <small class="text-muted d-block">Âè™‰øÆÊîπÂΩìÂâçÈÄâ‰∏≠ÁöÑ‰∫ã‰ª∂ÂÆû‰æã</small>
                                    </label>
                                </div>
                                
                                <div class="form-check">
                                    <input type="radio" class="form-check-input" name="editEventScope" id="editScopeAll" value="all">
                                    <label class="form-check-label" for="editScopeAll">
                                        <strong>ÂÖ®ÈÉ®</strong>
                                        <small class="text-muted d-block">‰øÆÊîπÊï¥‰∏™ÈáçÂ§ç‰∫ã‰ª∂Á≥ªÂàó</small>
                                    </label>
                                </div>
                                
                                <div class="form-check">
                                    <input type="radio" class="form-check-input" name="editEventScope" id="editScopeFuture" value="future">
                                    <label class="form-check-label" for="editScopeFuture">
                                        <strong>Ê≠§Âèä‰πãÂêé</strong>
                                        <small class="text-muted d-block">‰øÆÊîπÂΩìÂâçÂèä‰πãÂêéÁöÑÊâÄÊúâ‰∫ã‰ª∂ÂÆû‰æã</small>
                                    </label>
                                </div>
                                
                                <div class="form-check">
                                    <input type="radio" class="form-check-input" name="editEventScope" id="editScopeFromTime" value="from_time">
                                    <label class="form-check-label" for="editScopeFromTime">
                                        <strong>‰ªéÊåáÂÆöÊó∂Èó¥ÂºÄÂßã</strong>
                                        <small class="text-muted d-block">‰ªéÈÄâÊã©ÁöÑÊó∂Èó¥ÁÇπÂºÄÂßã‰øÆÊîπ</small>
                                    </label>
                                    <select class="form-select form-select-sm mt-2" id="editEventTimeSelect" style="display: none;">
                                        <!-- Âä®ÊÄÅÂ°´ÂÖÖÊó∂Èó¥ÈÄâÈ°π -->
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- RRuleÁºñËæëËÆæÁΩÆ -->
                    <div class="col-12" id="editEventRecurringOptions" style="display: none;">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="fas fa-cog me-2"></i>ÈáçÂ§çËÆæÁΩÆ‰øÆÊîπ</h6>
                            </div>
                            <div class="card-body">
                                <div class="row g-3">
                                    <!-- ÈáçÂ§çÈ¢ëÁéá -->
                                    <div class="col-md-4">
                                        <label for="editEventFreq" class="form-label">ÈáçÂ§çÈ¢ëÁéá</label>
                                        <select class="form-select" id="editEventFreq" onchange="if(window.rruleManager) window.rruleManager.updateFrequencyOptions('edit');">
                                            <option value="DAILY">ÊØèÊó•</option>
                                            <option value="WEEKLY">ÊØèÂë®</option>
                                            <option value="MONTHLY">ÊØèÊúà</option>
                                            <option value="YEARLY">ÊØèÂπ¥</option>
                                        </select>
                                    </div>
                                    
                                    <!-- ÈáçÂ§çÈó¥Èöî -->
                                    <div class="col-md-4">
                                        <label for="editEventInterval" class="form-label">Èó¥Èöî</label>
                                        <input type="number" class="form-control" id="editEventInterval" value="1" min="1" max="365">
                                    </div>
                                    
                                    <!-- ÁªìÊùüÊù°‰ª∂ -->
                                    <div class="col-md-4">
                                        <label for="editEventEndType" class="form-label">ÁªìÊùüÊù°‰ª∂</label>
                                        <select class="form-select" id="editEventEndType">
                                            <option value="never">Ê∞∏‰∏çÁªìÊùü</option>
                                            <option value="count">ÈáçÂ§çÊ¨°Êï∞</option>
                                            <option value="until">ÁªìÊùüÊó•Êúü</option>
                                        </select>
                                    </div>
                                    
                                    <!-- ÈáçÂ§çÊ¨°Êï∞ -->
                                    <div class="col-md-6" id="editEventCountContainer" style="display: none;">
                                        <label for="editEventCount" class="form-label">ÈáçÂ§çÊ¨°Êï∞</label>
                                        <input type="number" class="form-control" id="editEventCount" value="10" min="1" max="999">
                                    </div>
                                    
                                    <!-- ÁªìÊùüÊó•Êúü -->
                                    <div class="col-md-6" id="editEventUntilContainer" style="display: none;">
                                        <label for="editEventUntil" class="form-label">ÁªìÊùüÊó•Êúü</label>
                                        <input type="date" class="form-control" id="editEventUntil">
                                    </div>
                                    
                                    <!-- ÊØèÂë®ÈáçÂ§çÁöÑÊòüÊúüÈÄâÊã© -->
                                    <div class="col-12" id="editEventWeekdaysContainer" style="display: none;">
                                        <label class="form-label">ÈáçÂ§çÊòüÊúü</label>
                                        <div class="weekday-buttons">
                                            <button type="button" class="btn btn-outline-primary btn-sm weekday-btn" data-day="MO">Âë®‰∏Ä</button>
                                            <button type="button" class="btn btn-outline-primary btn-sm weekday-btn" data-day="TU">Âë®‰∫å</button>
                                            <button type="button" class="btn btn-outline-primary btn-sm weekday-btn" data-day="WE">Âë®‰∏â</button>
                                            <button type="button" class="btn btn-outline-primary btn-sm weekday-btn" data-day="TH">Âë®Âõõ</button>
                                            <button type="button" class="btn btn-outline-primary btn-sm weekday-btn" data-day="FR">Âë®‰∫î</button>
                                            <button type="button" class="btn btn-outline-primary btn-sm weekday-btn" data-day="SA">Âë®ÂÖ≠</button>
                                            <button type="button" class="btn btn-outline-primary btn-sm weekday-btn" data-day="SU">Âë®Êó•</button>
                                        </div>
                                    </div>
                                    
                                    <!-- ÊØèÊúàÈáçÂ§çËÆæÁΩÆ -->
                                    <div class="col-md-6" id="editEventMonthlyOptions" style="display: none;">
                                        <label for="editEventMonthlyType" class="form-label">ÊúàÈáçÂ§çÊñπÂºè</label>
                                        <select class="form-select" id="editEventMonthlyType" onchange="if(window.rruleManager) window.rruleManager.updateEventMonthlyOptions('edit');">
                                            <option value="simple">ÊØèÈöîÊåáÂÆöÊúàÊï∞</option>
                                            <option value="bymonthday">ÊåâÊó•ÊúüÔºà‰æãÂ¶ÇÔºöÊØèÊúà15Êó•Ôºâ</option>
                                            <option value="byweekday">ÊåâÊòüÊúüÔºà‰æãÂ¶ÇÔºöÊØèÊúàÁ¨¨‰∫å‰∏™Âë®‰∏ÄÔºâ</option>
                                        </select>
                                    </div>
                                    
                                    <!-- ÊåâÊó•ÊúüÈáçÂ§çÁöÑÈÄâÊã© -->
                                    <div class="col-md-6" id="editEventMonthlyDateOptions" style="display: none;">
                                        <label for="editEventMonthlyDate" class="form-label">ÈÄâÊã©Êó•Êúü</label>
                                        <select class="form-select" id="editEventMonthlyDate">
                                            <option value="1">1Êó•</option>
                                            <option value="2">2Êó•</option>
                                            <option value="3">3Êó•</option>
                                            <option value="4">4Êó•</option>
                                            <option value="5">5Êó•</option>
                                            <option value="6">6Êó•</option>
                                            <option value="7">7Êó•</option>
                                            <option value="8">8Êó•</option>
                                            <option value="9">9Êó•</option>
                                            <option value="10">10Êó•</option>
                                            <option value="11">11Êó•</option>
                                            <option value="12">12Êó•</option>
                                            <option value="13">13Êó•</option>
                                            <option value="14">14Êó•</option>
                                            <option value="15">15Êó•</option>
                                            <option value="16">16Êó•</option>
                                            <option value="17">17Êó•</option>
                                            <option value="18">18Êó•</option>
                                            <option value="19">19Êó•</option>
                                            <option value="20">20Êó•</option>
                                            <option value="21">21Êó•</option>
                                            <option value="22">22Êó•</option>
                                            <option value="23">23Êó•</option>
                                            <option value="24">24Êó•</option>
                                            <option value="25">25Êó•</option>
                                            <option value="26">26Êó•</option>
                                            <option value="27">27Êó•</option>
                                            <option value="28">28Êó•</option>
                                            <option value="29">29Êó•</option>
                                            <option value="30">30Êó•</option>
                                            <option value="31">31Êó•</option>
                                            <option value="-1">ÊúàÊú´</option>
                                        </select>
                                    </div>
                                    
                                    <!-- ÊåâÊòüÊúüÈáçÂ§çÁöÑÈÄâÊã© -->
                                    <div class="col-md-3" id="editEventMonthlyWeekOptions" style="display: none;">
                                        <label for="editEventMonthlyWeek" class="form-label">Á¨¨Âá†Âë®</label>
                                        <select class="form-select" id="editEventMonthlyWeek">
                                            <option value="1">Á¨¨‰∏ÄÂë®</option>
                                            <option value="2">Á¨¨‰∫åÂë®</option>
                                            <option value="3">Á¨¨‰∏âÂë®</option>
                                            <option value="4">Á¨¨ÂõõÂë®</option>
                                            <option value="-1">ÊúÄÂêé‰∏ÄÂë®</option>
                                        </select>
                                    </div>
                                    
                                    <div class="col-md-3" id="editEventMonthlyWeekdayOptions" style="display: none;">
                                        <label for="editEventMonthlyWeekday" class="form-label">ÊòüÊúüÂá†</label>
                                        <select class="form-select" id="editEventMonthlyWeekday">
                                            <option value="MO">Âë®‰∏Ä</option>
                                            <option value="TU">Âë®‰∫å</option>
                                            <option value="WE">Âë®‰∏â</option>
                                            <option value="TH">Âë®Âõõ</option>
                                            <option value="FR">Âë®‰∫î</option>
                                            <option value="SA">Âë®ÂÖ≠</option>
                                            <option value="SU">Âë®Êó•</option>
                                        </select>
                                    </div>
                                    
                                    <!-- RRuleÈ¢ÑËßà -->
                                    <div class="col-12">
                                        <label class="form-label">ÈáçÂ§çËßÑÂàôÈ¢ÑËßà</label>
                                        <div class="alert alert-info">
                                            <i class="fas fa-info-circle me-2"></i>
                                            <span id="editEventRulePreview">ÂΩìÂâçÈáçÂ§çËßÑÂàô</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ÈáçË¶ÅÊÄßÁ¥ßÊÄ•ÊÄßÁü©Èòµ -->
                    <div class="col-12">
                        <label class="form-label">ÈáçË¶ÅÊÄß / Á¥ßÊÄ•ÊÄß</label>
                        <div class="importance-urgency-matrix">
                            <div class="matrix-row">
                                <button type="button" class="matrix-button important-urgent" 
                                        data-importance="important" data-urgency="urgent"
                                        onclick="setImportanceUrgency('important', 'urgent', this)">
                                    ÈáçË¶ÅÁ¥ßÊÄ•
                                </button>
                                <button type="button" class="matrix-button important-not-urgent" 
                                        data-importance="important" data-urgency="not-urgent"
                                        onclick="setImportanceUrgency('important', 'not-urgent', this)">
                                    ÈáçË¶Å‰∏çÁ¥ßÊÄ•
                                </button>
                            </div>
                            <div class="matrix-row">
                                <button type="button" class="matrix-button not-important-urgent" 
                                        data-importance="not-important" data-urgency="urgent"
                                        onclick="setImportanceUrgency('not-important', 'urgent', this)">
                                    ‰∏çÈáçË¶ÅÁ¥ßÊÄ•
                                </button>
                                <button type="button" class="matrix-button not-important-not-urgent" 
                                        data-importance="not-important" data-urgency="not-urgent"
                                        onclick="setImportanceUrgency('not-important', 'not-urgent', this)">
                                    ‰∏çÈáçË¶Å‰∏çÁ¥ßÊÄ•
                                </button>
                            </div>
                        </div>
                        <input type="hidden" id="eventImportance">
                        <input type="hidden" id="eventUrgency">
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" onclick="modalManager.handleDeleteEvent()">Âà†Èô§</button>
                    <button type="button" class="btn btn-secondary" onclick="modalManager.closeAllModals()">ÂèñÊ∂à</button>
                    <button type="submit" class="btn btn-primary" onclick="modalManager.handleUpdateEvent()">Êõ¥Êñ∞‰∫ã‰ª∂</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ÈáçÂ§ç‰∫ã‰ª∂Âà†Èô§Á°ÆËÆ§Ê®°ÊÄÅÊ°Ü -->
    <div class="modal" id="deleteRecurringEventModal">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-exclamation-triangle me-2 text-warning"></i>Âà†Èô§ÈáçÂ§ç‰∫ã‰ª∂
                </h5>
                <span class="close">&times;</span>
            </div>
            
            <div class="modal-body">
                <p>ËøôÊòØ‰∏Ä‰∏™ÈáçÂ§ç‰∫ã‰ª∂ÔºåËØ∑ÈÄâÊã©Âà†Èô§ËåÉÂõ¥Ôºö</p>
                
                <div class="delete-scope-options">
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="deleteEventScope" id="deleteScopeThis" value="single" checked>
                        <label class="form-check-label" for="deleteScopeThis">
                            <strong>‰ªÖÊ≠§Ê¨°</strong>
                            <small class="text-muted d-block">Âè™Âà†Èô§ÂΩìÂâçÈÄâ‰∏≠ÁöÑ‰∫ã‰ª∂ÂÆû‰æã</small>
                        </label>
                    </div>
                    
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="deleteEventScope" id="deleteScopeAll" value="all">
                        <label class="form-check-label" for="deleteScopeAll">
                            <strong>ÂÖ®ÈÉ®</strong>
                            <small class="text-muted d-block">Âà†Èô§Êï¥‰∏™ÈáçÂ§ç‰∫ã‰ª∂Á≥ªÂàó</small>
                        </label>
                    </div>
                    
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="deleteEventScope" id="deleteScopeFuture" value="future">
                        <label class="form-check-label" for="deleteScopeFuture">
                            <strong>Ê≠§Âèä‰πãÂêé</strong>
                            <small class="text-muted d-block">Âà†Èô§ÂΩìÂâçÂèä‰πãÂêéÁöÑÊâÄÊúâ‰∫ã‰ª∂ÂÆû‰æã</small>
                        </label>
                    </div>
                </div>
                
                <div class="alert alert-warning mt-3">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <strong>Ê≥®ÊÑèÔºö</strong>Âà†Èô§Êìç‰ΩúÊó†Ê≥ïÊí§ÈîÄÔºÅ
                </div>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="modalManager.closeAllModals()">ÂèñÊ∂à</button>
                <button type="button" class="btn btn-danger" onclick="modalManager.confirmDeleteRecurringEvent()">Á°ÆËÆ§Âà†Èô§</button>
            </div>
        </div>
    </div>

    <!-- ÂàõÂª∫ÂæÖÂäû‰∫ãÈ°πÊ®°ÊÄÅÊ°Ü -->
    <div class="modal" id="createTodoModal">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-plus-circle me-2"></i>ÂàõÂª∫ÂæÖÂäû‰∫ãÈ°π
                </h5>
                <span class="close">&times;</span>
            </div>
            
            <form id="createTodoForm" class="modal-body">
                <div class="row g-3">
                    <div class="col-12">
                        <label for="newTodoTitle" class="form-label">Ê†áÈ¢ò *</label>
                        <input type="text" class="form-control form-input" id="newTodoTitle" required>
                    </div>
                    
                    <div class="col-md-6">
                        <label for="newTodoDueDate" class="form-label">Âà∞ÊúüÊó∂Èó¥</label>
                        <input type="datetime-local" class="form-control" id="newTodoDueDate">
                    </div>
                    
                    <div class="col-md-6">
                        <label for="newTodoEstimatedDuration" class="form-label">È¢ÑËÆ°ËÄóÊó∂ÔºàÂàÜÈíüÔºâ</label>
                        <input type="number" class="form-control" id="newTodoEstimatedDuration" min="1">
                    </div>
                    
                    <!-- ÈáçË¶ÅÊÄßÁ¥ßÊÄ•ÊÄßÁü©Èòµ -->
                    <div class="col-12">
                        <label class="form-label">ÈáçË¶ÅÊÄß / Á¥ßÊÄ•ÊÄß</label>
                        <div class="importance-urgency-matrix">
                            <div class="matrix-row">
                                <button type="button" class="matrix-button important-urgent" 
                                        data-importance="important" data-urgency="urgent"
                                        onclick="setImportanceUrgency('important', 'urgent', this)">
                                    ÈáçË¶ÅÁ¥ßÊÄ•
                                </button>
                                <button type="button" class="matrix-button important-not-urgent" 
                                        data-importance="important" data-urgency="not-urgent"
                                        onclick="setImportanceUrgency('important', 'not-urgent', this)">
                                    ÈáçË¶Å‰∏çÁ¥ßÊÄ•
                                </button>
                            </div>
                            <div class="matrix-row">
                                <button type="button" class="matrix-button not-important-urgent" 
                                        data-importance="not-important" data-urgency="urgent"
                                        onclick="setImportanceUrgency('not-important', 'urgent', this)">
                                    ‰∏çÈáçË¶ÅÁ¥ßÊÄ•
                                </button>
                                <button type="button" class="matrix-button not-important-not-urgent" 
                                        data-importance="not-important" data-urgency="not-urgent"
                                        onclick="setImportanceUrgency('not-important', 'not-urgent', this)">
                                    ‰∏çÈáçË¶Å‰∏çÁ¥ßÊÄ•
                                </button>
                            </div>
                        </div>
                        <input type="hidden" id="newTodoImportance">
                        <input type="hidden" id="newTodoUrgency">
                    </div>
                    
                    <div class="col-12">
                        <label for="newTodoGroupId" class="form-label">Êó•Á®ãÁªÑ</label>
                        <select class="form-select" id="newTodoGroupId">
                            <option value="">Êó†</option>
                        </select>
                    </div>
                    
                    <div class="col-12">
                        <label for="newTodoDescription" class="form-label">ÊèèËø∞</label>
                        <textarea class="form-control" id="newTodoDescription" rows="3"></textarea>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="modalManager.closeAllModals()">ÂèñÊ∂à</button>
                    <button type="submit" class="btn btn-primary">ÂàõÂª∫ÂæÖÂäû</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ÁºñËæëÂæÖÂäû‰∫ãÈ°πÊ®°ÊÄÅÊ°Ü -->
    <div class="modal" id="editTodoModal">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-edit me-2"></i>ÁºñËæëÂæÖÂäû‰∫ãÈ°π
                </h5>
                <span class="close">&times;</span>
            </div>
            
            <form id="editTodoForm" class="modal-body">
                <input type="hidden" id="todoId">
                
                <div class="row g-3">
                    <div class="col-12">
                        <label for="todoTitle" class="form-label">Ê†áÈ¢ò *</label>
                        <input type="text" class="form-control form-input" id="todoTitle" required>
                    </div>
                    
                    <div class="col-md-6">
                        <label for="todoDueDate" class="form-label">Âà∞ÊúüÊó∂Èó¥</label>
                        <input type="datetime-local" class="form-control" id="todoDueDate">
                    </div>
                    
                    <div class="col-md-6">
                        <label for="todoEstimatedDuration" class="form-label">È¢ÑËÆ°ËÄóÊó∂ÔºàÂàÜÈíüÔºâ</label>
                        <input type="number" class="form-control" id="todoEstimatedDuration" min="1">
                    </div>
                    
                    <!-- ÈáçË¶ÅÊÄßÁ¥ßÊÄ•ÊÄßÁü©Èòµ -->
                    <div class="col-12">
                        <label class="form-label">ÈáçË¶ÅÊÄß / Á¥ßÊÄ•ÊÄß</label>
                        <div class="importance-urgency-matrix">
                            <div class="matrix-row">
                                <button type="button" class="matrix-button important-urgent" 
                                        data-importance="important" data-urgency="urgent"
                                        onclick="setImportanceUrgency('important', 'urgent', this)">
                                    ÈáçË¶ÅÁ¥ßÊÄ•
                                </button>
                                <button type="button" class="matrix-button important-not-urgent" 
                                        data-importance="important" data-urgency="not-urgent"
                                        onclick="setImportanceUrgency('important', 'not-urgent', this)">
                                    ÈáçË¶Å‰∏çÁ¥ßÊÄ•
                                </button>
                            </div>
                            <div class="matrix-row">
                                <button type="button" class="matrix-button not-important-urgent" 
                                        data-importance="not-important" data-urgency="urgent"
                                        onclick="setImportanceUrgency('not-important', 'urgent', this)">
                                    ‰∏çÈáçË¶ÅÁ¥ßÊÄ•
                                </button>
                                <button type="button" class="matrix-button not-important-not-urgent" 
                                        data-importance="not-important" data-urgency="not-urgent"
                                        onclick="setImportanceUrgency('not-important', 'not-urgent', this)">
                                    ‰∏çÈáçË¶Å‰∏çÁ¥ßÊÄ•
                                </button>
                            </div>
                        </div>
                        <input type="hidden" id="todoImportance">
                        <input type="hidden" id="todoUrgency">
                    </div>
                    
                    <div class="col-12">
                        <label for="todoGroupId" class="form-label">Êó•Á®ãÁªÑ</label>
                        <select class="form-select" id="todoGroupId">
                            <option value="">Êó†</option>
                        </select>
                    </div>
                    
                    <div class="col-12">
                        <label for="todoDescription" class="form-label">ÊèèËø∞</label>
                        <textarea class="form-control" id="todoDescription" rows="3"></textarea>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" onclick="todoManager.deleteTodo(modalManager.currentTodoId)">Âà†Èô§</button>
                    <button type="button" class="btn btn-secondary" onclick="modalManager.closeAllModals()">ÂèñÊ∂à</button>
                    <button type="submit" class="btn btn-primary" onclick="modalManager.handleUpdateTodo()">Êõ¥Êñ∞ÂæÖÂäû</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ÂæÖÂäû‰∫ãÈ°πËØ¶ÊÉÖÊ®°ÊÄÅÊ°Ü -->
    <div class="modal" id="todoDetailModal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-info-circle me-2"></i><span id="todoDetailTitle"></span>
                </h5>
                <span class="close" onclick="todoManager.closeTodoDetailModal()">&times;</span>
            </div>
            
            <div class="modal-body">
                <div class="todo-detail-info">
                    <div class="detail-row">
                        <div class="detail-label">
                            <i class="fas fa-flag me-2"></i>‰ºòÂÖàÁ∫ß
                        </div>
                        <div class="detail-value" id="todoDetailPriority"></div>
                    </div>
                    
                    <div class="detail-row" id="todoDetailGroupRow" style="display: none;">
                        <div class="detail-label">
                            <i class="fas fa-folder me-2"></i>Êó•Á®ãÁªÑ
                        </div>
                        <div class="detail-value" id="todoDetailGroup"></div>
                    </div>
                    
                    <div class="detail-row" id="todoDetailDescriptionRow" style="display: none;">
                        <div class="detail-label">
                            <i class="fas fa-align-left me-2"></i>ÊèèËø∞
                        </div>
                        <div class="detail-value" id="todoDetailDescription" style="white-space: pre-wrap;"></div>
                    </div>
                    
                    <div class="detail-row" id="todoDetailDurationRow" style="display: none;">
                        <div class="detail-label">
                            <i class="fas fa-clock me-2"></i>È¢ÑËÆ°ËÄóÊó∂
                        </div>
                        <div class="detail-value" id="todoDetailDuration"></div>
                    </div>
                    
                    <div class="detail-row" id="todoDetailDueDateRow" style="display: none;">
                        <div class="detail-label">
                            <i class="fas fa-calendar-times me-2"></i>Êà™Ê≠¢Êó∂Èó¥
                        </div>
                        <div class="detail-value" id="todoDetailDueDate"></div>
                    </div>
                </div>
                
                <div class="modal-footer" style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #dee2e6;">
                    <button type="button" class="btn btn-secondary" onclick="todoManager.closeTodoDetailModal()">ÂÖ≥Èó≠</button>
                    <button type="button" class="btn btn-primary" id="todoDetailEditBtn">
                        <i class="fas fa-edit me-1"></i>ÁºñËæë
                    </button>
                    <button type="button" class="btn btn-danger" id="todoDetailDeleteBtn">
                        <i class="fas fa-trash me-1"></i>Âà†Èô§
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ÂàõÂª∫ÊèêÈÜíÊ®°ÊÄÅÊ°Ü -->
    <div class="modal" id="createReminderModal">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-bell-plus me-2"></i>ÂàõÂª∫ÊèêÈÜí
                </h5>
                <span class="close">&times;</span>
            </div>
            
            <form id="createReminderForm" class="modal-body">
                <div class="row g-3">
                    <div class="col-12">
                        <label for="newReminderTitle" class="form-label">Ê†áÈ¢ò *</label>
                        <input type="text" class="form-control form-input" id="newReminderTitle" required>
                    </div>
                    
                    <div class="col-md-6">
                        <label for="newReminderTriggerTime" class="form-label">ÊèêÈÜíÊó∂Èó¥ *</label>
                        <input type="datetime-local" class="form-control form-input" id="newReminderTriggerTime" required>
                    </div>
                    
                    <div class="col-md-6">
                        <label for="newReminderPriority" class="form-label">‰ºòÂÖàÁ∫ß</label>
                        <select class="form-select" id="newReminderPriority">
                            <option value="low">‰Ωé</option>
                            <option value="normal" selected>ÊôÆÈÄö</option>
                            <option value="high">È´ò</option>
                            <option value="urgent">Á¥ßÊÄ•</option>
                        </select>
                    </div>
                    
                    <div class="col-12">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="newReminderRepeat" onchange="toggleRepeatOptions('new')">
                            <label class="form-check-label" for="newReminderRepeat">
                                <i class="fas fa-repeat me-2"></i>ÈáçÂ§çÊèêÈÜí
                            </label>
                        </div>
                    </div>
                    
                    <div class="col-12" id="newRepeatOptions" style="display: none;">
                        <div class="card bg-light">
                            <div class="card-body p-3">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label for="newRepeatFreq" class="form-label">ÈáçÂ§çÈ¢ëÁéá</label>
                                        <select class="form-select" id="newRepeatFreq" onchange="updateRepeatOptions('new')">
                                            <option value="DAILY">ÊØèÂ§©</option>
                                            <option value="WEEKLY">ÊØèÂë®</option>
                                            <option value="MONTHLY">ÊØèÊúà</option>
                                            <option value="YEARLY">ÊØèÂπ¥</option>
                                        </select>
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <label for="newRepeatInterval" class="form-label">Èó¥Èöî</label>
                                        <div class="input-group">
                                            <span class="input-group-text">ÊØè</span>
                                            <input type="number" class="form-control" id="newRepeatInterval" value="1" min="1" max="365">
                                            <span class="input-group-text" id="newIntervalUnit">Â§©</span>
                                        </div>
                                    </div>
                                    
                                    <div class="col-12" id="newWeekdaysOptions" style="display: none;">
                                        <label class="form-label">ÈáçÂ§çÊó•Êúü</label>
                                        <div class="btn-group weekdays-toggle" role="group">
                                            <input type="checkbox" class="btn-check" id="newMO" value="MO">
                                            <label class="btn btn-outline-primary btn-sm" for="newMO">‰∏Ä</label>
                                            
                                            <input type="checkbox" class="btn-check" id="newTU" value="TU">
                                            <label class="btn btn-outline-primary btn-sm" for="newTU">‰∫å</label>
                                            
                                            <input type="checkbox" class="btn-check" id="newWE" value="WE">
                                            <label class="btn btn-outline-primary btn-sm" for="newWE">‰∏â</label>
                                            
                                            <input type="checkbox" class="btn-check" id="newTH" value="TH">
                                            <label class="btn btn-outline-primary btn-sm" for="newTH">Âõõ</label>
                                            
                                            <input type="checkbox" class="btn-check" id="newFR" value="FR">
                                            <label class="btn btn-outline-primary btn-sm" for="newFR">‰∫î</label>
                                            
                                            <input type="checkbox" class="btn-check" id="newSA" value="SA">
                                            <label class="btn btn-outline-primary btn-sm" for="newSA">ÂÖ≠</label>
                                            
                                            <input type="checkbox" class="btn-check" id="newSU" value="SU">
                                            <label class="btn btn-outline-primary btn-sm" for="newSU">Êó•</label>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-6" id="newMonthlyOptions" style="display: none;">
                                        <label for="newMonthlyType" class="form-label">ÊúàÈáçÂ§çÊñπÂºè</label>
                                        <select class="form-select" id="newMonthlyType" onchange="updateMonthlyOptions('new')">
                                            <option value="simple">ÊØèÈöîÊåáÂÆöÊúàÊï∞</option>
                                            <option value="bymonthday">ÊåâÊó•ÊúüÔºà‰æãÂ¶ÇÔºöÊØèÊúà15Êó•Ôºâ</option>
                                            <option value="byweekday">ÊåâÊòüÊúüÔºà‰æãÂ¶ÇÔºöÊØèÊúàÁ¨¨‰∫å‰∏™Âë®‰∏ÄÔºâ</option>
                                        </select>
                                    </div>                    <!-- ÊåâÊó•ÊúüÈáçÂ§çÁöÑÈÄâÊã© -->
                    <div class="col-md-6" id="newMonthlyDateOptions" style="display: none;">
                        <label for="newMonthlyDate" class="form-label">ÈÄâÊã©Êó•Êúü</label>
                        <select class="form-select" id="newMonthlyDate">
                            <option value="1">1Êó•</option>
                            <option value="2">2Êó•</option>
                            <option value="3">3Êó•</option>
                            <option value="4">4Êó•</option>
                            <option value="5">5Êó•</option>
                            <option value="6">6Êó•</option>
                            <option value="7">7Êó•</option>
                            <option value="8">8Êó•</option>
                            <option value="9">9Êó•</option>
                            <option value="10">10Êó•</option>
                            <option value="11">11Êó•</option>
                            <option value="12">12Êó•</option>
                            <option value="13">13Êó•</option>
                            <option value="14">14Êó•</option>
                            <option value="15">15Êó•</option>
                            <option value="16">16Êó•</option>
                            <option value="17">17Êó•</option>
                            <option value="18">18Êó•</option>
                            <option value="19">19Êó•</option>
                            <option value="20">20Êó•</option>
                            <option value="21">21Êó•</option>
                            <option value="22">22Êó•</option>
                            <option value="23">23Êó•</option>
                            <option value="24">24Êó•</option>
                            <option value="25">25Êó•</option>
                            <option value="26">26Êó•</option>
                            <option value="27">27Êó•</option>
                            <option value="28">28Êó•</option>
                            <option value="29">29Êó•</option>
                            <option value="30">30Êó•</option>
                            <option value="31">31Êó•</option>
                            <option value="-1">ÊúàÊú´</option>
                        </select>
                    </div>
                    
                    <!-- ÊåâÊòüÊúüÈáçÂ§çÁöÑÈÄâÊã© -->
                    <div class="col-md-3" id="newMonthlyWeekOptions" style="display: none;">
                        <label for="newMonthlyWeek" class="form-label">Á¨¨Âá†Âë®</label>
                        <select class="form-select" id="newMonthlyWeek">
                            <option value="1">Á¨¨‰∏ÄÂë®</option>
                            <option value="2">Á¨¨‰∫åÂë®</option>
                            <option value="3">Á¨¨‰∏âÂë®</option>
                            <option value="4">Á¨¨ÂõõÂë®</option>
                            <option value="-1">ÊúÄÂêé‰∏ÄÂë®</option>
                        </select>
                    </div>
                    
                    <div class="col-md-3" id="newMonthlyWeekdayOptions" style="display: none;">
                        <label for="newMonthlyWeekday" class="form-label">ÊòüÊúüÂá†</label>
                        <select class="form-select" id="newMonthlyWeekday">
                            <option value="MO">Âë®‰∏Ä</option>
                            <option value="TU">Âë®‰∫å</option>
                            <option value="WE">Âë®‰∏â</option>
                            <option value="TH">Âë®Âõõ</option>
                            <option value="FR">Âë®‰∫î</option>
                            <option value="SA">Âë®ÂÖ≠</option>
                            <option value="SU">Âë®Êó•</option>
                        </select>
                    </div>                                    <div class="col-md-6">
                                        <label for="newRepeatUntil" class="form-label">ÁªìÊùüÊó∂Èó¥ÔºàÂèØÈÄâÔºâ</label>
                                        <input type="date" class="form-control" id="newRepeatUntil">
                                    </div>
                                </div>
                                
                                <div class="mt-2">
                                    <small class="text-muted">
                                        <i class="fas fa-info-circle me-1"></i>
                                        <span id="newRepeatPreview">È¢ÑËßàÔºö‰∏çÈáçÂ§ç</span>
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-12">
                        <label for="newReminderContent" class="form-label">ÊèêÈÜíÂÜÖÂÆπ</label>
                        <textarea class="form-control" id="newReminderContent" rows="3"></textarea>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="modalManager.closeAllModals()">ÂèñÊ∂à</button>
                    <button type="submit" class="btn btn-primary">ÂàõÂª∫ÊèêÈÜí</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ÁºñËæëÊèêÈÜíÊ®°ÊÄÅÊ°Ü -->
    <div class="modal" id="editReminderModal">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-bell-edit me-2"></i>ÁºñËæëÊèêÈÜí
                </h5>
                <span class="close">&times;</span>
            </div>
            
            <form id="editReminderForm" class="modal-body">
                <input type="hidden" id="reminderId">
                
                <div class="row g-3">
                    <div class="col-12">
                        <label for="reminderTitle" class="form-label">Ê†áÈ¢ò *</label>
                        <input type="text" class="form-control form-input" id="reminderTitle" required>
                    </div>
                    
                    <div class="col-md-6">
                        <label for="reminderTriggerTime" class="form-label">ÊèêÈÜíÊó∂Èó¥ *</label>
                        <input type="datetime-local" class="form-control form-input" id="reminderTriggerTime" required>
                    </div>
                    
                    <div class="col-md-6">
                        <label for="reminderPriority" class="form-label">‰ºòÂÖàÁ∫ß</label>
                        <select class="form-select" id="reminderPriority">
                            <option value="low">‰Ωé</option>
                            <option value="normal">ÊôÆÈÄö</option>
                            <option value="high">È´ò</option>
                            <option value="urgent">Á¥ßÊÄ•</option>
                        </select>
                    </div>
                    
                    <div class="col-12">
                        <label for="reminderContent" class="form-label">ÊèêÈÜíÂÜÖÂÆπ</label>
                        <textarea class="form-control" id="reminderContent" rows="3"></textarea>
                    </div>
                    
                    <div class="col-12">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="reminderRepeat" onchange="if(!this.disabled) toggleRepeatOptions('edit'); else this.checked = false;">
                            <label class="form-check-label" for="reminderRepeat">
                                <i class="fas fa-repeat me-2"></i>ÈáçÂ§çÊèêÈÜí
                            </label>
                        </div>
                    </div>
                    
                    <div class="col-12" id="editRepeatOptions" style="display: none;">
                        <div class="card bg-light">
                            <div class="card-body p-3">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label for="reminderRepeatFreq" class="form-label">ÈáçÂ§çÈ¢ëÁéá</label>
                                        <select class="form-select" id="reminderRepeatFreq" onchange="updateRepeatOptions('edit')">
                                            <option value="DAILY">ÊØèÂ§©</option>
                                            <option value="WEEKLY">ÊØèÂë®</option>
                                            <option value="MONTHLY">ÊØèÊúà</option>
                                            <option value="YEARLY">ÊØèÂπ¥</option>
                                        </select>
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <label for="reminderRepeatInterval" class="form-label">Èó¥Èöî</label>
                                        <div class="input-group">
                                            <span class="input-group-text">ÊØè</span>
                                            <input type="number" class="form-control" id="reminderRepeatInterval" value="1" min="1" max="365">
                                            <span class="input-group-text" id="reminderIntervalUnit">Â§©</span>
                                        </div>
                                    </div>
                                    
                                    <div class="col-12" id="reminderWeekdaysOptions" style="display: none;">
                                        <label class="form-label">ÈáçÂ§çÊó•Êúü</label>
                                        <div class="btn-group weekdays-toggle" role="group">
                                            <input type="checkbox" class="btn-check" id="reminderMO" value="MO">
                                            <label class="btn btn-outline-primary btn-sm" for="reminderMO">‰∏Ä</label>
                                            
                                            <input type="checkbox" class="btn-check" id="reminderTU" value="TU">
                                            <label class="btn btn-outline-primary btn-sm" for="reminderTU">‰∫å</label>
                                            
                                            <input type="checkbox" class="btn-check" id="reminderWE" value="WE">
                                            <label class="btn btn-outline-primary btn-sm" for="reminderWE">‰∏â</label>
                                            
                                            <input type="checkbox" class="btn-check" id="reminderTH" value="TH">
                                            <label class="btn btn-outline-primary btn-sm" for="reminderTH">Âõõ</label>
                                            
                                            <input type="checkbox" class="btn-check" id="reminderFR" value="FR">
                                            <label class="btn btn-outline-primary btn-sm" for="reminderFR">‰∫î</label>
                                            
                                            <input type="checkbox" class="btn-check" id="reminderSA" value="SA">
                                            <label class="btn btn-outline-primary btn-sm" for="reminderSA">ÂÖ≠</label>
                                            
                                            <input type="checkbox" class="btn-check" id="reminderSU" value="SU">
                                            <label class="btn btn-outline-primary btn-sm" for="reminderSU">Êó•</label>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-6" id="reminderMonthlyOptions" style="display: none;">
                                        <label for="reminderRepeatBy" class="form-label">ÊúàÈáçÂ§çÊñπÂºè</label>
                                        <select class="form-select" id="reminderRepeatBy" onchange="updateMonthlyOptions('edit')">
                                            <option value="simple">ÊØèÈöîX‰∏™Êúà</option>
                                            <option value="bymonthday">ÊåâÊó•ÊúüÔºà‰æãÂ¶ÇÔºöÊØèÊúà15Êó•Ôºâ</option>
                                            <option value="byweekday">ÊåâÊòüÊúüÔºà‰æãÂ¶ÇÔºöÊØèÊúàÁ¨¨‰∫å‰∏™Âë®‰∏ÄÔºâ</option>
                                        </select>
                                    </div>
                                    
                                    <!-- ÊåâÊó•ÊúüÈáçÂ§çÁöÑÈÄâÊã© -->
                                    <div class="col-md-6" id="editMonthlyDateOptions" style="display: none;">
                                        <label for="editMonthlyDate" class="form-label">ÈÄâÊã©Êó•Êúü</label>
                                        <select class="form-select" id="editMonthlyDate">
                                            <option value="1">1Êó•</option>
                                            <option value="2">2Êó•</option>
                                            <option value="3">3Êó•</option>
                                            <option value="4">4Êó•</option>
                                            <option value="5">5Êó•</option>
                                            <option value="6">6Êó•</option>
                                            <option value="7">7Êó•</option>
                                            <option value="8">8Êó•</option>
                                            <option value="9">9Êó•</option>
                                            <option value="10">10Êó•</option>
                                            <option value="11">11Êó•</option>
                                            <option value="12">12Êó•</option>
                                            <option value="13">13Êó•</option>
                                            <option value="14">14Êó•</option>
                                            <option value="15">15Êó•</option>
                                            <option value="16">16Êó•</option>
                                            <option value="17">17Êó•</option>
                                            <option value="18">18Êó•</option>
                                            <option value="19">19Êó•</option>
                                            <option value="20">20Êó•</option>
                                            <option value="21">21Êó•</option>
                                            <option value="22">22Êó•</option>
                                            <option value="23">23Êó•</option>
                                            <option value="24">24Êó•</option>
                                            <option value="25">25Êó•</option>
                                            <option value="26">26Êó•</option>
                                            <option value="27">27Êó•</option>
                                            <option value="28">28Êó•</option>
                                            <option value="29">29Êó•</option>
                                            <option value="30">30Êó•</option>
                                            <option value="31">31Êó•</option>
                                            <option value="-1">ÊúàÊú´</option>
                                        </select>
                                    </div>
                                    
                                    <!-- ÊåâÊòüÊúüÈáçÂ§çÁöÑÈÄâÊã© -->
                                    <div class="col-md-3" id="editMonthlyWeekOptions" style="display: none;">
                                        <label for="editMonthlyWeek" class="form-label">Á¨¨Âá†Âë®</label>
                                        <select class="form-select" id="editMonthlyWeek">
                                            <option value="1">Á¨¨‰∏ÄÂë®</option>
                                            <option value="2">Á¨¨‰∫åÂë®</option>
                                            <option value="3">Á¨¨‰∏âÂë®</option>
                                            <option value="4">Á¨¨ÂõõÂë®</option>
                                            <option value="-1">ÊúÄÂêé‰∏ÄÂë®</option>
                                        </select>
                                    </div>
                                    
                                    <div class="col-md-3" id="editMonthlyWeekdayOptions" style="display: none;">
                                        <label for="editMonthlyWeekday" class="form-label">ÊòüÊúüÂá†</label>
                                        <select class="form-select" id="editMonthlyWeekday">
                                            <option value="MO">Âë®‰∏Ä</option>
                                            <option value="TU">Âë®‰∫å</option>
                                            <option value="WE">Âë®‰∏â</option>
                                            <option value="TH">Âë®Âõõ</option>
                                            <option value="FR">Âë®‰∫î</option>
                                            <option value="SA">Âë®ÂÖ≠</option>
                                            <option value="SU">Âë®Êó•</option>
                                        </select>
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <label for="reminderRepeatUntil" class="form-label">ÁªìÊùüÊó∂Èó¥ÔºàÂèØÈÄâÔºâ</label>
                                        <input type="date" class="form-control" id="reminderRepeatUntil">
                                    </div>
                                </div>
                                
                                <div class="mt-2">
                                    <small class="text-muted">
                                        <i class="fas fa-info-circle me-1"></i>
                                        <span id="reminderRepeatPreview">È¢ÑËßàÔºö‰∏çÈáçÂ§ç</span>
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
            
            <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="modalManager.closeAllModals()">ÂèñÊ∂à</button>
                    <button type="submit" class="btn btn-primary" onclick="modalManager.handleUpdateReminder()">Êõ¥Êñ∞ÊèêÈÜí</button>
                </div>
        </div>
    </div>

    <!-- ÊèêÈÜíËØ¶ÊÉÖÊ®°ÊÄÅÊ°ÜÔºà‰ªéÊó•ÂéÜÁÇπÂáªÊó∂ÊâìÂºÄÔºâ-->
    <!-- ÊèêÈÜíËØ¶ÊÉÖÊ®°ÊÄÅÊ°ÜÔºà‰ªéÊó•ÂéÜÊàñÂàóË°®ÁÇπÂáªÊó∂ÊâìÂºÄÔºâ-->
    <div class="modal" id="reminderDetailModal">
        <div class="modal-content" style="max-width: 550px;">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-bell me-2"></i><span id="reminderDetailTitle"></span>
                </h5>
                <span class="close" onclick="eventManager.closeReminderDetailModal()">&times;</span>
            </div>
            
            <div class="modal-body">
                <div class="reminder-detail-info">
                    <!-- ‰ºòÂÖàÁ∫ß -->
                    <div class="detail-row">
                        <div class="detail-label">
                            <i class="fas fa-flag me-2"></i>‰ºòÂÖàÁ∫ß
                        </div>
                        <div class="detail-value" id="reminderDetailPriority"></div>
                    </div>
                    
                    <!-- ÊèêÈÜíÊó∂Èó¥ -->
                    <div class="detail-row">
                        <div class="detail-label">
                            <i class="far fa-clock me-2"></i>ÊèêÈÜíÊó∂Èó¥
                        </div>
                        <div class="detail-value" id="reminderDetailTime"></div>
                    </div>
                    
                    <!-- ÊèèËø∞Ôºà‰ªÖÂú®ÊúâÂÜÖÂÆπÊó∂ÊòæÁ§∫Ôºâ-->
                    <div class="detail-row" id="reminderDetailDescriptionRow" style="display: none;">
                        <div class="detail-label">
                            <i class="far fa-file-alt me-2"></i>ÊèèËø∞
                        </div>
                        <div class="detail-value" id="reminderDetailDescription" style="white-space: pre-wrap;"></div>
                    </div>
                    
                    <!-- ÈáçÂ§çËßÑÂàôÔºà‰ªÖÂú®ÊúâÊó∂ÊòæÁ§∫Ôºâ-->
                    <div class="detail-row" id="reminderDetailRRuleRow" style="display: none;">
                        <div class="detail-label">
                            <i class="fas fa-repeat me-2"></i>ÈáçÂ§çËßÑÂàô
                        </div>
                        <div class="detail-value" id="reminderDetailRRule" style="font-family: monospace; font-size: 0.9em;"></div>
                    </div>
                    
                    <!-- ÊèêÂâçÊèêÈÜíÔºà‰ªÖÂú®ÊúâÊó∂ÊòæÁ§∫Ôºâ-->
                    <div class="detail-row" id="reminderDetailAdvanceRow" style="display: none;">
                        <div class="detail-label">
                            <i class="fas fa-bell-plus me-2"></i>ÊèêÂâçÊèêÈÜí
                        </div>
                        <div class="detail-value" id="reminderDetailAdvance"></div>
                    </div>
                </div>
                
                <!-- Áä∂ÊÄÅÂíåÂª∂ÂêéÊåâÈíÆ -->
                <div class="d-flex flex-wrap gap-2 mt-3 mb-3" id="reminderDetailStatusButtons">
                    <!-- Âä®ÊÄÅÂ°´ÂÖÖ -->
                </div>
                
                <!-- Êìç‰ΩúÊåâÈíÆ -->
                <div class="modal-footer" style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #dee2e6;">
                    <button type="button" class="btn btn-secondary" onclick="eventManager.closeReminderDetailModal()">ÂÖ≥Èó≠</button>
                    <button type="button" class="btn btn-primary" id="reminderDetailEditBtn">
                        <i class="fas fa-edit me-1"></i>ÁºñËæë
                    </button>
                    <button type="button" class="btn btn-danger" id="reminderDetailDeleteBtn">
                        <i class="fas fa-trash me-1"></i>Âà†Èô§
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Êó•Á®ãËØ¶ÊÉÖÊ®°ÊÄÅÊ°ÜÔºàÈ¢ÑËßàÊ®°ÂºèÔºâ-->
    <div class="modal" id="eventDetailModal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-calendar-day me-2"></i><span id="eventDetailTitle"></span>
                </h5>
                <span class="close" onclick="eventManager.closeEventDetailModal()">&times;</span>
            </div>
            
            <div class="modal-body">
                <div class="event-detail-info">
                    <!-- Êó∂Èó¥ -->
                    <div class="detail-row">
                        <div class="detail-label">
                            <i class="far fa-clock me-2"></i>Êó∂Èó¥
                        </div>
                        <div class="detail-value" id="eventDetailTime"></div>
                    </div>
                    
                    <!-- Êó•Á®ãÁªÑÔºà‰ªÖÂú®ÊúâÊó∂ÊòæÁ§∫Ôºâ-->
                    <div class="detail-row" id="eventDetailGroupRow" style="display: none;">
                        <div class="detail-label">
                            <i class="fas fa-folder me-2"></i>Êó•Á®ãÁªÑ
                        </div>
                        <div class="detail-value" id="eventDetailGroup"></div>
                    </div>
                    
                    <!-- ÈáçË¶ÅÊÄß/Á¥ßÊÄ•ÊÄß -->
                    <div class="detail-row" id="eventDetailPriorityRow" style="display: none;">
                        <div class="detail-label">
                            <i class="fas fa-flag me-2"></i>‰ºòÂÖàÁ∫ß
                        </div>
                        <div class="detail-value" id="eventDetailPriority"></div>
                    </div>
                    
                    <!-- ÊèèËø∞Ôºà‰ªÖÂú®ÊúâÂÜÖÂÆπÊó∂ÊòæÁ§∫Ôºâ-->
                    <div class="detail-row" id="eventDetailDescriptionRow" style="display: none;">
                        <div class="detail-label">
                            <i class="far fa-file-alt me-2"></i>ÊèèËø∞
                        </div>
                        <div class="detail-value" id="eventDetailDescription" style="white-space: pre-wrap;"></div>
                    </div>
                    
                    <!-- DDLÔºà‰ªÖÂú®ÊúâÊó∂ÊòæÁ§∫Ôºâ-->
                    <div class="detail-row" id="eventDetailDdlRow" style="display: none;">
                        <div class="detail-label">
                            <i class="fas fa-flag-checkered me-2"></i>Êà™Ê≠¢Êó∂Èó¥
                        </div>
                        <div class="detail-value" id="eventDetailDdl"></div>
                    </div>
                    
                    <!-- ÈáçÂ§çËßÑÂàôÔºà‰ªÖÂú®ÊúâÊó∂ÊòæÁ§∫Ôºâ-->
                    <div class="detail-row" id="eventDetailRRuleRow" style="display: none;">
                        <div class="detail-label">
                            <i class="fas fa-repeat me-2"></i>ÈáçÂ§çËßÑÂàô
                        </div>
                        <div class="detail-value" id="eventDetailRRule" style="font-family: monospace; font-size: 0.9em;"></div>
                    </div>
                </div>
                
                <!-- Êìç‰ΩúÊåâÈíÆ -->
                <div class="modal-footer" style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #dee2e6;">
                    <button type="button" class="btn btn-secondary" onclick="eventManager.closeEventDetailModal()">ÂÖ≥Èó≠</button>
                    <button type="button" class="btn btn-primary" id="eventDetailEditBtn">
                        <i class="fas fa-edit me-1"></i>ÁºñËæë
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- AIËÅäÂ§©Ê®°ÊÄÅÊ°Ü -->
    <div class="modal" id="aiChatModal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-robot me-2"></i>AIÊô∫ËÉΩÂä©Êâã
                </h5>
                <span class="close">&times;</span>
            </div>
            
            <div class="modal-body">
                <div class="chat-container">
                    <div id="chatMessages" class="chat-messages">
                        <div class="ai-message">
                            <div class="message-avatar">
                                <i class="fas fa-robot"></i>
                            </div>
                            <div class="message-content">
                                ÊÇ®Â•ΩÔºÅÊàëÊòØÊÇ®ÁöÑAIÂä©ÊâãÔºåÂèØ‰ª•Â∏ÆÂä©ÊÇ®Ôºö
                                <ul>
                                    <li>Êô∫ËÉΩÂÆâÊéíÊó•Á®ã</li>
                                    <li>ÂàÜÊûê‰ªªÂä°‰ºòÂÖàÁ∫ß</li>
                                    <li>‰ºòÂåñÊó∂Èó¥ÂàÜÈÖç</li>
                                    <li>Êèê‰æõÊó•Á®ãÂª∫ËÆÆ</li>
                                </ul>
                                Êúâ‰ªÄ‰πàÂèØ‰ª•Â∏ÆÂä©ÊÇ®ÁöÑÂêóÔºü
                            </div>
                        </div>
                    </div>
                    
                    <div class="chat-input">
                        <div class="input-group">
                            <input type="text" class="form-control" id="chatInput" placeholder="ËæìÂÖ•ÊÇ®ÁöÑÈóÆÈ¢ò...">
                            <button class="btn btn-primary" type="button" onclick="aiAssistant.sendMessage()">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Êó•Á®ãÁªÑÁÆ°ÁêÜÊ®°ÊÄÅÊ°Ü -->
    <!-- Êó•Á®ãÁªÑÁÆ°ÁêÜÊ®°ÊÄÅÊ°ÜÔºàÂçïÊ®°ÊÄÅÊ°ÜÔºåÂ§öÈù¢ÊùøËÆæËÆ°Ôºâ -->
    <div class="modal fade" id="manageGroupsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="groupModalTitle">
                        <i class="fas fa-layer-group me-2"></i>ÁÆ°ÁêÜÊó•Á®ãÁªÑ
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Êó•Á®ãÁªÑÂàóË°®Èù¢Êùø -->
                    <div id="groupListPanel">
                        <div class="mb-3">
                            <button class="btn btn-success btn-sm" onclick="groupManager.showCreatePanel()">
                                <i class="fas fa-plus me-1"></i>ÂàõÂª∫Êñ∞Êó•Á®ãÁªÑ
                            </button>
                        </div>
                        <div id="groupsList" class="list-group">
                            <!-- Âä®ÊÄÅÁîüÊàêÁöÑÊó•Á®ãÁªÑÂàóË°® -->
                        </div>
                    </div>

                    <!-- ÂàõÂª∫Êó•Á®ãÁªÑÈù¢Êùø -->
                    <div id="groupCreatePanel" style="display: none;">
                        <div class="mb-3">
                            <button class="btn btn-outline-secondary btn-sm" onclick="groupManager.showListPanel()">
                                <i class="fas fa-arrow-left me-1"></i>ËøîÂõûÂàóË°®
                            </button>
                        </div>
                        <div class="mb-3">
                            <label for="newGroupName" class="form-label">ÁªÑÂêç <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="newGroupName" placeholder="ËæìÂÖ•Êó•Á®ãÁªÑÂêçÁß∞">
                        </div>
                        <div class="mb-3">
                            <label for="newGroupDescription" class="form-label">ÊèèËø∞</label>
                            <textarea class="form-control" id="newGroupDescription" rows="3" placeholder="ËæìÂÖ•Êó•Á®ãÁªÑÊèèËø∞ÔºàÂèØÈÄâÔºâ"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="newGroupColor" class="form-label">È¢úËâ≤</label>
                            <input type="color" class="form-control form-control-color" id="newGroupColor" value="#3788d8">
                        </div>
                        <div class="d-grid gap-2">
                            <button type="button" class="btn btn-success" onclick="groupManager.createGroup()">
                                <i class="fas fa-save me-1"></i>ÂàõÂª∫Êó•Á®ãÁªÑ
                            </button>
                        </div>
                    </div>

                    <!-- ÁºñËæëÊó•Á®ãÁªÑÈù¢Êùø -->
                    <div id="groupEditPanel" style="display: none;">
                        <div class="mb-3">
                            <button class="btn btn-outline-secondary btn-sm" onclick="groupManager.showListPanel()">
                                <i class="fas fa-arrow-left me-1"></i>ËøîÂõûÂàóË°®
                            </button>
                        </div>
                        <input type="hidden" id="editGroupId">
                        <div class="mb-3">
                            <label for="editGroupName" class="form-label">ÁªÑÂêç <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="editGroupName" placeholder="ËæìÂÖ•Êó•Á®ãÁªÑÂêçÁß∞">
                        </div>
                        <div class="mb-3">
                            <label for="editGroupDescription" class="form-label">ÊèèËø∞</label>
                            <textarea class="form-control" id="editGroupDescription" rows="3" placeholder="ËæìÂÖ•Êó•Á®ãÁªÑÊèèËø∞ÔºàÂèØÈÄâÔºâ"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="editGroupColor" class="form-label">È¢úËâ≤</label>
                            <input type="color" class="form-control form-control-color" id="editGroupColor">
                        </div>
                        <div class="d-grid gap-2">
                            <button type="button" class="btn btn-primary" onclick="groupManager.updateGroup()">
                                <i class="fas fa-save me-1"></i>‰øùÂ≠ò‰øÆÊîπ
                            </button>
                        </div>
                    </div>

                    <!-- Âà†Èô§Êó•Á®ãÁªÑÈù¢Êùø -->
                    <div id="groupDeletePanel" style="display: none;">
                        <div class="mb-3">
                            <button class="btn btn-outline-secondary btn-sm" onclick="groupManager.showListPanel()">
                                <i class="fas fa-arrow-left me-1"></i>ËøîÂõûÂàóË°®
                            </button>
                        </div>
                        <input type="hidden" id="deleteGroupId">
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <strong>Ë≠¶ÂëäÔºö</strong>Ê≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄÔºÅ
                        </div>
                        <p class="mb-3">ËØ∑ÈÄâÊã©Âà†Èô§ÊñπÂºèÔºö</p>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="radio" name="deleteOption" id="deleteGroupOnly" value="group" checked>
                            <label class="form-check-label" for="deleteGroupOnly">
                                <i class="fas fa-folder-minus me-1"></i>Âè™Âà†Èô§Êó•Á®ãÁªÑÔºà‰øùÁïôÊó•Á®ãÔºâ
                            </label>
                        </div>
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="radio" name="deleteOption" id="deleteGroupAndEvents" value="all">
                            <label class="form-check-label" for="deleteGroupAndEvents">
                                <i class="fas fa-trash-alt me-1"></i>Âà†Èô§Êó•Á®ãÁªÑÂèäÂÖ∂ÊâÄÊúâÊó•Á®ã
                            </label>
                        </div>
                        <div class="d-grid gap-2">
                            <button type="button" class="btn btn-danger" onclick="groupManager.confirmDeleteGroup()">
                                <i class="fas fa-trash me-1"></i>Á°ÆËÆ§Âà†Èô§
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Áî®Êà∑ËÆæÁΩÆÊ®°ÊÄÅÊ°Ü -->
    <div class="modal fade" id="settingsModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-cog me-2"></i>Áî®Êà∑ËÆæÁΩÆ
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Tabs ÂØºËà™ -->
                    <ul class="nav nav-tabs mb-4" id="settingsTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="basic-tab" data-bs-toggle="tab" 
                                    data-bs-target="#basic-settings" type="button" role="tab">
                                <i class="fas fa-user-cog me-2"></i>Âü∫Êú¨ËÆæÁΩÆ
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="schedule-tab" data-bs-toggle="tab" 
                                    data-bs-target="#schedule-settings" type="button" role="tab">
                                <i class="fas fa-calendar-alt me-2"></i>Êó•Á®ãÂÅèÂ•Ω
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="display-tab" data-bs-toggle="tab" 
                                    data-bs-target="#display-settings" type="button" role="tab">
                                <i class="fas fa-palette me-2"></i>ÊòæÁ§∫ÂÅèÂ•Ω
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="reminder-tab" data-bs-toggle="tab" 
                                    data-bs-target="#reminder-settings" type="button" role="tab">
                                <i class="fas fa-bell me-2"></i>ÊèêÈÜíËÆæÁΩÆ
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="ai-tab" data-bs-toggle="tab" 
                                    data-bs-target="#ai-settings" type="button" role="tab">
                                <i class="fas fa-robot me-2"></i>AI ËÆæÁΩÆ
                            </button>
                        </li>
                    </ul>

                    <!-- Tabs ÂÜÖÂÆπ -->
                    <div class="tab-content" id="settingsTabContent">
                        <!-- Âü∫Êú¨ËÆæÁΩÆ -->
                        <div class="tab-pane fade show active" id="basic-settings" role="tabpanel">
                            <h6 class="mb-3 text-primary"><i class="fas fa-cog me-2"></i>Âë®Êï∞ÊòæÁ§∫ËÆæÁΩÆ</h6>
                            
                            <div class="row g-3">
                                <div class="col-12">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="showWeekNumber" checked>
                                        <label class="form-check-label" for="showWeekNumber">
                                            <strong>ÊòæÁ§∫Âë®Êï∞</strong>
                                        </label>
                                    </div>
                                    <small class="text-muted">Âú®Êó•ÂéÜÊ†áÈ¢òÊóÅÊòæÁ§∫"Á¨¨NÂë®"ÂæΩÁ´†</small>
                                </div>
                                
                                <div class="col-12">
                                    <hr>
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <label class="form-label mb-0">
                                            <strong>Â≠¶Êúü/Âë®ÊúüËÆæÁΩÆ</strong>
                                        </label>
                                        <button type="button" class="btn btn-sm btn-primary" onclick="addWeekPeriod()">
                                            <i class="fas fa-plus me-1"></i>Ê∑ªÂä†Â≠¶Êúü
                                        </button>
                                    </div>
                                    <small class="text-muted d-block mb-3">
                                        ËÆæÁΩÆÂ§ö‰∏™Â≠¶ÊúüÁöÑËµ∑ÂßãÊó•Êúü,Á≥ªÁªü‰ºöËá™Âä®ÈÄâÊã©ÊúÄËøëÁöÑÂ≠¶ÊúüËÆ°ÁÆóÂë®Êï∞„ÄÇ
                                        ‰æãÂ¶Ç: Êò•Â≠£Â≠¶Êúü(2Êúà24Êó•)„ÄÅÁßãÂ≠£Â≠¶Êúü(9Êúà1Êó•)
                                    </small>
                                    
                                    <!-- Âë®ÊúüÂàóË°®ÂÆπÂô® -->
                                    <div id="weekPeriodsList" class="mb-3">
                                        <!-- Âë®ÊúüÈ°π‰ºöÂä®ÊÄÅÊ∑ªÂä†Âà∞ËøôÈáå -->
                                    </div>
                                    
                                    <div class="alert alert-warning mb-0">
                                        <i class="fas fa-exclamation-triangle me-2"></i>
                                        <strong>Ê≥®ÊÑèÔºö</strong>
                                        <ul class="mb-0 mt-2">
                                            <li>Â¶ÇÊûúÂΩìÂâçÊó•ÊúüÊâæ‰∏çÂà∞‰ªª‰ΩïÂ≠¶ÊúüËµ∑ÂßãÊó•Êúü,Â∞Ü‰∏çÊòæÁ§∫Âë®Êï∞</li>
                                            <li>Á≥ªÁªü‰ºöÂêëÂâçÊü•ÊâæË∑ùÁ¶ªÊúÄËøëÁöÑËµ∑ÂßãÊó•Êúü</li>
                                            <li>Ëá≥Â∞ëÈúÄË¶ÅÊ∑ªÂä†‰∏Ä‰∏™Â≠¶ÊúüÊâçËÉΩÊòæÁ§∫Âë®Êï∞</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Êó•Á®ãÂÅèÂ•Ω -->
                        <div class="tab-pane fade" id="schedule-settings" role="tabpanel">
                            <h6 class="mb-3 text-primary"><i class="fas fa-sliders-h me-2"></i>Êó•Á®ãÈªòËÆ§ËÆæÁΩÆ</h6>
                            
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label for="defaultEventDuration" class="form-label">
                                        ÈªòËÆ§Êó•Á®ãÊó∂ÈïøÔºàÂàÜÈíüÔºâ
                                        <span class="badge bg-secondary">Âç≥Â∞ÜÊé®Âá∫</span>
                                    </label>
                                    <input type="number" class="form-control" id="defaultEventDuration" 
                                           min="5" max="480" step="5" value="60" disabled>
                                    <small class="text-muted">Êñ∞Âª∫Êó•Á®ãÁöÑÈªòËÆ§ÊåÅÁª≠Êó∂Èó¥</small>
                                </div>
                                <div class="col-md-6">
                                    <label for="weekStartsOn" class="form-label">
                                        ÊØèÂë®Ëµ∑ÂßãÊó•
                                    </label>
                                    <select class="form-select" id="weekStartsOn">
                                        <option value="0">Âë®Êó•</option>
                                        <option value="1" selected>Âë®‰∏Ä</option>
                                        <option value="2">Âë®‰∫å</option>
                                        <option value="3">Âë®‰∏â</option>
                                        <option value="4">Âë®Âõõ</option>
                                        <option value="5">Âë®‰∫î</option>
                                        <option value="6">Âë®ÂÖ≠</option>
                                    </select>
                                    <small class="text-muted">Êó•ÂéÜÂíåÂë®Êï∞ËÆ°ÁÆóÁöÑËµ∑ÂßãÊó•</small>
                                </div>
                                <div class="col-md-6">
                                    <label for="workHoursStart" class="form-label">
                                        Â∑•‰ΩúÊó∂Èó¥ - ÂºÄÂßã
                                        <span class="badge bg-secondary">Âç≥Â∞ÜÊé®Âá∫</span>
                                    </label>
                                    <input type="time" class="form-control" id="workHoursStart" value="09:00" disabled>
                                </div>
                                <div class="col-md-6">
                                    <label for="workHoursEnd" class="form-label">
                                        Â∑•‰ΩúÊó∂Èó¥ - ÁªìÊùü
                                        <span class="badge bg-secondary">Âç≥Â∞ÜÊé®Âá∫</span>
                                    </label>
                                    <input type="time" class="form-control" id="workHoursEnd" value="18:00" disabled>
                                </div>
                                <div class="col-12">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="autoDdl" checked>
                                        <label class="form-check-label" for="autoDdl">
                                            Ëá™Âä®Â∞ÜÊó•Á®ãÁªìÊùüÊó∂Èó¥ËÆæÁΩÆ‰∏∫Êà™Ê≠¢Êó∂Èó¥
                                        </label>
                                    </div>
                                    <small class="text-muted">Êñ∞Âª∫Êó•Á®ãÊó∂ÔºåËá™Âä®Â∞ÜÁªìÊùüÊó∂Èó¥Â°´ÂÖ•DDLÂ≠óÊÆµ</small>
                                </div>
                                <div class="col-12">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="showWeekends" checked>
                                        <label class="form-check-label" for="showWeekends">
                                            Êó•ÂéÜÊòæÁ§∫Âë®Êú´
                                        </label>
                                    </div>
                                    <small class="text-muted">Âú®Êó•ÂéÜËßÜÂõæ‰∏≠ÊòæÁ§∫ÊàñÈöêËóèÂë®ÂÖ≠ÂíåÂë®Êó•</small>
                                </div>
                            </div>
                        </div>

                        <!-- ÊòæÁ§∫ÂÅèÂ•Ω -->
                        <div class="tab-pane fade" id="display-settings" role="tabpanel">
                            <h6 class="mb-3 text-primary"><i class="fas fa-eye me-2"></i>ÁïåÈù¢ÊòæÁ§∫</h6>
                            
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label for="calendarViewDefault" class="form-label">
                                        ÈªòËÆ§Êó•ÂéÜËßÜÂõæ
                                    </label>
                                    <select class="form-select" id="calendarViewDefault">
                                        <option value="dayGridMonth" selected>ÊúàËßÜÂõæ</option>
                                        <option value="timeGridWeek">Âë®ËßÜÂõæ</option>
                                        <option value="timeGridDay">Êó•ËßÜÂõæ</option>
                                        <option value="listWeek">ÂàóË°®ËßÜÂõæ</option>
                                    </select>
                                    <small class="text-muted">ÈáçÊñ∞ÁôªÂΩïÊó∂‰ΩøÁî®ÁöÑËßÜÂõæ,Âà∑Êñ∞È°µÈù¢‰ºö‰øùÁïôÂΩìÂâçËßÜÂõæ</small>
                                </div>
                                <div class="col-md-6">
                                    <label for="theme" class="form-label">
                                        ‰∏ªÈ¢òÊ®°Âºè
                                    </label>
                                    <select class="form-select" id="theme">
                                        <optgroup label="Âü∫Á°Ä‰∏ªÈ¢ò">
                                            <option value="light">ÊµÖËâ≤Ê®°Âºè</option>
                                            <option value="dark">Ê∑±Ëâ≤Ê®°Âºè</option>
                                            <option value="auto" selected>Ë∑üÈöèÁ≥ªÁªü</option>
                                        </optgroup>
                                        <optgroup label="ÂàõÊÑè‰∏ªÈ¢ò I">
                                            <option value="china-red">üá®üá≥ ‰∏≠ÂõΩÁ∫¢</option>
                                            <option value="warm-pastel">üå∏ Ê∑°ÊöñËâ≤</option>
                                            <option value="cool-pastel">‚ùÑÔ∏è Ê∑°ÂÜ∑Ëâ≤</option>
                                            <option value="macaron">üç∞ È©¨Âç°Èæô</option>
                                            <option value="dopamine">‚ö° Â§öÂ∑¥ËÉ∫</option>
                                        </optgroup>
                                        <optgroup label="ÂàõÊÑè‰∏ªÈ¢ò II">
                                            <option value="forest">üå≤ Ê£ÆÊûó</option>
                                            <option value="sunset">üåÖ Êó•ËêΩ</option>
                                            <option value="ocean">üåä Êµ∑Ê¥ã</option>
                                            <option value="sakura">üå∏ Ê®±Ëä±</option>
                                            <option value="cyberpunk">ü§ñ ËµõÂçöÊúãÂÖã</option>
                                        </optgroup>
                                    </select>
                                    <small class="text-muted">ÂàáÊç¢Â∫îÁî®ÁöÑÂ§ñËßÇ‰∏ªÈ¢ò (ÂÖ±13Áßç‰∏ªÈ¢òÂèØÈÄâ)</small>
                                </div>
                                <div class="col-md-6">
                                    <div class="pt-4">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="useGoldTheme">
                                            <label class="form-check-label" for="useGoldTheme">
                                                <i class="fas fa-crown text-warning me-1"></i>‰ΩøÁî®ÈáëËâ≤‰∏ªÈ¢ò
                                            </label>
                                        </div>
                                        <small class="text-muted d-block mt-1">
                                            ‰∏∫ÊµÖËâ≤/Ê∑±Ëâ≤‰∏ªÈ¢òÊ∑ªÂä†ÈáëËâ≤Âº∫Ë∞ÉËâ≤ÔºàÁôΩÈáë/ÈªëÈáëÔºâ
                                        </small>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label for="eventColorBy" class="form-label">
                                        Êó•Á®ãÈ¢úËâ≤ÊñπÊ°à
                                        <span class="badge bg-secondary">Âç≥Â∞ÜÊé®Âá∫</span>
                                    </label>
                                    <select class="form-select" id="eventColorBy" disabled>
                                        <option value="default" selected>ÈªòËÆ§</option>
                                        <option value="priority">Êåâ‰ºòÂÖàÁ∫ß</option>
                                        <option value="type">ÊåâÁ±ªÂûã</option>
                                    </select>
                                </div>
                                <div class="col-12">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="showCompletedEvents" checked disabled>
                                        <label class="form-check-label" for="showCompletedEvents">
                                            ÊòæÁ§∫Â∑≤ÂÆåÊàêÁöÑÊó•Á®ã
                                            <span class="badge bg-secondary">Âç≥Â∞ÜÊé®Âá∫</span>
                                        </label>
                                    </div>
                                    <small class="text-muted">Âú®Êó•ÂéÜ‰∏≠ÊòæÁ§∫ÊàñÈöêËóèÂ∑≤Ê†áËÆ∞‰∏∫ÂÆåÊàêÁöÑÊó•Á®ã</small>
                                </div>
                            </div>
                        </div>

                        <!-- ÊèêÈÜíËÆæÁΩÆ -->
                        <div class="tab-pane fade" id="reminder-settings" role="tabpanel">
                            <h6 class="mb-3 text-primary"><i class="fas fa-clock me-2"></i>ÊèêÈÜíÈÄâÈ°π</h6>
                            
                            <div class="row g-3">
                                <div class="col-12">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="reminderEnabled" checked disabled>
                                        <label class="form-check-label" for="reminderEnabled">
                                            ÂêØÁî®ÊèêÈÜíÂºπÁ™óÈÄöÁü•
                                            <span class="badge bg-secondary">Âç≥Â∞ÜÊé®Âá∫</span>
                                        </label>
                                    </div>
                                    <small class="text-muted">ÊèêÈÜíÂà∞ÊúüÊó∂ÊòØÂê¶ÂºπÂá∫ÊµèËßàÂô®ÈÄöÁü•</small>
                                </div>
                                <div class="col-12">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="reminderSound" checked disabled>
                                        <label class="form-check-label" for="reminderSound">
                                            ÊèêÈÜíÂ£∞Èü≥
                                            <span class="badge bg-secondary">Âç≥Â∞ÜÊé®Âá∫</span>
                                        </label>
                                    </div>
                                    <small class="text-muted">ÊèêÈÜíÊó∂Êí≠ÊîæÊèêÁ§∫Èü≥</small>
                                </div>
                            </div>
                        </div>

                        <!-- AI ËÆæÁΩÆ -->
                        <div class="tab-pane fade" id="ai-settings" role="tabpanel">
                            <h6 class="mb-3 text-primary"><i class="fas fa-brain me-2"></i>AI Âä©ÊâãÈÄâÈ°π</h6>
                            
                            <div class="row g-3">
                                <div class="col-12">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="aiEnabled" checked disabled>
                                        <label class="form-check-label" for="aiEnabled">
                                            ÂêØÁî® AI ÂäüËÉΩ
                                            <span class="badge bg-secondary">Âç≥Â∞ÜÊé®Âá∫</span>
                                        </label>
                                    </div>
                                    <small class="text-muted">ÂêØÁî®ÊàñÂÖ≥Èó≠ÊâÄÊúâ AI Áõ∏ÂÖ≥ÂäüËÉΩ</small>
                                </div>
                                <div class="col-12">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="aiAutoSuggest" disabled>
                                        <label class="form-check-label" for="aiAutoSuggest">
                                            AI Ëá™Âä®Âª∫ËÆÆ
                                            <span class="badge bg-secondary">Âç≥Â∞ÜÊé®Âá∫</span>
                                        </label>
                                    </div>
                                    <small class="text-muted">AI ‰ºöËá™Âä®ÂàÜÊûê‰Ω†ÁöÑÊó•Á®ãÂπ∂Êèê‰æõ‰ºòÂåñÂª∫ËÆÆ</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i>ÂèñÊ∂à
                    </button>
                    <button type="button" class="btn btn-primary" id="saveSettings">
                        <i class="fas fa-save me-1"></i>‰øùÂ≠òËÆæÁΩÆ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{% static 'fullcalendar_index.global.js' %}"></script>
    
    <!-- ÂÖ®Â±ÄÂèòÈáè -->
    <script>
        // Django‰º†ÈÄíÁöÑÊï∞ÊçÆ
        window.events_groups = {{ events_groups|safe }};
        window.CSRF_TOKEN = '{{ csrf_token }}';
    </script>
    
    <!-- Ëá™ÂÆö‰πâJavaScriptÊ®°Âùó -->
    <script src="{% static 'js/theme-manager.js' %}?v=20251107-002"></script>
    <script src="{% static 'js/settings-manager.js' %}?v=20251107-001"></script>
    <script src="{% static 'js/panel-resizer.js' %}?v=20251107-001"></script>
    <script src="{% static 'js/reminder-manager.js' %}?v=20251104-002"></script>
    <script src="{% static 'js/rrule-manager.js' %}?v=20251104-002"></script>
    <script src="{% static 'js/modal-manager.js' %}?v=20251104-002"></script>
    <script src="{% static 'js/group-manager.js' %}?v=20251106-001"></script>
    <script src="{% static 'js/event-manager.js' %}?v=20251106-002"></script>
    <script src="{% static 'js/todo-manager.js' %}?v=20251107-007"></script>
    <script src="{% static 'js/calendar-touch-swipe.js' %}?v=20251104-003"></script>
    <script src="{% static 'js/container-query-polyfill.js' %}?v=20251107-001"></script>
    
    <!-- AIÂä©ÊâãÊ®°Âùó -->
    <script>
        class AIAssistant {
            constructor() {
                this.chatModal = document.getElementById('aiChatModal');
                this.chatMessages = document.getElementById('chatMessages');
                this.chatInput = document.getElementById('chatInput');
                this.init();
            }

            init() {
                // AIËÅäÂ§©ÂàáÊç¢ÊåâÈíÆ
                document.getElementById('aiChatToggle').addEventListener('click', () => {
                    this.chatModal.style.display = 'block';
                });

                // ÂõûËΩ¶ÂèëÈÄÅÊ∂àÊÅØ
                this.chatInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.sendMessage();
                    }
                });
            }

            async sendMessage() {
                const message = this.chatInput.value.trim();
                if (!message) return;

                // Ê∑ªÂä†Áî®Êà∑Ê∂àÊÅØ
                this.addMessage(message, 'user');
                this.chatInput.value = '';

                try {
                    const response = await fetch('/ai_chatting/chat/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': window.CSRF_TOKEN
                        },
                        body: JSON.stringify({ message: message })
                    });

                    const data = await response.json();
                    if (data.success) {
                        this.addMessage(data.response, 'ai');
                    } else {
                        this.addMessage('Êä±Ê≠âÔºåÊàëÁé∞Âú®Êó†Ê≥ïÂõûÂ∫î„ÄÇËØ∑Á®çÂêéÂÜçËØï„ÄÇ', 'ai');
                    }
                } catch (error) {
                    console.error('AIËÅäÂ§©ÈîôËØØ:', error);
                    this.addMessage('ÁΩëÁªúËøûÊé•Âá∫Áé∞ÈóÆÈ¢òÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúÂêéÈáçËØï„ÄÇ', 'ai');
                }
            }

            addMessage(content, type) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `${type}-message`;
                
                messageDiv.innerHTML = `
                    <div class="message-avatar">
                        <i class="fas fa-${type === 'user' ? 'user' : 'robot'}"></i>
                    </div>
                    <div class="message-content">${content}</div>
                `;
                
                this.chatMessages.appendChild(messageDiv);
                this.chatMessages.scrollTop = this.chatMessages.scrollHeight;
            }

            async smartSchedule() {
                try {
                    const response = await fetch('/planner/smart_schedule/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': window.CSRF_TOKEN
                        }
                    });

                    const data = await response.json();
                    if (data.success) {
                        modalManager.showNotification('Êô∫ËÉΩÂÆâÊéíÂ∑≤ÂÆåÊàê', 'success');
                        eventManager.loadEvents();
                    } else {
                        modalManager.showNotification('Êô∫ËÉΩÂÆâÊéíÂ§±Ë¥•', 'error');
                    }
                } catch (error) {
                    console.error('Êô∫ËÉΩÂÆâÊéíÈîôËØØ:', error);
                    modalManager.showNotification('Êô∫ËÉΩÂÆâÊéíÂá∫Áé∞ÈîôËØØ', 'error');
                }
            }

            async analyzePriority() {
                try {
                    const response = await fetch('/planner/analyze_priority/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': window.CSRF_TOKEN
                        }
                    });

                    const data = await response.json();
                    if (data.success) {
                        modalManager.showNotification('‰ºòÂÖàÁ∫ßÂàÜÊûêÂ∑≤ÂÆåÊàê', 'success');
                        todoManager.loadTodos();
                    } else {
                        modalManager.showNotification('‰ºòÂÖàÁ∫ßÂàÜÊûêÂ§±Ë¥•', 'error');
                    }
                } catch (error) {
                    console.error('‰ºòÂÖàÁ∫ßÂàÜÊûêÈîôËØØ:', error);
                    modalManager.showNotification('‰ºòÂÖàÁ∫ßÂàÜÊûêÂá∫Áé∞ÈîôËØØ', 'error');
                }
            }

            async timeBlocking() {
                try {
                    const response = await fetch('/planner/time_blocking/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': window.CSRF_TOKEN
                        }
                    });

                    const data = await response.json();
                    if (data.success) {
                        modalManager.showNotification('Êó∂Èó¥ÂùóÂàÜÈÖçÂ∑≤ÂÆåÊàê', 'success');
                        eventManager.loadEvents();
                    } else {
                        modalManager.showNotification('Êó∂Èó¥ÂùóÂàÜÈÖçÂ§±Ë¥•', 'error');
                    }
                } catch (error) {
                    console.error('Êó∂Èó¥ÂùóÂàÜÈÖçÈîôËØØ:', error);
                    modalManager.showNotification('Êó∂Èó¥ÂùóÂàÜÈÖçÂá∫Áé∞ÈîôËØØ', 'error');
                }
            }
        }

        // ÂàõÂª∫AIÂä©ÊâãÂÆû‰æã
        const aiAssistant = new AIAssistant();
        
        // ÂàõÂª∫ÁÆ°ÁêÜÂô®ÂÆû‰æãÔºàÂÖ®Â±ÄÂèòÈáèÔºâ
        window.modalManager = new ModalManager();
        window.eventManager = new EventManager();
        window.todoManager = new TodoManager();
        window.reminderManager = new ReminderManager();
        window.rruleManager = new RRuleManager();
        window.panelResizer = new PanelResizer(); // Ê∑ªÂä†Èù¢ÊùøË∞ÉËäÇÂô®
    </script>

    <!-- È°µÈù¢ÂàùÂßãÂåñ -->
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            // È¶ñÂÖàÂàùÂßãÂåñËÆæÁΩÆÁÆ°ÁêÜÂô®Âπ∂Á≠âÂæÖÂä†ËΩΩÂÆåÊàê
            await settingsManager.init();
            console.log('‚úÖ ËÆæÁΩÆÁÆ°ÁêÜÂô®ÂàùÂßãÂåñÂÆåÊàê');
            
            // Á´ãÂç≥Âä†ËΩΩÁî®Êà∑ËÆæÁΩÆÂà∞ÂÖ®Â±ÄÂèòÈáèÔºà‰∏çÊòæÁ§∫Âú®UI‰∏äÔºâ
            await loadUserSettingsToGlobal();
            console.log('‚úÖ Áî®Êà∑ËÆæÁΩÆÂ∑≤Âä†ËΩΩÂà∞ÂÖ®Â±ÄÂèòÈáè');
            
            // ÂàùÂßãÂåñ‰∏ªÈ¢òÁÆ°ÁêÜÂô®(ÈúÄË¶ÅÂú®userSettingsÂä†ËΩΩÂêé)
            window.themeManager.init();
            
            // ÂàùÂßãÂåñÂêÑ‰∏™ÁÆ°ÁêÜÂô®
            window.modalManager.init();
            window.groupManager.init();  // ÂÖàÂàùÂßãÂåñÊó•Á®ãÁªÑÁÆ°ÁêÜÂô®
            window.eventManager.init(); // Ê≠§Êó∂settingsManagerÂ∑≤ÊúâÊï∞ÊçÆ,ÂèØ‰ª•Ê≠£Á°ÆËÆæÁΩÆinitialViewÂíåinitialDate
            window.todoManager.init();
            window.reminderManager.init();
            
            // ÂàùÂßãÂåñÊó•ÂéÜËß¶Â±èÊªëÂä®ÂäüËÉΩ
            // Á≠âÂæÖÊó•ÂéÜÊ∏≤ÊüìÂÆåÊàêÂêéÂÜçÂêØÁî®Ëß¶Â±èÊªëÂä®
            setTimeout(() => {
                if (window.eventManager && window.eventManager.calendar && window.CalendarTouchSwipe) {
                    window.calendarSwipe = new CalendarTouchSwipe(window.eventManager.calendar);
                    console.log('‚úÖ Êó•ÂéÜËß¶Â±èÊªëÂä®ÂäüËÉΩÂ∑≤ÂêØÁî®');
                }
            }, 800);
            
            // ÂàùÂßãÂåñÈáçÂ§çÊèêÈÜíUI‰∫ã‰ª∂ÁõëÂê¨Âô®
            initRepeatReminderListeners();
            
            // Á®çÂæÆÂª∂ËøüÂä†ËΩΩÊï∞ÊçÆÔºåÁ°Æ‰øùDOMÂÆåÂÖ®ÂáÜÂ§áÂ•Ω
            setTimeout(() => {
                window.eventManager.loadEvents();
                window.todoManager.loadTodos();
                window.reminderManager.loadReminders();
                
                // ÂÜçÂª∂Ëøü‰∏ÄÁÇπÂ∫îÁî®‰øùÂ≠òÁöÑËÆæÁΩÆÔºåÁ°Æ‰øùÊâÄÊúâÊï∞ÊçÆÂä†ËΩΩÂÆåÊàê
                setTimeout(() => {
                    settingsManager.applySettings();
                    console.log('Â∑≤Â∫îÁî®‰øùÂ≠òÁöÑÁî®Êà∑ËÆæÁΩÆ');
                }, 500);
            }, 100);
            
            // ÂàùÂßãÂåñÁî®Êà∑ËÆæÁΩÆÂäüËÉΩ
            initUserSettings();
            
            // ÂàùÂßãÂåñÂë®Êï∞ÊòæÁ§∫ÂäüËÉΩ
            initWeekNumberDisplay();
            
            console.log('UniSchedulerSuper Á≥ªÁªüÂ∑≤ÂàùÂßãÂåñÂÆåÊàê');
        });
        
        // ==================== Áî®Êà∑ËÆæÁΩÆÁÆ°ÁêÜ ====================
        
        // Âä†ËΩΩÁî®Êà∑ËÆæÁΩÆÂà∞ÂÖ®Â±ÄÂèòÈáèÔºàÈ°µÈù¢ÂàùÂßãÂåñÊó∂Ë∞ÉÁî®Ôºâ
        async function loadUserSettingsToGlobal() {
            try {
                const response = await fetch('/get_calendar/user_settings/', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const settings = await response.json();
                // Â∞ÜËÆæÁΩÆ‰øùÂ≠òÂà∞ÂÖ®Â±ÄÂèòÈáè
                window.userSettings = settings;
                console.log('‚úÖ Áî®Êà∑ËÆæÁΩÆÂ∑≤Âä†ËΩΩÂà∞ÂÖ®Â±ÄÂèòÈáè:', window.userSettings);
            } catch (error) {
                console.error('Âä†ËΩΩÁî®Êà∑ËÆæÁΩÆÂ§±Ë¥•:', error);
                // ËÆæÁΩÆÈªòËÆ§ÂÄº
                window.userSettings = {
                    auto_ddl: true,  // ÈªòËÆ§ÂêØÁî®Ëá™Âä®DDL
                    show_weekends: true,
                    calendar_view_default: 'dayGridMonth'
                };
                console.log('‰ΩøÁî®ÈªòËÆ§ËÆæÁΩÆ:', window.userSettings);
            }
        }
        
        function initUserSettings() {
            // ÂΩìËÆæÁΩÆÊ®°ÊÄÅÊ°ÜÊâìÂºÄÊó∂ÔºåÂä†ËΩΩÂΩìÂâçËÆæÁΩÆ
            const settingsModal = document.getElementById('settingsModal');
            if (settingsModal) {
                settingsModal.addEventListener('show.bs.modal', loadUserSettings);
            }
            
            // ‰øùÂ≠òËÆæÁΩÆÊåâÈíÆ
            const saveBtn = document.getElementById('saveSettings');
            if (saveBtn) {
                saveBtn.addEventListener('click', saveUserSettings);
            }
            
            // ÈáëËâ≤‰∏ªÈ¢òÂºÄÂÖ≥
            const goldThemeToggle = document.getElementById('useGoldTheme');
            if (goldThemeToggle) {
                goldThemeToggle.addEventListener('change', function() {
                    if (window.themeManager) {
                        window.themeManager.toggleGoldTheme(this.checked);
                    }
                });
            }
            
            // ‰∏ªÈ¢òÈÄâÊã©Âô®ÂèòÂåñÊó∂ÔºåÂ¶ÇÊûúÂêØÁî®‰∫ÜÈáëËâ≤‰∏ªÈ¢òÔºå‰πüË¶ÅÈáçÊñ∞Â∫îÁî®
            const themeSelect = document.getElementById('theme');
            if (themeSelect) {
                themeSelect.addEventListener('change', function() {
                    const useGold = document.getElementById('useGoldTheme')?.checked || false;
                    if (window.themeManager) {
                        window.themeManager.applyTheme(this.value);
                    }
                });
            }
            
            // ÂàùÂßãÂåñ tooltips
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
        }
        
        // Âä†ËΩΩÁî®Êà∑ËÆæÁΩÆ
        function loadUserSettings() {
            fetch('/get_calendar/user_settings/', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(settings => {
                console.log('Âä†ËΩΩÁöÑËÆæÁΩÆ:', settings);
                
                // ËæÖÂä©ÂáΩÊï∞ÔºöÂÆâÂÖ®ËÆæÁΩÆÂÖÉÁ¥†ÂÄºÔºàË∑≥Ëøá‰∏çÂ≠òÂú®ÊàñË¢´Á¶ÅÁî®ÁöÑÂÖÉÁ¥†Ôºâ
                function safeSetValue(id, value) {
                    const element = document.getElementById(id);
                    if (element && !element.disabled) {
                        element.value = value;
                    }
                }
                
                function safeSetChecked(id, value) {
                    const element = document.getElementById(id);
                    if (element && !element.disabled) {
                        element.checked = value;
                    }
                }
                
                // Âü∫Êú¨ËÆæÁΩÆ - Âë®Êï∞ÊòæÁ§∫
                safeSetChecked('showWeekNumber', settings.show_week_number !== false);
                
                // Âä†ËΩΩÂë®ÊúüÂàóË°®
                loadWeekPeriods(settings.week_number_periods || []);
                
                // Êó•Á®ãÂÅèÂ•ΩÔºàÂ§ßÈÉ®ÂàÜÂ∑≤Á¶ÅÁî®Ôºâ
                safeSetValue('defaultEventDuration', settings.default_event_duration || 60);
                safeSetValue('weekStartsOn', settings.week_starts_on || 1);
                safeSetValue('workHoursStart', settings.work_hours_start || '09:00');
                safeSetValue('workHoursEnd', settings.work_hours_end || '18:00');
                safeSetChecked('autoDdl', settings.auto_ddl !== false);
                safeSetChecked('showWeekends', settings.show_weekends !== false);
                
                // ÊòæÁ§∫ÂÅèÂ•Ω
                safeSetValue('calendarViewDefault', settings.calendar_view_default || 'dayGridMonth');
                safeSetValue('theme', settings.theme || 'light');
                safeSetChecked('useGoldTheme', settings.use_gold_theme === true);
                safeSetValue('eventColorBy', settings.event_color_by || 'default');
                safeSetChecked('showCompletedEvents', settings.show_completed_events !== false);
                
                // ÊèêÈÜíËÆæÁΩÆ
                safeSetChecked('reminderEnabled', settings.reminder_enabled !== false);
                safeSetChecked('reminderSound', settings.reminder_sound !== false);
                
                // AI ËÆæÁΩÆ
                safeSetChecked('aiEnabled', settings.ai_enabled !== false);
                safeSetChecked('aiAutoSuggest', settings.ai_auto_suggest === true);
                
                // Â∞ÜËÆæÁΩÆ‰øùÂ≠òÂà∞ÂÖ®Â±ÄÂèòÈáè,‰æõÂÖ∂‰ªñÊ®°Âùó‰ΩøÁî®
                window.userSettings = settings;
                console.log('Áî®Êà∑ËÆæÁΩÆÂ∑≤‰øùÂ≠òÂà∞ window.userSettings:', window.userSettings);
            })
            .catch(error => {
                console.error('Âä†ËΩΩËÆæÁΩÆÂ§±Ë¥•:', error);
                showToast('Âä†ËΩΩËÆæÁΩÆÂ§±Ë¥•ÔºåÂ∞Ü‰ΩøÁî®ÈªòËÆ§ÂÄº', 'warning');
                // Âç≥‰ΩøÂä†ËΩΩÂ§±Ë¥•,‰πüËÆæÁΩÆÈªòËÆ§ÂÄº
                window.userSettings = {
                    auto_ddl: true,  // ÈªòËÆ§ÂêØÁî®Ëá™Âä®DDL
                    show_weekends: true,
                    calendar_view_default: 'dayGridMonth'
                };
            });
        }
        
        // ==================== Âë®ÊúüÁÆ°ÁêÜÂäüËÉΩ ====================
        
        /**
         * Âä†ËΩΩÂë®ÊúüÂàóË°®Âà∞UI
         */
        function loadWeekPeriods(periods) {
            const container = document.getElementById('weekPeriodsList');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (!periods || periods.length === 0) {
                // ÊòæÁ§∫Á©∫Áä∂ÊÄÅ
                container.innerHTML = `
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        ËøòÊ≤°ÊúâÊ∑ªÂä†‰ªª‰ΩïÂ≠¶Êúü,ÁÇπÂáª"Ê∑ªÂä†Â≠¶Êúü"ÊåâÈíÆÂºÄÂßãËÆæÁΩÆ
                    </div>
                `;
                return;
            }
            
            // Ê∏≤ÊüìÊØè‰∏™Âë®Êúü
            periods.forEach((period, index) => {
                const periodCard = document.createElement('div');
                periodCard.className = 'card mb-2';
                periodCard.innerHTML = `
                    <div class="card-body">
                        <div class="row g-2">
                            <div class="col-md-3">
                                <label class="form-label small">Â≠¶ÊúüÂêçÁß∞</label>
                                <input type="text" class="form-control form-control-sm" 
                                       value="${period.name || ''}" 
                                       onchange="updatePeriodName(${index}, this.value)"
                                       placeholder="‰æãÂ¶Ç: 2024ÁßãÂ≠£">
                            </div>
                            <div class="col-md-2">
                                <label class="form-label small">Âπ¥‰ªΩ</label>
                                <input type="number" class="form-control form-control-sm" 
                                       value="${period.year || new Date().getFullYear()}" 
                                       min="2000" max="2100"
                                       onchange="updatePeriodYear(${index}, this.value)">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label small">Êúà‰ªΩ</label>
                                <select class="form-select form-select-sm" 
                                        onchange="updatePeriodMonth(${index}, this.value)">
                                    ${generateMonthOptions(period.month)}
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label class="form-label small">Êó•Êúü</label>
                                <input type="number" class="form-control form-control-sm" 
                                       value="${period.day || 1}" 
                                       min="1" max="31"
                                       onchange="updatePeriodDay(${index}, this.value)">
                            </div>
                            <div class="col-md-2 d-flex align-items-end">
                                <button type="button" class="btn btn-sm btn-danger w-100" 
                                        onclick="removeWeekPeriod(${index})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(periodCard);
            });
        }
        
        /**
         * ÁîüÊàêÊúà‰ªΩÈÄâÈ°π
         */
        function generateMonthOptions(selectedMonth) {
            const months = [
                '1Êúà', '2Êúà', '3Êúà', '4Êúà', '5Êúà', '6Êúà',
                '7Êúà', '8Êúà', '9Êúà', '10Êúà', '11Êúà', '12Êúà'
            ];
            return months.map((name, index) => {
                const value = index + 1;
                const selected = value === selectedMonth ? 'selected' : '';
                return `<option value="${value}" ${selected}>${name}</option>`;
            }).join('');
        }
        
        /**
         * Ê∑ªÂä†Êñ∞Âë®Êúü
         */
        function addWeekPeriod() {
            const settings = window.userSettings || {};
            const periods = settings.week_number_periods || [];
            
            // Ê∑ªÂä†Êñ∞Âë®Êúü,ÈªòËÆ§‰ΩøÁî®ÂΩìÂâçÂπ¥‰ªΩ
            periods.push({
                name: 'Êñ∞Â≠¶Êúü',
                year: new Date().getFullYear(),
                month: 2,
                day: 24
            });
            
            // Êõ¥Êñ∞ËÆæÁΩÆ
            settings.week_number_periods = periods;
            window.userSettings = settings;
            
            // ÈáçÊñ∞Âä†ËΩΩUI
            loadWeekPeriods(periods);
        }
        
        /**
         * Âà†Èô§Âë®Êúü
         */
        function removeWeekPeriod(index) {
            if (!confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™Â≠¶ÊúüÂêó?')) {
                return;
            }
            
            const settings = window.userSettings || {};
            const periods = settings.week_number_periods || [];
            
            periods.splice(index, 1);
            settings.week_number_periods = periods;
            window.userSettings = settings;
            
            loadWeekPeriods(periods);
        }
        
        /**
         * Êõ¥Êñ∞Âë®ÊúüÂêçÁß∞
         */
        function updatePeriodName(index, value) {
            const settings = window.userSettings || {};
            const periods = settings.week_number_periods || [];
            
            if (periods[index]) {
                periods[index].name = value;
                settings.week_number_periods = periods;
                window.userSettings = settings;
            }
        }
        
        /**
         * Êõ¥Êñ∞Âë®ÊúüÂπ¥‰ªΩ
         */
        function updatePeriodYear(index, value) {
            const settings = window.userSettings || {};
            const periods = settings.week_number_periods || [];
            
            if (periods[index]) {
                periods[index].year = parseInt(value);
                settings.week_number_periods = periods;
                window.userSettings = settings;
            }
        }
        
        /**
         * Êõ¥Êñ∞Âë®ÊúüÊúà‰ªΩ
         */
        function updatePeriodMonth(index, value) {
            const settings = window.userSettings || {};
            const periods = settings.week_number_periods || [];
            
            if (periods[index]) {
                periods[index].month = parseInt(value);
                settings.week_number_periods = periods;
                window.userSettings = settings;
            }
        }
        
        /**
         * Êõ¥Êñ∞Âë®ÊúüÊó•Êúü
         */
        function updatePeriodDay(index, value) {
            const settings = window.userSettings || {};
            const periods = settings.week_number_periods || [];
            
            if (periods[index]) {
                periods[index].day = parseInt(value);
                settings.week_number_periods = periods;
                window.userSettings = settings;
            }
        }
        
        /**
         * Ëé∑ÂèñÂΩìÂâçÂë®ÊúüÈÖçÁΩÆ
         */
        function getWeekPeriods() {
            const settings = window.userSettings || {};
            return settings.week_number_periods || [];
        }
        
        // ‰øùÂ≠òÁî®Êà∑ËÆæÁΩÆ
        function saveUserSettings() {
            // ËæÖÂä©ÂáΩÊï∞ÔºöÂÆâÂÖ®Ëé∑ÂèñÂÖÉÁ¥†ÂÄºÔºàË∑≥Ëøá‰∏çÂ≠òÂú®ÊàñË¢´Á¶ÅÁî®ÁöÑÂÖÉÁ¥†Ôºâ
            function safeGetValue(id, defaultValue) {
                const element = document.getElementById(id);
                if (element && !element.disabled) {
                    return element.value;
                }
                return defaultValue;
            }
            
            function safeGetChecked(id, defaultValue) {
                const element = document.getElementById(id);
                if (element && !element.disabled) {
                    return element.checked;
                }
                return defaultValue;
            }
            
            function safeGetIntValue(id, defaultValue) {
                const element = document.getElementById(id);
                if (element && !element.disabled) {
                    return parseInt(element.value);
                }
                return defaultValue;
            }
            
            const settings = {
                // Êñ∞ÁöÑÂ§öÂë®ÊúüÁ≥ªÁªü
                week_number_periods: getWeekPeriods(),
                show_week_number: safeGetChecked('showWeekNumber', true),
                // ‰øùÁïôÊóßÂ≠óÊÆµ‰ª•ÂÖºÂÆπÂéÜÂè≤Êï∞ÊçÆ
                week_number_start: {
                    month: safeGetIntValue('weekNumberStartMonth', 2),
                    day: safeGetIntValue('weekNumberStartDay', 24)
                },
                auto_ddl: safeGetChecked('autoDdl', true),
                default_event_duration: safeGetIntValue('defaultEventDuration', 60),
                work_hours_start: safeGetValue('workHoursStart', '09:00'),
                work_hours_end: safeGetValue('workHoursEnd', '18:00'),
                show_weekends: safeGetChecked('showWeekends', true),
                week_starts_on: safeGetIntValue('weekStartsOn', 1),
                calendar_view_default: safeGetValue('calendarViewDefault', 'dayGridMonth'),
                theme: safeGetValue('theme', 'light'),
                use_gold_theme: safeGetChecked('useGoldTheme', false),
                show_completed_events: safeGetChecked('showCompletedEvents', true),
                event_color_by: safeGetValue('eventColorBy', 'default'),
                reminder_enabled: safeGetChecked('reminderEnabled', true),
                default_reminder_time: 15,  // Âõ∫ÂÆöÈªòËÆ§ÂÄºÔºåÂõ†‰∏∫UI‰∏≠Â∑≤Âà†Èô§ËØ•Â≠óÊÆµ
                reminder_sound: safeGetChecked('reminderSound', true),
                ai_enabled: safeGetChecked('aiEnabled', true),
                ai_auto_suggest: safeGetChecked('aiAutoSuggest', false),
                prompt_scene_presets: []  // ÊöÇÊó∂‰øùÁïôÁ©∫Êï∞ÁªÑÔºåÊú™Êù•ÂèØÊâ©Â±ï
            };
            
            console.log('‰øùÂ≠òÁöÑËÆæÁΩÆ:', settings);
            
            fetch('/get_calendar/user_settings/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': window.CSRF_TOKEN
                },
                body: JSON.stringify(settings)
            })
            .then(response => response.json())
            .then(data => {
                console.log('ËÆæÁΩÆ‰øùÂ≠òÊàêÂäü:', data);
                showToast('ËÆæÁΩÆÂ∑≤‰øùÂ≠ò', 'success');
                
                // Êõ¥Êñ∞ÂÖ®Â±ÄËÆæÁΩÆÂèòÈáè
                window.userSettings = settings;
                console.log('‚úÖ ÂÖ®Â±ÄËÆæÁΩÆÂ∑≤Êõ¥Êñ∞:', window.userSettings);
                
                // ÂÖ≥Èó≠Ê®°ÊÄÅÊ°Ü
                const modalElement = document.getElementById('settingsModal');
                const modal = bootstrap.Modal.getInstance(modalElement);
                if (modal) {
                    modal.hide();
                }
                
                // Â∫îÁî®Êüê‰∫õÁ´ãÂç≥ÁîüÊïàÁöÑËÆæÁΩÆ
                applyImmediateSettings(settings);
            })
            .catch(error => {
                console.error('‰øùÂ≠òËÆæÁΩÆÂ§±Ë¥•:', error);
                showToast('‰øùÂ≠òÂ§±Ë¥•ÔºåËØ∑ÈáçËØï', 'danger');
            });
        }
        
        // Â∫îÁî®Á´ãÂç≥ÁîüÊïàÁöÑËÆæÁΩÆ
        function applyImmediateSettings(settings) {
            // Ê£ÄÊü•Êó•ÂéÜÂÆû‰æãÊòØÂê¶Â≠òÂú®
            const calendarInstance = window.eventManager?.calendar;
            
            if (!calendarInstance) {
                console.log('Êó•ÂéÜÂÆû‰æãÂ∞öÊú™ÂàùÂßãÂåñÔºåËÆæÁΩÆÂ∞ÜÂú®‰∏ãÊ¨°È°µÈù¢Âä†ËΩΩÊó∂ÁîüÊïà');
                return;
            }
            
            // ‚ö†Ô∏è Ê≥®ÊÑèÔºö‰∏çÂú®ËøôÈáåÂ∫îÁî® calendar_view_default
            // Âõ†‰∏∫ settings-manager.js ‰ºöÂú®È°µÈù¢Âà∑Êñ∞Êó∂ÊÅ¢Â§çÁî®Êà∑‰∏äÊ¨°ÁöÑËßÜÂõæÂíåÊó•Êúü
            // calendar_view_default Âè™Âú®ÈáçÊñ∞ÁôªÂΩï(Ê≤°Êúâ‰øùÂ≠òÁöÑËßÜÂõæÁä∂ÊÄÅ)Êó∂‰ΩøÁî®
            
            // Â∫îÁî®‰∏ªÈ¢òËÆæÁΩÆ
            if (settings.theme && window.themeManager) {
                window.themeManager.applyTheme(settings.theme, false); // falseÂõ†‰∏∫Â∑≤Áªè‰øùÂ≠òÂà∞Êï∞ÊçÆÂ∫ì
                console.log('‰∏ªÈ¢òÂ∑≤Êõ¥Êñ∞‰∏∫:', settings.theme);
            }
            
            // Â∫îÁî®Âë®Ëµ∑ÂßãÊó•ËÆæÁΩÆ
            if (settings.week_starts_on !== undefined) {
                try {
                    calendarInstance.setOption('firstDay', settings.week_starts_on);
                    console.log('Âë®Ëµ∑ÂßãÊó•Â∑≤Êõ¥Êñ∞‰∏∫:', settings.week_starts_on);
                    
                    // Êõ¥Êñ∞Âë®Êï∞ÊòæÁ§∫(Âõ†‰∏∫Âë®Êï∞ËÆ°ÁÆó‰æùËµñ‰∫éÂë®Ëµ∑ÂßãÊó•)
                    updateWeekNumberDisplay();
                } catch (error) {
                    console.error('Êõ¥Êñ∞Âë®Ëµ∑ÂßãÊó•Â§±Ë¥•:', error);
                }
            }
            
            // Â∫îÁî®Âë®Êú´ÊòæÁ§∫ËÆæÁΩÆ
            if (settings.show_weekends !== undefined) {
                try {
                    calendarInstance.setOption('weekends', settings.show_weekends);
                    console.log('Âë®Êú´ÊòæÁ§∫Â∑≤Êõ¥Êñ∞‰∏∫:', settings.show_weekends);
                } catch (error) {
                    console.error('Êõ¥Êñ∞Âë®Êú´ÊòæÁ§∫Â§±Ë¥•:', error);
                }
            }
        }
        
        // ==================== Âë®Êï∞ÊòæÁ§∫ÁÆ°ÁêÜ ====================
        
        /**
         * Ëé∑ÂèñÊüê‰∏™Êó•ÊúüÊâÄÂú®Âë®ÁöÑÂºÄÂßãÊó•Êúü
         * @param {Date} date - ËæìÂÖ•Êó•Êúü
         * @param {number} weekStartsOn - ÊØèÂë®Ëµ∑ÂßãÊó•(0=Âë®Êó•, 1=Âë®‰∏Ä, ..., 6=Âë®ÂÖ≠)
         * @returns {Date} ËØ•Âë®ÁöÑÂºÄÂßãÊó•Êúü
         */
        function getWeekStart(date, weekStartsOn = 1) {
            const d = new Date(date);
            const day = d.getDay(); // 0=Âë®Êó•, 1=Âë®‰∏Ä, ..., 6=Âë®ÂÖ≠
            const diff = (day - weekStartsOn + 7) % 7; // ËÆ°ÁÆóË∑ùÁ¶ªÂë®Ëµ∑ÂßãÊó•ÁöÑÂ§©Êï∞
            d.setDate(d.getDate() - diff);
            d.setHours(0, 0, 0, 0); // ÈáçÁΩÆÂà∞ÂΩìÂ§©00:00:00
            return d;
        }
        
        /**
         * Êü•ÊâæÊúÄËøëÁöÑÂë®Êï∞Ëµ∑ÂßãÊó•Êúü
         * @param {Date} date - Ë¶ÅÊü•ÊâæÁöÑÂü∫ÂáÜÊó•Êúü
         * @param {Array} periods - Âë®Êï∞Ëµ∑ÂßãÊó∂Èó¥Êï∞ÁªÑ [{name, year, month, day}]
         * @param {number} weekStartsOn - ÊØèÂë®Ëµ∑ÂßãÊó•(0=Âë®Êó•, 1=Âë®‰∏Ä, ..., 6=Âë®ÂÖ≠)
         * @returns {Object|null} {period, startDate, weekNumber} Êàñ null(Êâæ‰∏çÂà∞)
         */
        function findNearestPeriod(date, periods, weekStartsOn = 1) {
            if (!periods || periods.length === 0) {
                return null;
            }
            
            let nearestPeriod = null;
            let nearestStartDate = null;
            let minDistance = Infinity;
            
            // ÈÅçÂéÜÊâÄÊúâËµ∑ÂßãÊó∂Èó¥,‰ΩøÁî®ÈÖçÁΩÆÁöÑÂπ¥‰ªΩ
            for (const period of periods) {
                // ‰ΩøÁî®ÈÖçÁΩÆÁöÑÂπ¥ÊúàÊó•ÂàõÂª∫Ëµ∑ÂßãÊó•Êúü
                const startDate = new Date(period.year, period.month - 1, period.day);
                
                // Âè™ËÄÉËôëÂú®ÂΩìÂâçÊó•Êúü‰πãÂâçÊàñÁ≠â‰∫éÁöÑËµ∑ÂßãÊó•Êúü
                if (startDate <= date) {
                    const distance = date - startDate;
                    if (distance < minDistance) {
                        minDistance = distance;
                        nearestPeriod = period;
                        nearestStartDate = startDate;
                    }
                }
            }
            
            // Â¶ÇÊûúÊâæÂà∞‰∫ÜÊúÄËøëÁöÑËµ∑ÂßãÊó•Êúü,ËÆ°ÁÆóÂë®Êï∞
            if (nearestPeriod && nearestStartDate) {
                // ÊâæÂà∞Ëµ∑ÂßãÊó•ÊúüÊâÄÂú®Âë®ÁöÑÂºÄÂßã
                const periodWeekStart = getWeekStart(nearestStartDate, weekStartsOn);
                
                // ÊâæÂà∞ÁõÆÊ†áÊó•ÊúüÊâÄÂú®Âë®ÁöÑÂºÄÂßã
                const targetWeekStart = getWeekStart(date, weekStartsOn);
                
                // ËÆ°ÁÆó‰∏§‰∏™Âë®ÂºÄÂßãÊó•Êúü‰πãÈó¥ÁöÑÂ§©Êï∞Â∑Æ
                const diffTime = targetWeekStart - periodWeekStart;
                const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                
                // ËÆ°ÁÆóÁªèËøá‰∫ÜÂ§öÂ∞ëÂÆåÊï¥ÁöÑÂë®,Âä†1ÂæóÂà∞ÂΩìÂâçÊòØÁ¨¨Âá†Âë®
                const weekNumber = Math.floor(diffDays / 7) + 1;
                
                return {
                    period: nearestPeriod,
                    startDate: nearestStartDate,
                    weekNumber: weekNumber
                };
            }
            
            return null;
        }
        
        /**
         * ËÆ°ÁÆóÂΩìÂâçÊó•ÊúüÊòØÁ¨¨Âá†Âë®(Êñ∞ÁâàÊú¨ - ÊîØÊåÅÂ§öËµ∑ÂßãÊó∂Èó¥ÂíåÊØèÂë®Ëµ∑ÂßãÊó•)
         * @param {Date} date - Ë¶ÅËÆ°ÁÆóÁöÑÊó•Êúü
         * @returns {Object|null} {period, weekNumber} Êàñ null(Êâæ‰∏çÂà∞Ëµ∑ÂßãÊó∂Èó¥)
         */
        function calculateWeekNumber(date = new Date()) {
            // Ê£ÄÊü•Áî®Êà∑ËÆæÁΩÆ
            const settings = window.userSettings || {};
            
            // Ê£ÄÊü•ÊòØÂê¶Á¶ÅÁî®Âë®Êï∞ÊòæÁ§∫
            if (settings.show_week_number === false) {
                return null;
            }
            
            // Ëé∑ÂèñÊØèÂë®Ëµ∑ÂßãÊó•ÈÖçÁΩÆ,ÈªòËÆ§‰∏∫Âë®‰∏Ä(1)
            const weekStartsOn = settings.week_starts_on !== undefined ? settings.week_starts_on : 1;
            
            // ‰ºòÂÖà‰ΩøÁî®Êñ∞ÁöÑweek_number_periods
            let periods = settings.week_number_periods;
            
            // Â¶ÇÊûúÊ≤°Êúâperiods‰ΩÜÊúâÊóßÁöÑweek_number_start,ËøõË°åÂÖºÂÆπÂ§ÑÁêÜ
            if ((!periods || periods.length === 0) && settings.week_number_start) {
                periods = [{
                    name: 'ÈªòËÆ§Â≠¶Êúü',
                    year: new Date().getFullYear(), // ‰ΩøÁî®ÂΩìÂâçÂπ¥‰ªΩ
                    month: settings.week_number_start.month || 2,
                    day: settings.week_number_start.day || 24
                }];
            }
            
            // Êü•ÊâæÊúÄËøëÁöÑËµ∑ÂßãÊó∂Èó¥,‰º†ÂÖ•weekStartsOnÂèÇÊï∞
            const result = findNearestPeriod(date, periods, weekStartsOn);
            
            if (result) {
                return {
                    period: result.period,
                    weekNumber: result.weekNumber
                };
            }
            
            return null;
        }
        
        /**
         * Êõ¥Êñ∞Êó•ÂéÜÊ†áÈ¢òÊóÅËæπÁöÑÂë®Êï∞ÊòæÁ§∫
         */
        function updateWeekNumberDisplay() {
            // Ëé∑ÂèñÊó•ÂéÜÂÆû‰æã
            const calendarInstance = window.eventManager?.calendar;
            if (!calendarInstance) {
                console.warn('Êó•ÂéÜÂÆû‰æã‰∏çÂ≠òÂú®ÔºåÊó†Ê≥ïÊõ¥Êñ∞Âë®Êï∞ÊòæÁ§∫');
                return;
            }
            
            // Ëé∑ÂèñÂΩìÂâçËßÜÂõæ
            const currentView = calendarInstance.view;
            const viewType = currentView.type;
            
            // Êü•ÊâæÊàñÂàõÂª∫Âë®Êï∞ÊòæÁ§∫ÂÖÉÁ¥†
            let weekBadge = document.getElementById('weekNumberBadge');
            const toolbarTitle = document.querySelector('.fc-toolbar-title');
            
            if (!toolbarTitle) {
                console.warn('Êú™ÊâæÂà∞Êó•ÂéÜÊ†áÈ¢òÂÖÉÁ¥†');
                return;
            }
            
            // ËÆ°ÁÆóÂë®Êï∞ÊòæÁ§∫ÂÜÖÂÆπ
            let badgeText = '';
            
            if (viewType === 'dayGridMonth') {
                // ÊúàËßÜÂõæ: ÊòæÁ§∫Á¨¨XÂë®-Á¨¨YÂë®
                const startDate = currentView.activeStart;
                const endDate = new Date(currentView.activeEnd.getTime() - 1); // Âáè1Â§©,Âõ†‰∏∫activeEndÊòØ‰∏ã‰∏™ÊúàÁ¨¨‰∏ÄÂ§©
                
                const startResult = calculateWeekNumber(startDate);
                const endResult = calculateWeekNumber(endDate);
                
                if (startResult && endResult) {
                    if (startResult.weekNumber === endResult.weekNumber) {
                        badgeText = `Á¨¨ ${startResult.weekNumber} Âë®`;
                    } else {
                        badgeText = `Á¨¨ ${startResult.weekNumber}-${endResult.weekNumber} Âë®`;
                    }
                    // Â¶ÇÊûúÂ≠¶ÊúüÂêçÁß∞Áõ∏Âêå,ÊòæÁ§∫Â≠¶ÊúüÂêç
                    if (startResult.period.name === endResult.period.name && startResult.period.name !== 'ÈªòËÆ§Â≠¶Êúü') {
                        badgeText += ` (${startResult.period.name})`;
                    }
                }
            } else {
                // Âë®ËßÜÂõæ/Êó•ËßÜÂõæ: ÊòæÁ§∫Âçï‰∏™Âë®Êï∞
                const currentDate = calendarInstance.getDate();
                const result = calculateWeekNumber(currentDate);
                
                if (result) {
                    badgeText = `Á¨¨ ${result.weekNumber} Âë®`;
                    // ÊòæÁ§∫Â≠¶ÊúüÂêçÁß∞(Â¶ÇÊûú‰∏çÊòØÈªòËÆ§Â≠¶Êúü)
                    if (result.period.name && result.period.name !== 'ÈªòËÆ§Â≠¶Êúü') {
                        badgeText += ` (${result.period.name})`;
                    }
                }
            }
            
            // Â¶ÇÊûúÊ≤°ÊúâÂë®Êï∞‰ø°ÊÅØ,ÈöêËóèÂæΩÁ´†
            if (!badgeText) {
                if (weekBadge) {
                    weekBadge.style.display = 'none';
                }
                console.log('ÂΩìÂâçÊó•Êúü‰∏çÂú®‰ªª‰ΩïÂ≠¶ÊúüËåÉÂõ¥ÂÜÖ,‰∏çÊòæÁ§∫Âë®Êï∞');
                return;
            }
            
            if (!weekBadge) {
                // ÂàõÂª∫Âë®Êï∞ÂæΩÁ´†ÂÖÉÁ¥†
                weekBadge = document.createElement('span');
                weekBadge.id = 'weekNumberBadge';
                weekBadge.className = 'badge ms-3';  // ÁßªÈô§bg-primaryÔºåÊîπÁî®CSS‰∏ªÈ¢òÈÄÇÈÖç
                weekBadge.style.fontSize = '0.9rem';
                weekBadge.style.verticalAlign = 'middle';
                
                // ÊèíÂÖ•Âà∞Ê†áÈ¢òÂêéÈù¢
                toolbarTitle.appendChild(weekBadge);
            }
            
            // ÊòæÁ§∫ÂæΩÁ´†Âπ∂Êõ¥Êñ∞ÊñáÊú¨
            weekBadge.style.display = '';
            weekBadge.textContent = badgeText;
            console.log(`‚úÖ Âë®Êï∞Â∑≤Êõ¥Êñ∞: ${badgeText}`);
        }
        
        /**
         * ÂàùÂßãÂåñÂë®Êï∞ÊòæÁ§∫ÂäüËÉΩ
         */
        function initWeekNumberDisplay() {
            // Á≠âÂæÖÊó•ÂéÜÂàùÂßãÂåñÂÆåÊàê
            const checkCalendar = setInterval(() => {
                if (window.eventManager?.calendar) {
                    clearInterval(checkCalendar);
                    
                    // È¶ñÊ¨°ÊòæÁ§∫Âë®Êï∞
                    setTimeout(() => {
                        updateWeekNumberDisplay();
                    }, 500);
                    
                    // ÁõëÂê¨Êó•ÂéÜËßÜÂõæÂèòÂåñ
                    const calendarInstance = window.eventManager.calendar;
                    
                    // ‰ΩøÁî®FullCalendarÁöÑdatesSet‰∫ã‰ª∂ÁõëÂê¨Êó•ÊúüÂèòÂåñ
                    calendarInstance.on('datesSet', function(info) {
                        console.log('Êó•ÂéÜËßÜÂõæÂ∑≤ÂèòÂåñÔºåÊõ¥Êñ∞Âë®Êï∞');
                        updateWeekNumberDisplay();
                    });
                    
                    console.log('‚úÖ Âë®Êï∞ÊòæÁ§∫ÂäüËÉΩÂ∑≤ÂàùÂßãÂåñ');
                }
            }, 100);
            
            // 30ÁßíÂêéÂÅúÊ≠¢Ê£ÄÊü•ÔºàÈò≤Ê≠¢Êó†ÈôêÂæ™ÁéØÔºâ
            setTimeout(() => {
                clearInterval(checkCalendar);
            }, 30000);
        }
        
        // ÊòæÁ§∫ÊèêÁ§∫Ê∂àÊÅØÔºàToastÔºâ
        function showToast(message, type = 'info') {
            // ÂàõÂª∫ Toast ÂÖÉÁ¥†
            const toastHTML = `
                <div class="toast align-items-center text-white bg-${type} border-0" role="alert" aria-live="assertive" aria-atomic="true" style="position: fixed; top: 20px; right: 20px; z-index: 9999;">
                    <div class="d-flex">
                        <div class="toast-body">
                            ${message}
                        </div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                </div>
            `;
            
            // Ê∑ªÂä†Âà∞È°µÈù¢
            document.body.insertAdjacentHTML('beforeend', toastHTML);
            
            // Ëé∑ÂèñÂàöÊ∑ªÂä†ÁöÑÊúÄÂêé‰∏Ä‰∏™ toast ÂÖÉÁ¥†
            const toastElements = document.querySelectorAll('.toast');
            const toastElement = toastElements[toastElements.length - 1];
            
            // ÂàùÂßãÂåñÂπ∂ÊòæÁ§∫ Toast
            const toast = new bootstrap.Toast(toastElement, { delay: 3000 });
            toast.show();
            
            // Ëá™Âä®ÁßªÈô§ DOM ÂÖÉÁ¥†
            setTimeout(() => {
                toastElement.remove();
            }, 4000);
        }
        
        // ÂàùÂßãÂåñÈáçÂ§çÊèêÈÜíÁõ∏ÂÖ≥ÁöÑ‰∫ã‰ª∂ÁõëÂê¨Âô®
        function initRepeatReminderListeners() {
            // ÁõëÂê¨ÊâÄÊúâÂèØËÉΩÂΩ±ÂìçÈáçÂ§çÈ¢ÑËßàÁöÑÊéß‰ª∂
            const fieldsToWatch = [
                'newRepeatFreq', 'newRepeatInterval', 'newRepeatUntil', 'newMonthlyType', 'newMonthlyDate', 'newMonthlyWeek', 'newMonthlyWeekday',
                'editRepeatFreq', 'editRepeatInterval', 'editRepeatUntil', 'editMonthlyType', 'editMonthlyDate', 'editMonthlyWeek', 'editMonthlyWeekday',
                'newMO', 'newTU', 'newWE', 'newTH', 'newFR', 'newSA', 'newSU',
                'editMO', 'editTU', 'editWE', 'editTH', 'editFR', 'editSA', 'editSU'
            ];
            
            fieldsToWatch.forEach(fieldId => {
                const element = document.getElementById(fieldId);
                if (element) {
                    const mode = fieldId.startsWith('new') ? 'new' : 'edit';
                    element.addEventListener('change', () => {
                        updateRepeatPreview(mode);
                    });
                }
            });
        }
        
    </script>
</body>
</html>
